<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> 9 Endogeneity Issues | index</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content=" 9 Endogeneity Issues | index" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 9 Endogeneity Issues | index" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ols-diagnostics.html"/>
<link rel="next" href="data-scientism.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.3/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<script src="libs/d3-3.5.6/d3.min.js"></script>
<link href="libs/profvis-0.3.6.9000/profvis.css" rel="stylesheet" />
<script src="libs/profvis-0.3.6.9000/profvis.js"></script>
<script src="libs/profvis-0.3.6.9000/scroll.js"></script>
<link href="libs/highlight-6.2.0/textmate.css" rel="stylesheet" />
<script src="libs/highlight-6.2.0/highlight.js"></script>
<script src="libs/profvis-binding-0.3.8/profvis.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Primers</a></li>
<li class="toc-logo"><a href="./"><img src="Figures_Manual/Logo.png" width="140" height="100"></a></li>        

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="part"><span><b>I Programming in R</b></span></li>
<li class="chapter" data-level="2" data-path="first-steps.html"><a href="first-steps.html"><i class="fa fa-check"></i><b>2</b> First Steps</a>
<ul>
<li class="chapter" data-level="2.1" data-path="first-steps.html"><a href="first-steps.html#why-r"><i class="fa fa-check"></i><b>2.1</b> Why R</a></li>
<li class="chapter" data-level="2.2" data-path="first-steps.html"><a href="first-steps.html#install-r"><i class="fa fa-check"></i><b>2.2</b> Install R</a></li>
<li class="chapter" data-level="2.3" data-path="first-steps.html"><a href="first-steps.html#interfacing-with-r"><i class="fa fa-check"></i><b>2.3</b> Interfacing with R</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mathematics.html"><a href="mathematics.html"><i class="fa fa-check"></i><b>3</b> Mathematics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mathematics.html"><a href="mathematics.html#scalars"><i class="fa fa-check"></i><b>3.1</b> Scalars</a></li>
<li class="chapter" data-level="3.2" data-path="mathematics.html"><a href="mathematics.html#vectors"><i class="fa fa-check"></i><b>3.2</b> Vectors</a></li>
<li class="chapter" data-level="3.3" data-path="mathematics.html"><a href="mathematics.html#functions"><i class="fa fa-check"></i><b>3.3</b> Functions</a></li>
<li class="chapter" data-level="3.4" data-path="mathematics.html"><a href="mathematics.html#matrices"><i class="fa fa-check"></i><b>3.4</b> Matrices</a></li>
<li class="chapter" data-level="3.5" data-path="mathematics.html"><a href="mathematics.html#arrays"><i class="fa fa-check"></i><b>3.5</b> Arrays</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="statistics.html"><a href="statistics.html"><i class="fa fa-check"></i><b>4</b> Statistics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="statistics.html"><a href="statistics.html#random-variables"><i class="fa fa-check"></i><b>4.1</b> Random Variables</a></li>
<li class="chapter" data-level="4.2" data-path="statistics.html"><a href="statistics.html#functions-of-data"><i class="fa fa-check"></i><b>4.2</b> Functions of Data</a></li>
<li class="chapter" data-level="4.3" data-path="statistics.html"><a href="statistics.html#further-reading"><i class="fa fa-check"></i><b>4.3</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-analysis.html"><a href="data-analysis.html"><i class="fa fa-check"></i><b>5</b> Data Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-analysis.html"><a href="data-analysis.html#data"><i class="fa fa-check"></i><b>5.1</b> Data</a></li>
<li class="chapter" data-level="5.2" data-path="data-analysis.html"><a href="data-analysis.html#plots"><i class="fa fa-check"></i><b>5.2</b> Plots</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data-analysis.html"><a href="data-analysis.html#histograms"><i class="fa fa-check"></i><b>5.2.1</b> Histograms</a></li>
<li class="chapter" data-level="5.2.2" data-path="data-analysis.html"><a href="data-analysis.html#boxplots"><i class="fa fa-check"></i><b>5.2.2</b> Boxplots</a></li>
<li class="chapter" data-level="5.2.3" data-path="data-analysis.html"><a href="data-analysis.html#scatterplots"><i class="fa fa-check"></i><b>5.2.3</b> Scatterplots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="beyond-basics.html"><a href="beyond-basics.html"><i class="fa fa-check"></i><b>6</b> Beyond Basics</a>
<ul>
<li class="chapter" data-level="6.1" data-path="beyond-basics.html"><a href="beyond-basics.html#introductions-to-r"><i class="fa fa-check"></i><b>6.1</b> Introductions to R</a></li>
<li class="chapter" data-level="6.2" data-path="beyond-basics.html"><a href="beyond-basics.html#the-r-ecosystem"><i class="fa fa-check"></i><b>6.2</b> The R Ecosystem</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="beyond-basics.html"><a href="beyond-basics.html#packages"><i class="fa fa-check"></i><b>6.2.1</b> Packages</a></li>
<li class="chapter" data-level="6.2.2" data-path="beyond-basics.html"><a href="beyond-basics.html#task-views"><i class="fa fa-check"></i><b>6.2.2</b> Task Views</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="beyond-basics.html"><a href="beyond-basics.html#custom-figures"><i class="fa fa-check"></i><b>6.3</b> Custom figures</a></li>
</ul></li>
<li class="part"><span><b>II Linear Regression in R</b></span></li>
<li class="chapter" data-level="7" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html"><i class="fa fa-check"></i><b>7</b> Ordinary Least Squares</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#simple-ols-linear-regression"><i class="fa fa-check"></i><b>7.1</b> Simple OLS (linear regression)</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#variability-estimates"><i class="fa fa-check"></i><b>7.1.1</b> Variability Estimates</a></li>
<li class="chapter" data-level="7.1.2" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#hypothesis-tests"><i class="fa fa-check"></i><b>7.1.2</b> Hypothesis Tests</a></li>
<li class="chapter" data-level="7.1.3" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#prediction-intervals"><i class="fa fa-check"></i><b>7.1.3</b> Prediction Intervals</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#ols-multiple-linear-regression"><i class="fa fa-check"></i><b>7.2</b> OLS (multiple linear regression)</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#variability-estimates-and-hypothesis-tests"><i class="fa fa-check"></i><b>7.2.1</b> Variability Estimates and Hypothesis Tests</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#coefficient-interpretation"><i class="fa fa-check"></i><b>7.3</b> Coefficient Interpretation</a></li>
<li class="chapter" data-level="7.4" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#factor-variables"><i class="fa fa-check"></i><b>7.4</b> Factor Variables</a></li>
<li class="chapter" data-level="7.5" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html#more-literature"><i class="fa fa-check"></i><b>7.5</b> More Literature</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ols-diagnostics.html"><a href="ols-diagnostics.html"><i class="fa fa-check"></i><b>8</b> OLS Diagnostics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="ols-diagnostics.html"><a href="ols-diagnostics.html#outliers"><i class="fa fa-check"></i><b>8.1</b> Outliers</a></li>
<li class="chapter" data-level="8.2" data-path="ols-diagnostics.html"><a href="ols-diagnostics.html#normality"><i class="fa fa-check"></i><b>8.2</b> Normality</a></li>
<li class="chapter" data-level="8.3" data-path="ols-diagnostics.html"><a href="ols-diagnostics.html#collinearity"><i class="fa fa-check"></i><b>8.3</b> Collinearity</a></li>
<li class="chapter" data-level="8.4" data-path="ols-diagnostics.html"><a href="ols-diagnostics.html#linear-in-parameters"><i class="fa fa-check"></i><b>8.4</b> Linear in Parameters</a></li>
<li class="chapter" data-level="8.5" data-path="ols-diagnostics.html"><a href="ols-diagnostics.html#more-literature-1"><i class="fa fa-check"></i><b>8.5</b> More Literature</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="endogeneity-issues.html"><a href="endogeneity-issues.html"><i class="fa fa-check"></i><b>9</b> Endogeneity Issues</a>
<ul>
<li class="chapter" data-level="9.1" data-path="endogeneity-issues.html"><a href="endogeneity-issues.html#two-stage-least-squares-2sls"><i class="fa fa-check"></i><b>9.1</b> Two Stage Least Squares (2SLS)</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="endogeneity-issues.html"><a href="endogeneity-issues.html#competitive-market-equilibrium"><i class="fa fa-check"></i><b>9.1.1</b> Competitive Market Equilibrium</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="endogeneity-issues.html"><a href="endogeneity-issues.html#regression-discontinuitieskink-rdrk"><i class="fa fa-check"></i><b>9.2</b> Regression Discontinuities/Kink (RD/RK)</a></li>
<li class="chapter" data-level="9.3" data-path="endogeneity-issues.html"><a href="endogeneity-issues.html#difference-in-differences-did"><i class="fa fa-check"></i><b>9.3</b> Difference in Differences (DID)</a></li>
<li class="chapter" data-level="9.4" data-path="endogeneity-issues.html"><a href="endogeneity-issues.html#more-literature-2"><i class="fa fa-check"></i><b>9.4</b> More Literature</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="data-scientism.html"><a href="data-scientism.html"><i class="fa fa-check"></i><b>10</b> Data Scientism</a>
<ul>
<li class="chapter" data-level="10.1" data-path="data-scientism.html"><a href="data-scientism.html#the-age-of-big-data"><i class="fa fa-check"></i><b>10.1</b> The age of big data</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="data-scientism.html"><a href="data-scientism.html#randomly-spurious-correlation"><i class="fa fa-check"></i><b>10.1.1</b> Randomly (Spurious Correlation)</a></li>
<li class="chapter" data-level="10.1.2" data-path="data-scientism.html"><a href="data-scientism.html#programming-errors"><i class="fa fa-check"></i><b>10.1.2</b> Programming Errors</a></li>
<li class="chapter" data-level="10.1.3" data-path="data-scientism.html"><a href="data-scientism.html#p-hacking"><i class="fa fa-check"></i><b>10.1.3</b> P-Hacking</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="data-scientism.html"><a href="data-scientism.html#random-causal-impacts"><i class="fa fa-check"></i><b>10.2</b> Random Causal Impacts</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="data-scientism.html"><a href="data-scientism.html#iv"><i class="fa fa-check"></i><b>10.2.1</b> IV</a></li>
<li class="chapter" data-level="10.2.2" data-path="data-scientism.html"><a href="data-scientism.html#rdd"><i class="fa fa-check"></i><b>10.2.2</b> RDD</a></li>
<li class="chapter" data-level="10.2.3" data-path="data-scientism.html"><a href="data-scientism.html#did"><i class="fa fa-check"></i><b>10.2.3</b> DID</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Reproducible Research in R</b></span></li>
<li class="chapter" data-level="11" data-path="why.html"><a href="why.html"><i class="fa fa-check"></i><b>11</b> Why?</a>
<ul>
<li class="chapter" data-level="11.1" data-path="why.html"><a href="why.html#an-example-workflow"><i class="fa fa-check"></i><b>11.1</b> An example workflow</a></li>
<li class="chapter" data-level="11.2" data-path="why.html"><a href="why.html#an-alternative-workflow"><i class="fa fa-check"></i><b>11.2</b> An alternative workflow</a></li>
<li class="chapter" data-level="11.3" data-path="why.html"><a href="why.html#r-and-r-markdown"><i class="fa fa-check"></i><b>11.3</b> R and R-Markdown</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="small-projects.html"><a href="small-projects.html"><i class="fa fa-check"></i><b>12</b> Small Projects</a>
<ul>
<li class="chapter" data-level="12.1" data-path="small-projects.html"><a href="small-projects.html#an-r-code-chunk"><i class="fa fa-check"></i><b>12.1</b> An R Code Chunk</a></li>
<li class="chapter" data-level="12.2" data-path="small-projects.html"><a href="small-projects.html#an-r-markdown-document"><i class="fa fa-check"></i><b>12.2</b> An R Markdown Document</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="small-projects.html"><a href="small-projects.html#copypaste-example"><i class="fa fa-check"></i><b>12.2.1</b> Copy/Paste Example</a></li>
<li class="chapter" data-level="12.2.2" data-path="small-projects.html"><a href="small-projects.html#a-homework-example"><i class="fa fa-check"></i><b>12.2.2</b> A Homework Example</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="small-projects.html"><a href="small-projects.html#posters-and-slides"><i class="fa fa-check"></i><b>12.3</b> Posters and Slides</a></li>
<li class="chapter" data-level="12.4" data-path="small-projects.html"><a href="small-projects.html#getting-help-w-r-markdown"><i class="fa fa-check"></i><b>12.4</b> Getting help w/ R Markdown</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="large-projects.html"><a href="large-projects.html"><i class="fa fa-check"></i><b>13</b> Large Projects</a>
<ul>
<li class="chapter" data-level="13.1" data-path="large-projects.html"><a href="large-projects.html#makefile"><i class="fa fa-check"></i><b>13.1</b> MAKEFILE</a></li>
<li class="chapter" data-level="13.2" data-path="large-projects.html"><a href="large-projects.html#loggingsinking"><i class="fa fa-check"></i><b>13.2</b> Logging/Sinking</a></li>
<li class="chapter" data-level="13.3" data-path="large-projects.html"><a href="large-projects.html#class-projects"><i class="fa fa-check"></i><b>13.3</b> Class Projects</a></li>
<li class="chapter" data-level="13.4" data-path="large-projects.html"><a href="large-projects.html#debugging"><i class="fa fa-check"></i><b>13.4</b> Debugging</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="large-projects.html"><a href="large-projects.html#tracing-errors"><i class="fa fa-check"></i><b>13.4.1</b> Tracing Errors</a></li>
<li class="chapter" data-level="13.4.2" data-path="large-projects.html"><a href="large-projects.html#checking-problems"><i class="fa fa-check"></i><b>13.4.2</b> Checking problems</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="large-projects.html"><a href="large-projects.html#being-proactive"><i class="fa fa-check"></i><b>13.5</b> Being Proactive</a></li>
<li class="chapter" data-level="13.6" data-path="large-projects.html"><a href="large-projects.html#optimizing"><i class="fa fa-check"></i><b>13.6</b> Optimizing</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="large-projects.html"><a href="large-projects.html#benchmarking"><i class="fa fa-check"></i><b>13.6.1</b> Benchmarking</a></li>
<li class="chapter" data-level="13.6.2" data-path="large-projects.html"><a href="large-projects.html#bottlenecks"><i class="fa fa-check"></i><b>13.6.2</b> Bottlenecks</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="large-projects.html"><a href="large-projects.html#advanced-programming"><i class="fa fa-check"></i><b>13.7</b> Advanced Programming</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="shiny.html"><a href="shiny.html"><i class="fa fa-check"></i><b>14</b> Shiny</a>
<ul>
<li class="chapter" data-level="14.0.1" data-path="shiny.html"><a href="shiny.html#programming-guidance"><i class="fa fa-check"></i><b>14.0.1</b> Programming Guidance</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="software.html"><a href="software.html"><i class="fa fa-check"></i><b>15</b> Software</a>
<ul>
<li class="chapter" data-level="15.1" data-path="software.html"><a href="software.html#latest-versions"><i class="fa fa-check"></i><b>15.1</b> Latest versions</a></li>
<li class="chapter" data-level="15.2" data-path="software.html"><a href="software.html#stata"><i class="fa fa-check"></i><b>15.2</b> Stata</a></li>
<li class="chapter" data-level="15.3" data-path="software.html"><a href="software.html#general-workflow"><i class="fa fa-check"></i><b>15.3</b> General Workflow</a></li>
<li class="chapter" data-level="15.4" data-path="software.html"><a href="software.html#sweave"><i class="fa fa-check"></i><b>15.4</b> Sweave</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://sites.google.com/view/jordan-adamson" target="blank">Jordan Adamson</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="endogeneity-issues" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number"> 9</span> Endogeneity Issues<a href="endogeneity-issues.html#endogeneity-issues" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<hr />
<p>Just like many economic relationships are nonlinear, many economic variables are endogenous. By this we typically mean that <span class="math inline">\(X\)</span> is an outcome determined (or caused: <span class="math inline">\(\to\)</span>) by some other variable.</p>
<ul>
<li>If <span class="math inline">\(Y \to X\)</span>, then we have reverse causality</li>
<li>If <span class="math inline">\(Y \to X\)</span> and <span class="math inline">\(X \to Y\)</span>, then we have simultaneity</li>
<li>If <span class="math inline">\(Z\to Y\)</span> and either <span class="math inline">\(Z\to X\)</span> or <span class="math inline">\(X \to Z\)</span>, then we have omitted a potentially important variable</li>
</ul>
<p>These endogeneity issues imply <span class="math inline">\(X\)</span> and <span class="math inline">\(\epsilon\)</span> are correlated, which is a barrier to interpreting OLS estimates causally. (<span class="math inline">\(X\)</span> and <span class="math inline">\(\epsilon\)</span> may be correlated for other reasons too, such as when <span class="math inline">\(X\)</span> is measured with error.)</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="endogeneity-issues.html#cb265-1" tabindex="-1"></a><span class="do">## Simulate data with an endogeneity issue</span></span>
<span id="cb265-2"><a href="endogeneity-issues.html#cb265-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb265-3"><a href="endogeneity-issues.html#cb265-3" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n,<span class="dv">1</span>,.<span class="dv">5</span>)</span>
<span id="cb265-4"><a href="endogeneity-issues.html#cb265-4" tabindex="-1"></a>xy <span class="ot">&lt;-</span> <span class="fu">sapply</span>(z, <span class="cf">function</span>(zi){</span>
<span id="cb265-5"><a href="endogeneity-issues.html#cb265-5" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,zi,<span class="dv">1</span>)</span>
<span id="cb265-6"><a href="endogeneity-issues.html#cb265-6" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,zi<span class="sc">*</span><span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb265-7"><a href="endogeneity-issues.html#cb265-7" tabindex="-1"></a>    <span class="fu">c</span>(x,y)</span>
<span id="cb265-8"><a href="endogeneity-issues.html#cb265-8" tabindex="-1"></a>})</span>
<span id="cb265-9"><a href="endogeneity-issues.html#cb265-9" tabindex="-1"></a>xy <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>xy[<span class="dv">1</span>,],<span class="at">y=</span>xy[<span class="dv">2</span>,])</span>
<span id="cb265-10"><a href="endogeneity-issues.html#cb265-10" tabindex="-1"></a><span class="fu">plot</span>(y<span class="sc">~</span>x, <span class="at">data=</span>xy, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">grey</span>(.<span class="dv">5</span>,.<span class="dv">5</span>))</span>
<span id="cb265-11"><a href="endogeneity-issues.html#cb265-11" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y<span class="sc">~</span>x,<span class="at">data=</span>xy))</span></code></pre></div>
<p><img src="03-ROLS_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>With multiple linear regression, note that endogeneity biases are not just a problem your main variable. Suppose your interested in how <span class="math inline">\(x_{1}\)</span> affects <span class="math inline">\(y\)</span>, conditional on <span class="math inline">\(x_{2}\)</span>. Letting <span class="math inline">\(X=[x_{1}, x_{2}]\)</span>, you estimate
<span class="math display">\[\begin{eqnarray}
\hat{\beta}_{OLS} = [X&#39;X]^{-1}X&#39;y
\end{eqnarray}\]</span>
You paid special attention in your research design to find a case where <span class="math inline">\(x_{1}\)</span> is truly exogenous. Unfortunately, <span class="math inline">\(x_{2}\)</span> is correlated with the error term. (How unfair, I know, especially after all that work). Nonetheless,
<span class="math display">\[\begin{eqnarray}
\mathbb{E}[X&#39;\epsilon] =
\begin{bmatrix}
0 \\ \rho
\end{bmatrix}\\
\mathbb{E}[ \hat{\beta}_{OLS} - \beta] = [X&#39;X]^{-1} \begin{bmatrix}
0 \\ \rho
\end{bmatrix} =
\begin{bmatrix}
\rho_{1} \\ \rho_{2}
\end{bmatrix}
\end{eqnarray}\]</span>
The magnitude of the bias for <span class="math inline">\(x_{1}\)</span> thus depends on the correlations between <span class="math inline">\(x_{1}\)</span> and <span class="math inline">\(x_{2}\)</span> as well as <span class="math inline">\(x_{2}\)</span> and <span class="math inline">\(\epsilon\)</span>.</p>
<p>Three statistical tools: 2SLS, RDD, and DID, are designed to address endogeneity issues. The elementary versions of these tools are linear regression. Because there are many textbooks and online notebooks that explain these methods at both high and low levels of technical detail, they are not covered extensively in this notebook.</p>
<div id="two-stage-least-squares-2sls" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Two Stage Least Squares (2SLS)<a href="endogeneity-issues.html#two-stage-least-squares-2sls" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are many approaches to 2SLS, but I will focus on the seminal example in economics. Suppose we ask “what is the effect of price on quantity?” You can simply run a regression of one variable on another, but you will need much luck to correctly intepret the resulting coefficient. The reason is simultaneity: price and quantity mutually cause one another in markets.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<div id="competitive-market-equilibrium" class="section level3 hasAnchor" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Competitive Market Equilibrium<a href="endogeneity-issues.html#competitive-market-equilibrium" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>which has three structural relationships: (1) market supply is the sum of quantities supplied by individual firms at a given price, (2) market demand is the sum of quantities demanded by individual people at a given price, and (3) market supply equals market demand in equilibrium. Assuming market supply and demand are linear, we can write these three “structural equations” as
<span class="math display">\[\begin{eqnarray}
Q_{S}(P) &amp;=&amp; A_{S} + B_{S} P + E_{S},\\
Q_{D}(P) &amp;=&amp; A_{D} - B_{D} P + E_{D},\\
Q_{D} &amp;=&amp; Q_{S} = Q.
%%  $Q_{D}(P) = \sum_{i} q_{D}_{i}(P)$,
\end{eqnarray}\]</span>
This last equation implies a simultaneous “reduced form” relationship where both the price and the quantity are outcomes. With a linear parametric structure to these equations, we can use algebra to solve for the equilibrium price and quantity analytically as
<span class="math display">\[\begin{eqnarray}
P^{*} &amp;=&amp; \frac{A_{D}-A_{S}}{B_{D}+B_{S}} + \frac{E_{D} - E_{S}}{B_{D}+B_{S}}, \\
Q^{*} &amp;=&amp; \frac{A_{S}B_{D}+ A_{D}B_{S}}{B_{D}+B_{S}} + \frac{E_{S}B_{D}+ E_{D}B_{S}}{B_{D}+B_{S}}.
\end{eqnarray}\]</span></p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="endogeneity-issues.html#cb266-1" tabindex="-1"></a><span class="do">## Demand Curve Simulator</span></span>
<span id="cb266-2"><a href="endogeneity-issues.html#cb266-2" tabindex="-1"></a>qd_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p, <span class="at">Ad=</span><span class="dv">8</span>, <span class="at">Bd=</span><span class="sc">-</span>.<span class="dv">8</span>, <span class="at">Ed_sigma=</span>.<span class="dv">25</span>){</span>
<span id="cb266-3"><a href="endogeneity-issues.html#cb266-3" tabindex="-1"></a>    Qd <span class="ot">&lt;-</span> Ad <span class="sc">+</span> Bd<span class="sc">*</span>p <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,Ed_sigma)</span>
<span id="cb266-4"><a href="endogeneity-issues.html#cb266-4" tabindex="-1"></a>    <span class="fu">return</span>(Qd)</span>
<span id="cb266-5"><a href="endogeneity-issues.html#cb266-5" tabindex="-1"></a>}</span>
<span id="cb266-6"><a href="endogeneity-issues.html#cb266-6" tabindex="-1"></a></span>
<span id="cb266-7"><a href="endogeneity-issues.html#cb266-7" tabindex="-1"></a><span class="do">## Supply Curve Simulator</span></span>
<span id="cb266-8"><a href="endogeneity-issues.html#cb266-8" tabindex="-1"></a>qs_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p, <span class="at">As=</span><span class="sc">-</span><span class="dv">8</span>, <span class="at">Bs=</span><span class="dv">1</span>, <span class="at">Es_sigma=</span>.<span class="dv">25</span>){</span>
<span id="cb266-9"><a href="endogeneity-issues.html#cb266-9" tabindex="-1"></a>    Qs <span class="ot">&lt;-</span> As <span class="sc">+</span> Bs<span class="sc">*</span>p <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,Es_sigma)</span>
<span id="cb266-10"><a href="endogeneity-issues.html#cb266-10" tabindex="-1"></a>    <span class="fu">return</span>(Qs)</span>
<span id="cb266-11"><a href="endogeneity-issues.html#cb266-11" tabindex="-1"></a>}</span>
<span id="cb266-12"><a href="endogeneity-issues.html#cb266-12" tabindex="-1"></a></span>
<span id="cb266-13"><a href="endogeneity-issues.html#cb266-13" tabindex="-1"></a><span class="do">## Quantity Supplied and Demanded at 3 Prices</span></span>
<span id="cb266-14"><a href="endogeneity-issues.html#cb266-14" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">P=</span><span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">D=</span><span class="fu">qd_fun</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>), <span class="at">S=</span><span class="fu">qs_fun</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>))</span></code></pre></div>
<pre><code>##       P           D         S
## [1,]  8  1.55025295 0.4470546
## [2,]  9  0.75025295 1.4470546
## [3,] 10 -0.04974705 2.4470546</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="endogeneity-issues.html#cb268-1" tabindex="-1"></a><span class="do">## Market Equilibrium Finder</span></span>
<span id="cb268-2"><a href="endogeneity-issues.html#cb268-2" tabindex="-1"></a>eq_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(demand, supply, P){</span>
<span id="cb268-3"><a href="endogeneity-issues.html#cb268-3" tabindex="-1"></a>    <span class="do">## Compute EQ (what we observe)</span></span>
<span id="cb268-4"><a href="endogeneity-issues.html#cb268-4" tabindex="-1"></a>    eq_id <span class="ot">&lt;-</span> <span class="fu">which.min</span>( <span class="fu">abs</span>(demand<span class="sc">-</span>supply) )</span>
<span id="cb268-5"><a href="endogeneity-issues.html#cb268-5" tabindex="-1"></a>    eq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">P=</span>P[eq_id], <span class="at">Q=</span>demand[eq_id]) </span>
<span id="cb268-6"><a href="endogeneity-issues.html#cb268-6" tabindex="-1"></a>    <span class="fu">return</span>(eq)</span>
<span id="cb268-7"><a href="endogeneity-issues.html#cb268-7" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="endogeneity-issues.html#cb269-1" tabindex="-1"></a><span class="do">## Simulations Parameters</span></span>
<span id="cb269-2"><a href="endogeneity-issues.html#cb269-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">300</span> <span class="do">## Number of Market Interactions</span></span>
<span id="cb269-3"><a href="endogeneity-issues.html#cb269-3" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="at">by=</span>.<span class="dv">01</span>) <span class="do">## Price Range to Consider</span></span>
<span id="cb269-4"><a href="endogeneity-issues.html#cb269-4" tabindex="-1"></a></span>
<span id="cb269-5"><a href="endogeneity-issues.html#cb269-5" tabindex="-1"></a></span>
<span id="cb269-6"><a href="endogeneity-issues.html#cb269-6" tabindex="-1"></a><span class="do">## Generate Data from Competitive Market  </span></span>
<span id="cb269-7"><a href="endogeneity-issues.html#cb269-7" tabindex="-1"></a><span class="do">## Plot Underlying Process</span></span>
<span id="cb269-8"><a href="endogeneity-issues.html#cb269-8" tabindex="-1"></a><span class="fu">plot.new</span>()</span>
<span id="cb269-9"><a href="endogeneity-issues.html#cb269-9" tabindex="-1"></a><span class="fu">plot.window</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="at">ylim=</span><span class="fu">range</span>(P))</span>
<span id="cb269-10"><a href="endogeneity-issues.html#cb269-10" tabindex="-1"></a>EQ1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="cf">function</span>(n){</span>
<span id="cb269-11"><a href="endogeneity-issues.html#cb269-11" tabindex="-1"></a>    <span class="do">## Market Data Generating Process</span></span>
<span id="cb269-12"><a href="endogeneity-issues.html#cb269-12" tabindex="-1"></a>    demand <span class="ot">&lt;-</span> <span class="fu">qd_fun</span>(P)</span>
<span id="cb269-13"><a href="endogeneity-issues.html#cb269-13" tabindex="-1"></a>    supply <span class="ot">&lt;-</span> <span class="fu">qs_fun</span>(P)</span>
<span id="cb269-14"><a href="endogeneity-issues.html#cb269-14" tabindex="-1"></a>    eq <span class="ot">&lt;-</span> <span class="fu">eq_fun</span>(demand, supply, P)    </span>
<span id="cb269-15"><a href="endogeneity-issues.html#cb269-15" tabindex="-1"></a>    <span class="do">## Plot Theoretical Supply and Demand</span></span>
<span id="cb269-16"><a href="endogeneity-issues.html#cb269-16" tabindex="-1"></a>    <span class="fu">lines</span>(demand, P, <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">01</span>))</span>
<span id="cb269-17"><a href="endogeneity-issues.html#cb269-17" tabindex="-1"></a>    <span class="fu">lines</span>(supply, P, <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">01</span>))</span>
<span id="cb269-18"><a href="endogeneity-issues.html#cb269-18" tabindex="-1"></a>    <span class="fu">points</span>(eq[<span class="dv">2</span>], eq[<span class="dv">1</span>], <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">05</span>), <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb269-19"><a href="endogeneity-issues.html#cb269-19" tabindex="-1"></a>    <span class="do">## Save Data</span></span>
<span id="cb269-20"><a href="endogeneity-issues.html#cb269-20" tabindex="-1"></a>    <span class="fu">return</span>(eq)</span>
<span id="cb269-21"><a href="endogeneity-issues.html#cb269-21" tabindex="-1"></a>})</span>
<span id="cb269-22"><a href="endogeneity-issues.html#cb269-22" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>)</span>
<span id="cb269-23"><a href="endogeneity-issues.html#cb269-23" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb269-24"><a href="endogeneity-issues.html#cb269-24" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&#39;Quantity&#39;</span>,<span class="dv">1</span>, <span class="at">line=</span><span class="dv">2</span>)</span>
<span id="cb269-25"><a href="endogeneity-issues.html#cb269-25" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&#39;Price&#39;</span>,<span class="dv">2</span>, <span class="at">line=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="03-ROLS_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>Now regress quantity (“Y”) on price (“X”): <span class="math inline">\(\beta_{OLS} = \frac{Cov(Q^{*}, P^{*})}{ Var(P^{*})}\)</span>. You get a number back, but it is hard to interpret meaningfully.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="endogeneity-issues.html#cb270-1" tabindex="-1"></a><span class="do">## Analyze Market Data</span></span>
<span id="cb270-2"><a href="endogeneity-issues.html#cb270-2" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(EQ1), <span class="at">cost=</span><span class="st">&#39;1&#39;</span>)</span>
<span id="cb270-3"><a href="endogeneity-issues.html#cb270-3" tabindex="-1"></a>reg1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Q<span class="sc">~</span>P, <span class="at">data=</span>dat1)</span>
<span id="cb270-4"><a href="endogeneity-issues.html#cb270-4" tabindex="-1"></a><span class="fu">summary</span>(reg1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Q ~ P, data = dat1)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.47807 -0.11037  0.00182  0.10753  0.47874 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)  0.19412    0.45317   0.428    0.669
## P            0.07762    0.05096   1.523    0.129
## 
## Residual standard error: 0.1736 on 298 degrees of freedom
## Multiple R-squared:  0.007727,   Adjusted R-squared:  0.004397 
## F-statistic:  2.32 on 1 and 298 DF,  p-value: 0.1287</code></pre>
<p>This simple derivation has a profound insight: price-quantity data does not generally tell you how price affects quantity (or vice-versa). Moreover, it also clarifies that our initial question “what is the effect of price on quantity?” is misguided. We could more sensibly ask “what is the effect of price on quantity supplied?” or “what is the effect of price on quantity demanded?”</p>
<p>If you have exogeneous variation on one side of the market, “shocks”, you can get information on the other. For example, lower costs shift out supply (more is produced at given price), allowing you to trace out part of a demand curve.
Experimental manipulation of <span class="math inline">\(A_{S}\)</span> leads to
<span class="math display">\[\begin{eqnarray}
\label{eqn:comp_market_statics}
\frac{d P^{*}}{d A_{S}} = \frac{-1}{B_{D}+B_{S}}, \\
\frac{d Q^{*}}{d A_{S}} = \frac{B_{D}}{B_{D}+B_{S}}.
\end{eqnarray}\]</span>
So, absent any other changes, we could recover <span class="math inline">\(-B_{D}=d Q^{*}/d P^{*}\)</span>. In this case, the supply shock has identified the demand slope.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="endogeneity-issues.html#cb272-1" tabindex="-1"></a><span class="do">## New Observations After Cost Change</span></span>
<span id="cb272-2"><a href="endogeneity-issues.html#cb272-2" tabindex="-1"></a>EQ2 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="cf">function</span>(n){</span>
<span id="cb272-3"><a href="endogeneity-issues.html#cb272-3" tabindex="-1"></a>    demand <span class="ot">&lt;-</span> <span class="fu">qd_fun</span>(P)</span>
<span id="cb272-4"><a href="endogeneity-issues.html#cb272-4" tabindex="-1"></a>    supply2 <span class="ot">&lt;-</span> <span class="fu">qs_fun</span>(P, <span class="at">As=</span><span class="sc">-</span><span class="fl">6.5</span>) <span class="do">## More Supplied at Given Price</span></span>
<span id="cb272-5"><a href="endogeneity-issues.html#cb272-5" tabindex="-1"></a>    eq <span class="ot">&lt;-</span> <span class="fu">eq_fun</span>(demand, supply2, P)</span>
<span id="cb272-6"><a href="endogeneity-issues.html#cb272-6" tabindex="-1"></a>    <span class="fu">return</span>(eq)</span>
<span id="cb272-7"><a href="endogeneity-issues.html#cb272-7" tabindex="-1"></a>    <span class="do">## lines(supply2, P, col=rgb(0,0,1,.01))</span></span>
<span id="cb272-8"><a href="endogeneity-issues.html#cb272-8" tabindex="-1"></a>    <span class="co">#points(eq[2], eq[1], col=rgb(0,0,1,.05), pch=16)   </span></span>
<span id="cb272-9"><a href="endogeneity-issues.html#cb272-9" tabindex="-1"></a>})</span>
<span id="cb272-10"><a href="endogeneity-issues.html#cb272-10" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(EQ2), <span class="at">cost=</span><span class="st">&#39;2&#39;</span>)</span>
<span id="cb272-11"><a href="endogeneity-issues.html#cb272-11" tabindex="-1"></a></span>
<span id="cb272-12"><a href="endogeneity-issues.html#cb272-12" tabindex="-1"></a><span class="do">## Plot Market Data </span></span>
<span id="cb272-13"><a href="endogeneity-issues.html#cb272-13" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dat1, dat2)</span>
<span id="cb272-14"><a href="endogeneity-issues.html#cb272-14" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">as.numeric</span>(dat2<span class="sc">$</span>cost)<span class="sc">==</span><span class="dv">2</span>, <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">2</span>), <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">2</span>))</span>
<span id="cb272-15"><a href="endogeneity-issues.html#cb272-15" tabindex="-1"></a><span class="fu">plot.new</span>()</span>
<span id="cb272-16"><a href="endogeneity-issues.html#cb272-16" tabindex="-1"></a><span class="fu">plot.window</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="at">ylim=</span><span class="fu">range</span>(P))</span>
<span id="cb272-17"><a href="endogeneity-issues.html#cb272-17" tabindex="-1"></a><span class="fu">points</span>(dat2<span class="sc">$</span>Q, dat2<span class="sc">$</span>P, <span class="at">col=</span>cols, <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb272-18"><a href="endogeneity-issues.html#cb272-18" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>)</span>
<span id="cb272-19"><a href="endogeneity-issues.html#cb272-19" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb272-20"><a href="endogeneity-issues.html#cb272-20" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&#39;Quantity&#39;</span>,<span class="dv">1</span>, <span class="at">line=</span><span class="dv">2</span>)</span>
<span id="cb272-21"><a href="endogeneity-issues.html#cb272-21" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&#39;Price&#39;</span>,<span class="dv">2</span>, <span class="at">line=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="03-ROLS_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>We are not quite done yet. We have pooled two datasets that are seperately problematic, and the noisiness of the process within each group affects our OLS estimate: <span class="math inline">\(Cov(Q^{*}, P^{*}) / Var(P^{*})\)</span>.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="endogeneity-issues.html#cb273-1" tabindex="-1"></a><span class="do">## Not exactly right, but at least right sign</span></span>
<span id="cb273-2"><a href="endogeneity-issues.html#cb273-2" tabindex="-1"></a>reg2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Q<span class="sc">~</span>P, <span class="at">data=</span>dat2)</span>
<span id="cb273-3"><a href="endogeneity-issues.html#cb273-3" tabindex="-1"></a><span class="fu">summary</span>(reg2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Q ~ P, data = dat2)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.85249 -0.15889  0.00686  0.15636  0.71544 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   6.7064     0.1748   38.36   &lt;2e-16 ***
## P            -0.6473     0.0206  -31.43   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2321 on 598 degrees of freedom
## Multiple R-squared:  0.6229, Adjusted R-squared:  0.6222 
## F-statistic: 987.6 on 1 and 598 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Although the individual observations are noisy, we can compute the change in the expected values $ d [Q^{*}] / d [P^{*}] =-B_{D}$. Empirically, this is estimated via the change in average value.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="endogeneity-issues.html#cb275-1" tabindex="-1"></a><span class="do">## Wald (1940) Estimate</span></span>
<span id="cb275-2"><a href="endogeneity-issues.html#cb275-2" tabindex="-1"></a>dat_mean <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb275-3"><a href="endogeneity-issues.html#cb275-3" tabindex="-1"></a>    <span class="fu">colMeans</span>(dat2[dat2<span class="sc">$</span>cost<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]),</span>
<span id="cb275-4"><a href="endogeneity-issues.html#cb275-4" tabindex="-1"></a>    <span class="fu">colMeans</span>(dat2[dat2<span class="sc">$</span>cost<span class="sc">==</span><span class="dv">2</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]))</span>
<span id="cb275-5"><a href="endogeneity-issues.html#cb275-5" tabindex="-1"></a>dat_mean</span></code></pre></div>
<pre><code>##             P         Q
## [1,] 8.891033 0.8842678
## [2,] 8.058267 1.5574984</code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="endogeneity-issues.html#cb277-1" tabindex="-1"></a>B_est <span class="ot">&lt;-</span> <span class="fu">diff</span>(dat_mean[,<span class="dv">2</span>])<span class="sc">/</span><span class="fu">diff</span>(dat_mean[,<span class="dv">1</span>])</span>
<span id="cb277-2"><a href="endogeneity-issues.html#cb277-2" tabindex="-1"></a><span class="fu">round</span>(B_est, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] -0.81</code></pre>
<p>We can also seperately recover <span class="math inline">\(\frac{d \mathbb{E}[Q^{*}]}{d \mathbb{E}[A_{S}]}\)</span> and <span class="math inline">\(\frac{d \mathbb{E}[P^{*}]}{d \mathbb{E}[A_{S}]}\)</span> from seperate regressions</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="endogeneity-issues.html#cb279-1" tabindex="-1"></a><span class="do">## Heckman (2000, p.58) Estimate</span></span>
<span id="cb279-2"><a href="endogeneity-issues.html#cb279-2" tabindex="-1"></a>ols_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(P<span class="sc">~</span>cost, <span class="at">data=</span>dat2)</span>
<span id="cb279-3"><a href="endogeneity-issues.html#cb279-3" tabindex="-1"></a>ols_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Q<span class="sc">~</span>cost, <span class="at">data=</span>dat2)</span>
<span id="cb279-4"><a href="endogeneity-issues.html#cb279-4" tabindex="-1"></a>B_est2 <span class="ot">&lt;-</span> <span class="fu">coef</span>(ols_2)<span class="sc">/</span><span class="fu">coef</span>(ols_1)</span>
<span id="cb279-5"><a href="endogeneity-issues.html#cb279-5" tabindex="-1"></a><span class="fu">round</span>(B_est2[[<span class="dv">2</span>]],<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] -0.81</code></pre>
<p>Mathematically, we can also do this in a single step by exploiting linear algebra:
<span class="math display">\[\begin{eqnarray}
\frac{ Cov(Q^{*},A_{S})}{ V(A_{S}) } / \frac{ Cov(P^{*},A_{S})}{ V(A_{S}) } =  \frac{Cov(Q^{*},A_{S} )}{ Cov(P^{*},A_{S})}.
\end{eqnarray}\]</span></p>
<p>Alternatively, we can recover the same estimate using an instrumental variables regression that has two equations:
<span class="math display">\[\begin{eqnarray}
P &amp;=&amp; \alpha_{1} + A_{S} \beta_{1} + \epsilon_{1} \\
Q &amp;=&amp; \alpha_{2} + \hat{P} \beta_{2} + \epsilon_{2}.
\end{eqnarray}\]</span>
In the first regression, we estimate the average effect of the cost shock on prices. In the second equation, we estimate how the average effect of prices <em>which are exogenous to demand</em> affect quantity demanded. To see this, first substitute the equilibrium condition into the supply equation: <span class="math inline">\(Q_{D}=Q_{S}=A_{S}+B_{S} P + E_{S}\)</span>, lets us rewrite <span class="math inline">\(P\)</span> as a function of <span class="math inline">\(Q_{D}\)</span>. This yields two theoretical equations
<span class="math display">\[\begin{eqnarray}
\label{eqn:linear_supply_iv}
P &amp;=&amp; -\frac{A_{S}}{{B_{S}}} + \frac{Q_{D}}{B_{S}} - \frac{E_{S}}{B_{S}} \\
\label{eqn:linear_demand_iv}
Q_{D} &amp;=&amp;  A_{D} + B_{D} P  + E_{D}.
\end{eqnarray}\]</span></p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="endogeneity-issues.html#cb281-1" tabindex="-1"></a><span class="do">## Two Stage Least Squares Estimate</span></span>
<span id="cb281-2"><a href="endogeneity-issues.html#cb281-2" tabindex="-1"></a>ols_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(P<span class="sc">~</span>cost, <span class="at">data=</span>dat2)</span>
<span id="cb281-3"><a href="endogeneity-issues.html#cb281-3" tabindex="-1"></a>dat2_new  <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat2, <span class="at">Phat=</span><span class="fu">predict</span>(ols_1))</span>
<span id="cb281-4"><a href="endogeneity-issues.html#cb281-4" tabindex="-1"></a>reg_2sls <span class="ot">&lt;-</span> <span class="fu">lm</span>(Q<span class="sc">~</span>Phat, <span class="at">data=</span>dat2_new)</span>
<span id="cb281-5"><a href="endogeneity-issues.html#cb281-5" tabindex="-1"></a><span class="fu">summary</span>(reg_2sls)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Q ~ Phat, data = dat2_new)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.49025 -0.11558  0.00212  0.10914  0.48176 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  8.07201    0.14206   56.82   &lt;2e-16 ***
## Phat        -0.80843    0.01674  -48.28   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1708 on 598 degrees of freedom
## Multiple R-squared:  0.7959, Adjusted R-squared:  0.7955 
## F-statistic:  2331 on 1 and 598 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="endogeneity-issues.html#cb283-1" tabindex="-1"></a><span class="do">## One Stage Instrumental Variables Estimate</span></span>
<span id="cb283-2"><a href="endogeneity-issues.html#cb283-2" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb283-3"><a href="endogeneity-issues.html#cb283-3" tabindex="-1"></a>reg2_iv <span class="ot">&lt;-</span> <span class="fu">feols</span>(Q<span class="sc">~</span><span class="dv">1</span><span class="sc">|</span>P<span class="sc">~</span>cost, <span class="at">data=</span>dat2)</span>
<span id="cb283-4"><a href="endogeneity-issues.html#cb283-4" tabindex="-1"></a><span class="fu">summary</span>(reg2_iv)</span></code></pre></div>
<pre><code>## TSLS estimation, Dep. Var.: Q, Endo.: P, Instr.: cost
## Second stage: Dep. Var.: Q
## Observations: 600 
## Standard-errors: IID 
##              Estimate Std. Error  t value  Pr(&gt;|t|)    
## (Intercept)  8.072014   0.202736  39.8155 &lt; 2.2e-16 ***
## fit_P       -0.808426   0.023894 -33.8342 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## RMSE: 0.243292   Adj. R2: 0.583561
## F-test (1st stage), P: stat = 2,708.3, p &lt; 2.2e-16, on 1 and 598 DoF.
##            Wu-Hausman: stat =   515.9, p &lt; 2.2e-16, on 1 and 597 DoF.</code></pre>
<p><strong>Within Group Variance</strong>
You can experiment with the effect of different variances on both OLS and IV in the code below. And note that if we had multiple supply shifts and recorded their magnitudes, then we could recover more information about demand, perhaps tracing it out entirely.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="endogeneity-issues.html#cb285-1" tabindex="-1"></a><span class="do">## Examine</span></span>
<span id="cb285-2"><a href="endogeneity-issues.html#cb285-2" tabindex="-1"></a>Egrid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">Ed_sigma=</span><span class="fu">c</span>(.<span class="dv">001</span>, .<span class="dv">25</span>, <span class="dv">1</span>), <span class="at">Es_sigma=</span><span class="fu">c</span>(.<span class="dv">001</span>, .<span class="dv">25</span>, <span class="dv">1</span>))</span>
<span id="cb285-3"><a href="endogeneity-issues.html#cb285-3" tabindex="-1"></a></span>
<span id="cb285-4"><a href="endogeneity-issues.html#cb285-4" tabindex="-1"></a>Egrid_regs <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Egrid), <span class="cf">function</span>(i){</span>
<span id="cb285-5"><a href="endogeneity-issues.html#cb285-5" tabindex="-1"></a>    Ed_sigma <span class="ot">&lt;-</span> Egrid[i,<span class="dv">1</span>]</span>
<span id="cb285-6"><a href="endogeneity-issues.html#cb285-6" tabindex="-1"></a>    Es_sigma <span class="ot">&lt;-</span> Egrid[i,<span class="dv">2</span>]    </span>
<span id="cb285-7"><a href="endogeneity-issues.html#cb285-7" tabindex="-1"></a>    EQ1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="cf">function</span>(n){</span>
<span id="cb285-8"><a href="endogeneity-issues.html#cb285-8" tabindex="-1"></a>        demand <span class="ot">&lt;-</span> <span class="fu">qd_fun</span>(P, <span class="at">Ed_sigma=</span>Ed_sigma)</span>
<span id="cb285-9"><a href="endogeneity-issues.html#cb285-9" tabindex="-1"></a>        supply <span class="ot">&lt;-</span> <span class="fu">qs_fun</span>(P, <span class="at">Es_sigma=</span>Es_sigma)</span>
<span id="cb285-10"><a href="endogeneity-issues.html#cb285-10" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">eq_fun</span>(demand, supply, P))</span>
<span id="cb285-11"><a href="endogeneity-issues.html#cb285-11" tabindex="-1"></a>    })</span>
<span id="cb285-12"><a href="endogeneity-issues.html#cb285-12" tabindex="-1"></a>    EQ2 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="cf">function</span>(n){</span>
<span id="cb285-13"><a href="endogeneity-issues.html#cb285-13" tabindex="-1"></a>        demand <span class="ot">&lt;-</span> <span class="fu">qd_fun</span>(P,<span class="at">Ed_sigma=</span>Ed_sigma)</span>
<span id="cb285-14"><a href="endogeneity-issues.html#cb285-14" tabindex="-1"></a>        supply2 <span class="ot">&lt;-</span> <span class="fu">qs_fun</span>(P, <span class="at">As=</span><span class="sc">-</span><span class="fl">6.5</span>,<span class="at">Es_sigma=</span>Es_sigma)</span>
<span id="cb285-15"><a href="endogeneity-issues.html#cb285-15" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">eq_fun</span>(demand, supply2, P))</span>
<span id="cb285-16"><a href="endogeneity-issues.html#cb285-16" tabindex="-1"></a>    })</span>
<span id="cb285-17"><a href="endogeneity-issues.html#cb285-17" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb285-18"><a href="endogeneity-issues.html#cb285-18" tabindex="-1"></a>        <span class="fu">data.frame</span>(<span class="fu">t</span>(EQ1), <span class="at">cost=</span><span class="st">&#39;1&#39;</span>),</span>
<span id="cb285-19"><a href="endogeneity-issues.html#cb285-19" tabindex="-1"></a>        <span class="fu">data.frame</span>(<span class="fu">t</span>(EQ2), <span class="at">cost=</span><span class="st">&#39;2&#39;</span>))</span>
<span id="cb285-20"><a href="endogeneity-issues.html#cb285-20" tabindex="-1"></a>    <span class="fu">return</span>(dat)</span>
<span id="cb285-21"><a href="endogeneity-issues.html#cb285-21" tabindex="-1"></a>})</span>
<span id="cb285-22"><a href="endogeneity-issues.html#cb285-22" tabindex="-1"></a>Egrid_OLS <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Egrid_regs, <span class="cf">function</span>(dat) <span class="fu">coef</span>( <span class="fu">lm</span>(Q<span class="sc">~</span>P, <span class="at">data=</span>dat)))</span>
<span id="cb285-23"><a href="endogeneity-issues.html#cb285-23" tabindex="-1"></a>Egrid_IV <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Egrid_regs, <span class="cf">function</span>(dat) <span class="fu">coef</span>( <span class="fu">feols</span>(Q<span class="sc">~</span><span class="dv">1</span><span class="sc">|</span>P<span class="sc">~</span>cost, <span class="at">data=</span>dat)))</span>
<span id="cb285-24"><a href="endogeneity-issues.html#cb285-24" tabindex="-1"></a></span>
<span id="cb285-25"><a href="endogeneity-issues.html#cb285-25" tabindex="-1"></a><span class="co">#cbind(Egrid, coef_OLS=t(Egrid_OLS)[,2], coef_IV=t(Egrid_IV)[,2])</span></span>
<span id="cb285-26"><a href="endogeneity-issues.html#cb285-26" tabindex="-1"></a><span class="fu">lapply</span>( <span class="fu">list</span>(Egrid_OLS, Egrid_IV), <span class="cf">function</span>(ei){</span>
<span id="cb285-27"><a href="endogeneity-issues.html#cb285-27" tabindex="-1"></a>    Emat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(ei[<span class="dv">2</span>,],<span class="dv">3</span>,<span class="dv">3</span>)</span>
<span id="cb285-28"><a href="endogeneity-issues.html#cb285-28" tabindex="-1"></a>    <span class="fu">rownames</span>(Emat) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;Ed_sigma.&#39;</span>,<span class="fu">c</span>(.<span class="dv">001</span>, .<span class="dv">25</span>, <span class="dv">1</span>))</span>
<span id="cb285-29"><a href="endogeneity-issues.html#cb285-29" tabindex="-1"></a>    <span class="fu">colnames</span>(Emat) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;Es_sigma.&#39;</span>,<span class="fu">c</span>(.<span class="dv">001</span>, .<span class="dv">25</span>, <span class="dv">1</span>))</span>
<span id="cb285-30"><a href="endogeneity-issues.html#cb285-30" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">round</span>(Emat,<span class="dv">2</span>))</span>
<span id="cb285-31"><a href="endogeneity-issues.html#cb285-31" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## [[1]]
##                Es_sigma.0.001 Es_sigma.0.25 Es_sigma.1
## Ed_sigma.0.001          -0.80         -0.80      -0.80
## Ed_sigma.0.25           -0.61         -0.67      -0.72
## Ed_sigma.1               0.37          0.32      -0.10
## 
## [[2]]
##                Es_sigma.0.001 Es_sigma.0.25 Es_sigma.1
## Ed_sigma.0.001          -0.80         -0.80      -0.80
## Ed_sigma.0.25           -0.79         -0.81      -0.78
## Ed_sigma.1              -0.91         -0.79      -0.59</code></pre>
<p><strong>Caveats</strong>
Regression analysis with instrumental variables can be very insightful and is applied to many different areas. But I also want to stress some caveats about using IV in practice.</p>
<p>We always get coefficients back when running <code>feols</code>, and sometimes the computed p-values are very small. The interpretation of those numbers rests on many assumptions:</p>
<ul>
<li>only supply was affected. (Instrument exogeneity)</li>
<li>the shock is large enough to be picked up statistically. (Instrument relevance)</li>
<li>supply and demand are linear and additively seperable. (Functional form)</li>
<li>we were not cycling through different IV’s. (Multiple hypotheses)</li>
</ul>
<p>We are rarely sure that all of these assumptions hold, and this is one reason why researchers often also report their OLS results. In practice, it is hard to find a good instrument. For example, suppose we asked “what is the effect of wages on police demanded?” and examined a policy which lowered the educational requirements from 4 years to 2 to become an officer. This increases the labour supply, but it also affects the demand curve through ``general equilibrium’’: as some of the new officers were potentially criminals. With fewer criminals, the demand for likely police shifts down.</p>
<p>In practice, it is also easy to find a bad instrument. As you search for good instruments, sometimes random noise will appear like a good instrument (Spurious Instruments). Worse, if you search for a good instrument for too long, you can also be led astray from important questions (Spurious Research).</p>
</div>
</div>
<div id="regression-discontinuitieskink-rdrk" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Regression Discontinuities/Kink (RD/RK)<a href="endogeneity-issues.html#regression-discontinuitieskink-rdrk" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The basic idea here is to examine how a variable changes in response to an exogenous shock. The Regression Discontinuities estimate of the cost shock is the difference in the outcome variable just before and just after the shock. We now turn to our canonical competitive market example. The RD estimate is the difference between the lines at <span class="math inline">\(T=300\)</span>.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="endogeneity-issues.html#cb287-1" tabindex="-1"></a>dat2<span class="sc">$</span>T <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dat2)</span>
<span id="cb287-2"><a href="endogeneity-issues.html#cb287-2" tabindex="-1"></a></span>
<span id="cb287-3"><a href="endogeneity-issues.html#cb287-3" tabindex="-1"></a><span class="fu">plot</span>(P<span class="sc">~</span>T, dat2, <span class="at">main=</span><span class="st">&#39;Effect of Cost Shock on Price&#39;</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">5</span>))</span>
<span id="cb287-4"><a href="endogeneity-issues.html#cb287-4" tabindex="-1"></a>regP1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(P<span class="sc">~</span>T, dat2[dat2<span class="sc">$</span>cost<span class="sc">==</span><span class="dv">1</span>,]) </span>
<span id="cb287-5"><a href="endogeneity-issues.html#cb287-5" tabindex="-1"></a><span class="fu">lines</span>(regP1<span class="sc">$</span>model<span class="sc">$</span>T, <span class="fu">predict</span>(regP1), <span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb287-6"><a href="endogeneity-issues.html#cb287-6" tabindex="-1"></a>regP2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(P<span class="sc">~</span>T, dat2[dat2<span class="sc">$</span>cost<span class="sc">==</span><span class="dv">2</span>,]) </span>
<span id="cb287-7"><a href="endogeneity-issues.html#cb287-7" tabindex="-1"></a><span class="fu">lines</span>(regP2<span class="sc">$</span>model<span class="sc">$</span>T, <span class="fu">predict</span>(regP2), <span class="at">col=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="03-ROLS_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="endogeneity-issues.html#cb288-1" tabindex="-1"></a>regP <span class="ot">&lt;-</span> <span class="fu">lm</span>(P<span class="sc">~</span>T<span class="sc">*</span>cost, dat2)</span>
<span id="cb288-2"><a href="endogeneity-issues.html#cb288-2" tabindex="-1"></a><span class="fu">summary</span>(regP)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = P ~ T * cost, data = dat2)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.59836 -0.12829 -0.00097  0.13200  0.56243 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  8.894e+00  2.272e-02 391.364   &lt;2e-16 ***
## T           -1.701e-05  1.309e-04  -0.130    0.897    
## cost2       -8.327e-01  6.419e-02 -12.972   &lt;2e-16 ***
## T:cost2      1.122e-05  1.851e-04   0.061    0.952    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1963 on 596 degrees of freedom
## Multiple R-squared:  0.8191, Adjusted R-squared:  0.8182 
## F-statistic: 899.8 on 3 and 596 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="endogeneity-issues.html#cb290-1" tabindex="-1"></a><span class="fu">plot</span>(Q<span class="sc">~</span>T, dat2, <span class="at">main=</span><span class="st">&#39;Effect of Cost Shock on Quantity&#39;</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">5</span>))</span>
<span id="cb290-2"><a href="endogeneity-issues.html#cb290-2" tabindex="-1"></a>regQ1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Q<span class="sc">~</span>T, dat2[dat2<span class="sc">$</span>cost<span class="sc">==</span><span class="dv">1</span>,]) </span>
<span id="cb290-3"><a href="endogeneity-issues.html#cb290-3" tabindex="-1"></a><span class="fu">lines</span>(regQ1<span class="sc">$</span>model<span class="sc">$</span>T, <span class="fu">predict</span>(regQ1), <span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb290-4"><a href="endogeneity-issues.html#cb290-4" tabindex="-1"></a>regQ2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Q<span class="sc">~</span>T, dat2[dat2<span class="sc">$</span>cost<span class="sc">==</span><span class="dv">2</span>,]) </span>
<span id="cb290-5"><a href="endogeneity-issues.html#cb290-5" tabindex="-1"></a><span class="fu">lines</span>(regQ2<span class="sc">$</span>model<span class="sc">$</span>T, <span class="fu">predict</span>(regQ2), <span class="at">col=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="03-ROLS_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="endogeneity-issues.html#cb291-1" tabindex="-1"></a>regQ <span class="ot">&lt;-</span> <span class="fu">lm</span>(Q<span class="sc">~</span>T<span class="sc">*</span>cost, dat2)</span>
<span id="cb291-2"><a href="endogeneity-issues.html#cb291-2" tabindex="-1"></a><span class="fu">summary</span>(regQ)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Q ~ T * cost, data = dat2)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.50383 -0.11048  0.00316  0.11386  0.45901 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.9239469  0.0197061  46.886   &lt;2e-16 ***
## T           -0.0002636  0.0001135  -2.323   0.0205 *  
## cost2        0.6029118  0.0556679  10.831   &lt;2e-16 ***
## T:cost2      0.0003317  0.0001605   2.066   0.0392 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1702 on 596 degrees of freedom
## Multiple R-squared:  0.7978, Adjusted R-squared:  0.7968 
## F-statistic: 783.9 on 3 and 596 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Remember that this is effect is <em>local</em>: different magnitudes of the cost shock or different demand curves generally yeild different estimates.</p>
</div>
<div id="difference-in-differences-did" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Difference in Differences (DID)<a href="endogeneity-issues.html#difference-in-differences-did" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The basic idea here is to examine how a variable changes in response to an exogenous shock, <em>compared to a control group</em>.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="endogeneity-issues.html#cb293-1" tabindex="-1"></a>EQ3 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N), <span class="cf">function</span>(n){</span>
<span id="cb293-2"><a href="endogeneity-issues.html#cb293-2" tabindex="-1"></a></span>
<span id="cb293-3"><a href="endogeneity-issues.html#cb293-3" tabindex="-1"></a>    <span class="do">## Market Mechanisms</span></span>
<span id="cb293-4"><a href="endogeneity-issues.html#cb293-4" tabindex="-1"></a>    demand <span class="ot">&lt;-</span> <span class="fu">qd_fun</span>(P)</span>
<span id="cb293-5"><a href="endogeneity-issues.html#cb293-5" tabindex="-1"></a>    supply <span class="ot">&lt;-</span> <span class="fu">qs_fun</span>(P)</span>
<span id="cb293-6"><a href="endogeneity-issues.html#cb293-6" tabindex="-1"></a></span>
<span id="cb293-7"><a href="endogeneity-issues.html#cb293-7" tabindex="-1"></a>    <span class="do">## Compute EQ (what we observe)</span></span>
<span id="cb293-8"><a href="endogeneity-issues.html#cb293-8" tabindex="-1"></a>    eq_id <span class="ot">&lt;-</span> <span class="fu">which.min</span>( <span class="fu">abs</span>(demand<span class="sc">-</span>supply) )</span>
<span id="cb293-9"><a href="endogeneity-issues.html#cb293-9" tabindex="-1"></a>    eq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">P=</span>P[eq_id], <span class="at">Q=</span>demand[eq_id]) </span>
<span id="cb293-10"><a href="endogeneity-issues.html#cb293-10" tabindex="-1"></a></span>
<span id="cb293-11"><a href="endogeneity-issues.html#cb293-11" tabindex="-1"></a>    <span class="do">## Return Equilibrium Observations</span></span>
<span id="cb293-12"><a href="endogeneity-issues.html#cb293-12" tabindex="-1"></a>    <span class="fu">return</span>(eq)</span>
<span id="cb293-13"><a href="endogeneity-issues.html#cb293-13" tabindex="-1"></a>})</span>
<span id="cb293-14"><a href="endogeneity-issues.html#cb293-14" tabindex="-1"></a>dat3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(EQ3), <span class="at">cost=</span><span class="st">&#39;1&#39;</span>, <span class="at">T=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(EQ3))</span>
<span id="cb293-15"><a href="endogeneity-issues.html#cb293-15" tabindex="-1"></a></span>
<span id="cb293-16"><a href="endogeneity-issues.html#cb293-16" tabindex="-1"></a></span>
<span id="cb293-17"><a href="endogeneity-issues.html#cb293-17" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb293-18"><a href="endogeneity-issues.html#cb293-18" tabindex="-1"></a><span class="fu">plot</span>(P<span class="sc">~</span>T, dat2, <span class="at">main=</span><span class="st">&#39;Effect of Cost Shock on Price&#39;</span>, <span class="at">pch=</span><span class="dv">17</span>,<span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">25</span>))</span>
<span id="cb293-19"><a href="endogeneity-issues.html#cb293-19" tabindex="-1"></a><span class="fu">points</span>(P<span class="sc">~</span>T, dat3, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">25</span>))</span>
<span id="cb293-20"><a href="endogeneity-issues.html#cb293-20" tabindex="-1"></a></span>
<span id="cb293-21"><a href="endogeneity-issues.html#cb293-21" tabindex="-1"></a><span class="fu">plot</span>(Q<span class="sc">~</span>T, dat2, <span class="at">main=</span><span class="st">&#39;Effect of Cost Shock on Quantity&#39;</span>, <span class="at">pch=</span><span class="dv">17</span>,<span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">25</span>))</span>
<span id="cb293-22"><a href="endogeneity-issues.html#cb293-22" tabindex="-1"></a><span class="fu">points</span>(Q<span class="sc">~</span>T, dat3, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">25</span>))</span></code></pre></div>
<p><img src="03-ROLS_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="endogeneity-issues.html#cb294-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dat2, dat3)</span>
<span id="cb294-2"><a href="endogeneity-issues.html#cb294-2" tabindex="-1"></a>regP <span class="ot">&lt;-</span> <span class="fu">lm</span>(P<span class="sc">~</span>T<span class="sc">*</span>cost, dat)</span>
<span id="cb294-3"><a href="endogeneity-issues.html#cb294-3" tabindex="-1"></a><span class="fu">summary</span>(regP)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = P ~ T * cost, data = dat)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.59836 -0.12829 -0.00084  0.12489  0.67182 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  8.902e+00  1.163e-02 765.575   &lt;2e-16 ***
## T           -4.930e-05  3.870e-05  -1.274    0.203    
## cost2       -8.408e-01  6.003e-02 -14.007   &lt;2e-16 ***
## T:cost2      4.351e-05  1.341e-04   0.325    0.746    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1926 on 1196 degrees of freedom
## Multiple R-squared:  0.7781, Adjusted R-squared:  0.7775 
## F-statistic:  1398 on 3 and 1196 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="endogeneity-issues.html#cb296-1" tabindex="-1"></a>regQ <span class="ot">&lt;-</span> <span class="fu">lm</span>(Q<span class="sc">~</span>T<span class="sc">*</span>cost, dat)</span>
<span id="cb296-2"><a href="endogeneity-issues.html#cb296-2" tabindex="-1"></a><span class="fu">summary</span>(regQ)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Q ~ T * cost, data = dat)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.53312 -0.11390 -0.00153  0.11158  0.49410 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  8.875e-01  1.036e-02  85.637   &lt;2e-16 ***
## T           -2.100e-05  3.450e-05  -0.609    0.543    
## cost2        6.394e-01  5.350e-02  11.952   &lt;2e-16 ***
## T:cost2      8.902e-05  1.195e-04   0.745    0.456    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1716 on 1196 degrees of freedom
## Multiple R-squared:  0.7445, Adjusted R-squared:  0.7438 
## F-statistic:  1162 on 3 and 1196 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="more-literature-2" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> More Literature<a href="endogeneity-issues.html#more-literature-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You are directed to the following resources which discusses endogeneity in more detail and how it applies generally.</p>
<ul>
<li>Causal Inference for Statistics, Social, and Biomedical Sciences: An Introduction</li>
<li><a href="https://www.mostlyharmlesseconometrics.com/" class="uri">https://www.mostlyharmlesseconometrics.com/</a></li>
<li><a href="https://www.econometrics-with-r.org" class="uri">https://www.econometrics-with-r.org</a></li>
<li><a href="https://bookdown.org/paul/applied-causal-analysis/" class="uri">https://bookdown.org/paul/applied-causal-analysis/</a></li>
<li><a href="https://mixtape.scunning.com/" class="uri">https://mixtape.scunning.com/</a></li>
<li><a href="https://theeffectbook.net/" class="uri">https://theeffectbook.net/</a></li>
<li><a href="https://www.r-causal.org/" class="uri">https://www.r-causal.org/</a></li>
<li><a href="https://matheusfacure.github.io/python-causality-handbook/landing-page.html" class="uri">https://matheusfacure.github.io/python-causality-handbook/landing-page.html</a></li>
</ul>
<p>For IV,</p>
<ul>
<li><a href="https://cameron.econ.ucdavis.edu/e240a/ch04iv.pdf" class="uri">https://cameron.econ.ucdavis.edu/e240a/ch04iv.pdf</a></li>
<li><a href="https://mru.org/courses/mastering-econometrics/introduction-instrumental-variables-part-one" class="uri">https://mru.org/courses/mastering-econometrics/introduction-instrumental-variables-part-one</a></li>
<li><a href="https://www.econometrics-with-r.org/12-ivr.html" class="uri">https://www.econometrics-with-r.org/12-ivr.html</a></li>
<li><a href="https://bookdown.org/paul/applied-causal-analysis/estimation-2.html" class="uri">https://bookdown.org/paul/applied-causal-analysis/estimation-2.html</a></li>
<li><a href="https://mixtape.scunning.com/07-instrumental_variables" class="uri">https://mixtape.scunning.com/07-instrumental_variables</a></li>
<li><a href="https://theeffectbook.net/ch-InstrumentalVariables.html" class="uri">https://theeffectbook.net/ch-InstrumentalVariables.html</a></li>
<li><a href="http://www.urfie.net/read/index.html#page/247" class="uri">http://www.urfie.net/read/index.html#page/247</a></li>
</ul>
<p>For RDD and DID,</p>
<ul>
<li><a href="https://bookdown.org/paul/applied-causal-analysis/rdd-regression-discontinuity-design.html" class="uri">https://bookdown.org/paul/applied-causal-analysis/rdd-regression-discontinuity-design.html</a></li>
<li><a href="https://mixtape.scunning.com/06-regression_discontinuity" class="uri">https://mixtape.scunning.com/06-regression_discontinuity</a></li>
<li><a href="https://theeffectbook.net/ch-RegressionDiscontinuity.html" class="uri">https://theeffectbook.net/ch-RegressionDiscontinuity.html</a></li>
<li><a href="https://mixtape.scunning.com/09-difference_in_differences" class="uri">https://mixtape.scunning.com/09-difference_in_differences</a></li>
<li><a href="https://theeffectbook.net/ch-DifferenceinDifference.html" class="uri">https://theeffectbook.net/ch-DifferenceinDifference.html</a></li>
<li><a href="http://www.urfie.net/read/index.html#page/226" class="uri">http://www.urfie.net/read/index.html#page/226</a></li>
</ul>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="4">
<li id="fn4"><p>Although there are many ways this simultaneity can happen, economic theorists have made great strides in analyzing the simultaneity problem as it arises from market relationships. In fact, the 2SLS statistical approach arose to understand the equilibrium of a single competitive agricultural market.<a href="endogeneity-issues.html#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Notice that even in this linear model, however, all effects are conditional: <em>The</em> effect of a cost change on quantity or price depends on the demand curve. A change in costs affects quantity supplied but not quantity demanded (which then affects equilibrium price) but the demand side of the market still matters! The change in price from a change in costs depends on the elasticity of demand.<a href="endogeneity-issues.html#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ols-diagnostics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-scientism.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["index.pdf", "index.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
