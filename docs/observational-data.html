<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> 13 Observational Data | Introductory Economic Statistics: Data-Driven Analysis in R</title>
  <meta name="description" content=" 13 Observational Data | Introductory Economic Statistics: Data-Driven Analysis in R" />
  <meta name="generator" content="bookdown 0.44 and GitBook 2.6.7" />

  <meta property="og:title" content=" 13 Observational Data | Introductory Economic Statistics: Data-Driven Analysis in R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 13 Observational Data | Introductory Economic Statistics: Data-Driven Analysis in R" />
  
  
  

<meta name="author" content="Jordan Adamson" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intermediate-regression-ii.html"/>
<link rel="next" href="experimental-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.11.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<script src="libs/core-js-2.5.3/shim.min.js"></script>
<script src="libs/react-18.2.0/react.min.js"></script>
<script src="libs/react-18.2.0/react-dom.min.js"></script>
<script src="libs/reactwidget-2.0.0/react-tools.js"></script>
<link href="libs/reactable-0.4.4/reactable.css" rel="stylesheet" />
<script src="libs/reactable-binding-0.4.4/reactable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li> </li>
<li class="divider"></li>
<li><a href="index.html#index" id="toc-index"></a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I Introduction to Data Analysis</b></span></li>
<li class="chapter" data-level="1" data-path="first-steps.html"><a href="first-steps.html"><i class="fa fa-check"></i><b>1</b> First Steps</a>
<ul>
<li class="chapter" data-level="1.1" data-path="first-steps.html"><a href="first-steps.html#why-program-in-r"><i class="fa fa-check"></i><b>1.1</b> Why Program in R?</a></li>
<li class="chapter" data-level="1.2" data-path="first-steps.html"><a href="first-steps.html#first-steps-1"><i class="fa fa-check"></i><b>1.2</b> First Steps</a></li>
<li class="chapter" data-level="1.3" data-path="first-steps.html"><a href="first-steps.html#further-reading"><i class="fa fa-check"></i><b>1.3</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="mathematics.html"><a href="mathematics.html"><i class="fa fa-check"></i><b>2</b> Mathematics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="mathematics.html"><a href="mathematics.html#objects"><i class="fa fa-check"></i><b>2.1</b> Objects</a></li>
<li class="chapter" data-level="2.2" data-path="mathematics.html"><a href="mathematics.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a></li>
<li class="chapter" data-level="2.3" data-path="mathematics.html"><a href="mathematics.html#arrays"><i class="fa fa-check"></i><b>2.3</b> Arrays</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>3</b> Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data.html"><a href="data.html#types"><i class="fa fa-check"></i><b>3.1</b> Types</a></li>
<li class="chapter" data-level="3.2" data-path="data.html"><a href="data.html#densities-and-distributions"><i class="fa fa-check"></i><b>3.2</b> Densities and Distributions</a></li>
<li class="chapter" data-level="3.3" data-path="data.html"><a href="data.html#joint-distributions"><i class="fa fa-check"></i><b>3.3</b> Joint Distributions</a></li>
<li class="chapter" data-level="3.4" data-path="data.html"><a href="data.html#conditional-distributions"><i class="fa fa-check"></i><b>3.4</b> Conditional Distributions</a></li>
<li class="chapter" data-level="3.5" data-path="data.html"><a href="data.html#further-reading-1"><i class="fa fa-check"></i><b>3.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="random-variables.html"><a href="random-variables.html"><i class="fa fa-check"></i><b>4</b> Random Variables</a>
<ul>
<li class="chapter" data-level="4.1" data-path="random-variables.html"><a href="random-variables.html#discrete"><i class="fa fa-check"></i><b>4.1</b> Discrete</a></li>
<li class="chapter" data-level="4.2" data-path="random-variables.html"><a href="random-variables.html#continuous"><i class="fa fa-check"></i><b>4.2</b> Continuous</a></li>
<li class="chapter" data-level="4.3" data-path="random-variables.html"><a href="random-variables.html#drawing-samples"><i class="fa fa-check"></i><b>4.3</b> Drawing Samples</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="statistics.html"><a href="statistics.html"><i class="fa fa-check"></i><b>5</b> Statistics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="statistics.html"><a href="statistics.html#mean-and-variance"><i class="fa fa-check"></i><b>5.1</b> Mean and Variance</a></li>
<li class="chapter" data-level="5.2" data-path="statistics.html"><a href="statistics.html#other-centerspread-statistics"><i class="fa fa-check"></i><b>5.2</b> Other Center/Spread Statistics</a></li>
<li class="chapter" data-level="5.3" data-path="statistics.html"><a href="statistics.html#shape-statistics"><i class="fa fa-check"></i><b>5.3</b> Shape Statistics</a></li>
<li class="chapter" data-level="5.4" data-path="statistics.html"><a href="statistics.html#probability-theory"><i class="fa fa-check"></i><b>5.4</b> Probability Theory</a></li>
<li class="chapter" data-level="5.5" data-path="statistics.html"><a href="statistics.html#further-reading-2"><i class="fa fa-check"></i><b>5.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="resampling.html"><a href="resampling.html"><i class="fa fa-check"></i><b>6</b> (Re)Sampling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="resampling.html"><a href="resampling.html#sample-distributions"><i class="fa fa-check"></i><b>6.1</b> Sample Distributions</a></li>
<li class="chapter" data-level="6.2" data-path="resampling.html"><a href="resampling.html#intervals"><i class="fa fa-check"></i><b>6.2</b> Intervals</a></li>
<li class="chapter" data-level="6.3" data-path="resampling.html"><a href="resampling.html#resampling-1"><i class="fa fa-check"></i><b>6.3</b> Resampling</a></li>
<li class="chapter" data-level="6.4" data-path="resampling.html"><a href="resampling.html#further-reading-3"><i class="fa fa-check"></i><b>6.4</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="hypothesis-tests.html"><a href="hypothesis-tests.html"><i class="fa fa-check"></i><b>7</b> Hypothesis Tests</a>
<ul>
<li class="chapter" data-level="7.1" data-path="hypothesis-tests.html"><a href="hypothesis-tests.html#basic-ideas"><i class="fa fa-check"></i><b>7.1</b> Basic Ideas</a></li>
<li class="chapter" data-level="7.2" data-path="hypothesis-tests.html"><a href="hypothesis-tests.html#default-statistics"><i class="fa fa-check"></i><b>7.2</b> Default Statistics</a></li>
<li class="chapter" data-level="7.3" data-path="hypothesis-tests.html"><a href="hypothesis-tests.html#two-sample-differences"><i class="fa fa-check"></i><b>7.3</b> Two-Sample Differences</a></li>
<li class="chapter" data-level="7.4" data-path="hypothesis-tests.html"><a href="hypothesis-tests.html#further-reading-4"><i class="fa fa-check"></i><b>7.4</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-analysis.html"><a href="data-analysis.html"><i class="fa fa-check"></i><b>8</b> Data Analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-analysis.html"><a href="data-analysis.html#beyond-basics"><i class="fa fa-check"></i><b>8.1</b> Beyond Basics</a></li>
<li class="chapter" data-level="8.2" data-path="data-analysis.html"><a href="data-analysis.html#inputs"><i class="fa fa-check"></i><b>8.2</b> Inputs</a></li>
<li class="chapter" data-level="8.3" data-path="data-analysis.html"><a href="data-analysis.html#outputs"><i class="fa fa-check"></i><b>8.3</b> Outputs</a></li>
<li class="chapter" data-level="8.4" data-path="data-analysis.html"><a href="data-analysis.html#r-markdown-reports"><i class="fa fa-check"></i><b>8.4</b> R-Markdown Reports</a></li>
<li class="chapter" data-level="8.5" data-path="data-analysis.html"><a href="data-analysis.html#further-reading-5"><i class="fa fa-check"></i><b>8.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bivariate-data.html"><a href="bivariate-data.html"><i class="fa fa-check"></i><b>9</b> Bivariate Data</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bivariate-data.html"><a href="bivariate-data.html#statistics-1"><i class="fa fa-check"></i><b>9.1</b> Statistics</a></li>
<li class="chapter" data-level="9.2" data-path="bivariate-data.html"><a href="bivariate-data.html#probability-theory-1"><i class="fa fa-check"></i><b>9.2</b> Probability Theory</a></li>
<li class="chapter" data-level="9.3" data-path="bivariate-data.html"><a href="bivariate-data.html#further-reading-6"><i class="fa fa-check"></i><b>9.3</b> Further Reading</a></li>
</ul></li>
<li class="part"><span><b>II Introduction to Linear Regression</b></span></li>
<li class="chapter" data-level="10" data-path="basic-regression.html"><a href="basic-regression.html"><i class="fa fa-check"></i><b>10</b> Basic Regression</a>
<ul>
<li class="chapter" data-level="10.1" data-path="basic-regression.html"><a href="basic-regression.html#simple-linear-regression"><i class="fa fa-check"></i><b>10.1</b> Simple Linear Regression</a></li>
<li class="chapter" data-level="10.2" data-path="basic-regression.html"><a href="basic-regression.html#variability-estimates"><i class="fa fa-check"></i><b>10.2</b> Variability Estimates</a></li>
<li class="chapter" data-level="10.3" data-path="basic-regression.html"><a href="basic-regression.html#hypothesis-tests-1"><i class="fa fa-check"></i><b>10.3</b> Hypothesis Tests</a></li>
<li class="chapter" data-level="10.4" data-path="basic-regression.html"><a href="basic-regression.html#local-linear-regression"><i class="fa fa-check"></i><b>10.4</b> Local Linear Regression</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="intermediate-regression.html"><a href="intermediate-regression.html"><i class="fa fa-check"></i><b>11</b> Intermediate Regression</a>
<ul>
<li class="chapter" data-level="11.1" data-path="intermediate-regression.html"><a href="intermediate-regression.html#multiple-linear-regression"><i class="fa fa-check"></i><b>11.1</b> Multiple Linear Regression</a></li>
<li class="chapter" data-level="11.2" data-path="intermediate-regression.html"><a href="intermediate-regression.html#factor-variables"><i class="fa fa-check"></i><b>11.2</b> Factor Variables</a></li>
<li class="chapter" data-level="11.3" data-path="intermediate-regression.html"><a href="intermediate-regression.html#variability-estimates-1"><i class="fa fa-check"></i><b>11.3</b> Variability Estimates</a></li>
<li class="chapter" data-level="11.4" data-path="intermediate-regression.html"><a href="intermediate-regression.html#hypothesis-tests-2"><i class="fa fa-check"></i><b>11.4</b> Hypothesis Tests</a></li>
<li class="chapter" data-level="11.5" data-path="intermediate-regression.html"><a href="intermediate-regression.html#further-reading-7"><i class="fa fa-check"></i><b>11.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="intermediate-regression-ii.html"><a href="intermediate-regression-ii.html"><i class="fa fa-check"></i><b>12</b> Intermediate Regression II</a>
<ul>
<li class="chapter" data-level="12.1" data-path="intermediate-regression-ii.html"><a href="intermediate-regression-ii.html#coefficient-interpretation"><i class="fa fa-check"></i><b>12.1</b> Coefficient Interpretation</a></li>
<li class="chapter" data-level="12.2" data-path="intermediate-regression-ii.html"><a href="intermediate-regression-ii.html#diagnostics"><i class="fa fa-check"></i><b>12.2</b> Diagnostics</a></li>
<li class="chapter" data-level="12.3" data-path="intermediate-regression-ii.html"><a href="intermediate-regression-ii.html#transformations"><i class="fa fa-check"></i><b>12.3</b> Transformations</a></li>
<li class="chapter" data-level="12.4" data-path="intermediate-regression-ii.html"><a href="intermediate-regression-ii.html#regressograms"><i class="fa fa-check"></i><b>12.4</b> Regressograms</a></li>
<li class="chapter" data-level="12.5" data-path="intermediate-regression-ii.html"><a href="intermediate-regression-ii.html#more-literature"><i class="fa fa-check"></i><b>12.5</b> More Literature</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="observational-data.html"><a href="observational-data.html"><i class="fa fa-check"></i><b>13</b> Observational Data</a>
<ul>
<li class="chapter" data-level="13.1" data-path="observational-data.html"><a href="observational-data.html#temporal-interdependence"><i class="fa fa-check"></i><b>13.1</b> Temporal Interdependence</a></li>
<li class="chapter" data-level="13.2" data-path="observational-data.html"><a href="observational-data.html#spatial-interdependence"><i class="fa fa-check"></i><b>13.2</b> Spatial Interdependence</a></li>
<li class="chapter" data-level="13.3" data-path="observational-data.html"><a href="observational-data.html#variable-interdependence"><i class="fa fa-check"></i><b>13.3</b> Variable Interdependence</a></li>
<li class="chapter" data-level="13.4" data-path="observational-data.html"><a href="observational-data.html#further-reading-8"><i class="fa fa-check"></i><b>13.4</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="experimental-data.html"><a href="experimental-data.html"><i class="fa fa-check"></i><b>14</b> Experimental Data</a>
<ul>
<li class="chapter" data-level="14.1" data-path="experimental-data.html"><a href="experimental-data.html#design-basics"><i class="fa fa-check"></i><b>14.1</b> Design Basics</a></li>
<li class="chapter" data-level="14.2" data-path="experimental-data.html"><a href="experimental-data.html#comparisons-over-time"><i class="fa fa-check"></i><b>14.2</b> Comparisons Over Time</a></li>
<li class="chapter" data-level="14.3" data-path="experimental-data.html"><a href="experimental-data.html#natural-experiments"><i class="fa fa-check"></i><b>14.3</b> “Natural” Experiments</a></li>
<li class="chapter" data-level="14.4" data-path="experimental-data.html"><a href="experimental-data.html#further-reading-9"><i class="fa fa-check"></i><b>14.4</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="data-scientism.html"><a href="data-scientism.html"><i class="fa fa-check"></i><b>15</b> Data Scientism</a>
<ul>
<li class="chapter" data-level="15.1" data-path="data-scientism.html"><a href="data-scientism.html#false-positives"><i class="fa fa-check"></i><b>15.1</b> False Positives</a></li>
<li class="chapter" data-level="15.2" data-path="data-scientism.html"><a href="data-scientism.html#spurious-regression"><i class="fa fa-check"></i><b>15.2</b> Spurious Regression</a></li>
<li class="chapter" data-level="15.3" data-path="data-scientism.html"><a href="data-scientism.html#spurious-causal-impacts"><i class="fa fa-check"></i><b>15.3</b> Spurious Causal Impacts</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="misc.-topics.html"><a href="misc.-topics.html"><i class="fa fa-check"></i><b>16</b> Misc. Topics</a>
<ul>
<li class="chapter" data-level="16.1" data-path="misc.-topics.html"><a href="misc.-topics.html#locally-linear-multiple-regression"><i class="fa fa-check"></i><b>16.1</b> Locally Linear Multiple Regression</a></li>
<li class="chapter" data-level="16.2" data-path="misc.-topics.html"><a href="misc.-topics.html#nonparametric-tests"><i class="fa fa-check"></i><b>16.2</b> Nonparametric Tests</a></li>
<li class="chapter" data-level="16.3" data-path="misc.-topics.html"><a href="misc.-topics.html#prediction"><i class="fa fa-check"></i><b>16.3</b> Prediction</a></li>
<li class="chapter" data-level="16.4" data-path="misc.-topics.html"><a href="misc.-topics.html#decision-theory"><i class="fa fa-check"></i><b>16.4</b> Decision Theory</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://sites.google.com/view/jordan-adamson" target="blank">Jordan Adamson</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introductory Economic Statistics: Data-Driven Analysis in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="observational-data" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number"> 13</span> Observational Data<a href="observational-data.html#observational-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<hr />
<div id="temporal-interdependence" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">13.1</span> Temporal Interdependence<a href="observational-data.html#temporal-interdependence" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Many observational datasets have temporal dependence, meaning that values at one point in time are related to past values. This violates the standard assumption of independence used in many statistical methods.</p>
<p>Stock prices are classic examples of temporally dependent processes. If Apple’s stock was high yesterday, it is more likely (but not guaranteed) to be high today.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="observational-data.html#cb198-1" tabindex="-1"></a><span class="co"># highest price each day</span></span>
<span id="cb198-2"><a href="observational-data.html#cb198-2" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb198-3"><a href="observational-data.html#cb198-3" tabindex="-1"></a>stock <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/plotly/datasets/master/finance-charts-apple.csv&#39;</span>)</span>
<span id="cb198-4"><a href="observational-data.html#cb198-4" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(stock, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">mode =</span> <span class="st">&#39;lines&#39;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb198-5"><a href="observational-data.html#cb198-5" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span>Date, <span class="at">y =</span> <span class="sc">~</span>AAPL.High) <span class="sc">%&gt;%</span></span>
<span id="cb198-6"><a href="observational-data.html#cb198-6" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">showlegend =</span> F)</span>
<span id="cb198-7"><a href="observational-data.html#cb198-7" tabindex="-1"></a>fig</span></code></pre></div>
</details>
<div class="plotly html-widget html-fill-item" id="htmlwidget-1ea6736860684ac2fddf" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-1ea6736860684ac2fddf">{"x":{"visdat":{"11c146221a716":["function () ","plotlyVisDat"]},"cur_data":"11c146221a716","attrs":{"11c146221a716":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"11c146221a716.1":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","x":{},"y":{},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"showlegend":false,"xaxis":{"domain":[0,1],"automargin":true,"title":"Date"},"yaxis":{"domain":[0,1],"automargin":true,"title":"AAPL.High"},"hovermode":"closest"},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"mode":"lines","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"lines","type":"scatter","x":["2015-02-17","2015-02-18","2015-02-19","2015-02-20","2015-02-23","2015-02-24","2015-02-25","2015-02-26","2015-02-27","2015-03-02","2015-03-03","2015-03-04","2015-03-05","2015-03-06","2015-03-09","2015-03-10","2015-03-11","2015-03-12","2015-03-13","2015-03-16","2015-03-17","2015-03-18","2015-03-19","2015-03-20","2015-03-23","2015-03-24","2015-03-25","2015-03-26","2015-03-27","2015-03-30","2015-03-31","2015-04-01","2015-04-02","2015-04-06","2015-04-07","2015-04-08","2015-04-09","2015-04-10","2015-04-13","2015-04-14","2015-04-15","2015-04-16","2015-04-17","2015-04-20","2015-04-21","2015-04-22","2015-04-23","2015-04-24","2015-04-27","2015-04-28","2015-04-29","2015-04-30","2015-05-01","2015-05-04","2015-05-05","2015-05-06","2015-05-07","2015-05-08","2015-05-11","2015-05-12","2015-05-13","2015-05-14","2015-05-15","2015-05-18","2015-05-19","2015-05-20","2015-05-21","2015-05-22","2015-05-26","2015-05-27","2015-05-28","2015-05-29","2015-06-01","2015-06-02","2015-06-03","2015-06-04","2015-06-05","2015-06-08","2015-06-09","2015-06-10","2015-06-11","2015-06-12","2015-06-15","2015-06-16","2015-06-17","2015-06-18","2015-06-19","2015-06-22","2015-06-23","2015-06-24","2015-06-25","2015-06-26","2015-06-29","2015-06-30","2015-07-01","2015-07-02","2015-07-06","2015-07-07","2015-07-08","2015-07-09","2015-07-10","2015-07-13","2015-07-14","2015-07-15","2015-07-16","2015-07-17","2015-07-20","2015-07-21","2015-07-22","2015-07-23","2015-07-24","2015-07-27","2015-07-28","2015-07-29","2015-07-30","2015-07-31","2015-08-03","2015-08-04","2015-08-05","2015-08-06","2015-08-07","2015-08-10","2015-08-11","2015-08-12","2015-08-13","2015-08-14","2015-08-17","2015-08-18","2015-08-19","2015-08-20","2015-08-21","2015-08-24","2015-08-25","2015-08-26","2015-08-27","2015-08-28","2015-08-31","2015-09-01","2015-09-02","2015-09-03","2015-09-04","2015-09-08","2015-09-09","2015-09-10","2015-09-11","2015-09-14","2015-09-15","2015-09-16","2015-09-17","2015-09-18","2015-09-21","2015-09-22","2015-09-23","2015-09-24","2015-09-25","2015-09-28","2015-09-29","2015-09-30","2015-10-01","2015-10-02","2015-10-05","2015-10-06","2015-10-07","2015-10-08","2015-10-09","2015-10-12","2015-10-13","2015-10-14","2015-10-15","2015-10-16","2015-10-19","2015-10-20","2015-10-21","2015-10-22","2015-10-23","2015-10-26","2015-10-27","2015-10-28","2015-10-29","2015-10-30","2015-11-02","2015-11-03","2015-11-04","2015-11-05","2015-11-06","2015-11-09","2015-11-10","2015-11-11","2015-11-12","2015-11-13","2015-11-16","2015-11-17","2015-11-18","2015-11-19","2015-11-20","2015-11-23","2015-11-24","2015-11-25","2015-11-27","2015-11-30","2015-12-01","2015-12-02","2015-12-03","2015-12-04","2015-12-07","2015-12-08","2015-12-09","2015-12-10","2015-12-11","2015-12-14","2015-12-15","2015-12-16","2015-12-17","2015-12-18","2015-12-21","2015-12-22","2015-12-23","2015-12-24","2015-12-28","2015-12-29","2015-12-30","2015-12-31","2016-01-04","2016-01-05","2016-01-06","2016-01-07","2016-01-08","2016-01-11","2016-01-12","2016-01-13","2016-01-14","2016-01-15","2016-01-19","2016-01-20","2016-01-21","2016-01-22","2016-01-25","2016-01-26","2016-01-27","2016-01-28","2016-01-29","2016-02-01","2016-02-02","2016-02-03","2016-02-04","2016-02-05","2016-02-08","2016-02-09","2016-02-10","2016-02-11","2016-02-12","2016-02-16","2016-02-17","2016-02-18","2016-02-19","2016-02-22","2016-02-23","2016-02-24","2016-02-25","2016-02-26","2016-02-29","2016-03-01","2016-03-02","2016-03-03","2016-03-04","2016-03-07","2016-03-08","2016-03-09","2016-03-10","2016-03-11","2016-03-14","2016-03-15","2016-03-16","2016-03-17","2016-03-18","2016-03-21","2016-03-22","2016-03-23","2016-03-24","2016-03-28","2016-03-29","2016-03-30","2016-03-31","2016-04-01","2016-04-04","2016-04-05","2016-04-06","2016-04-07","2016-04-08","2016-04-11","2016-04-12","2016-04-13","2016-04-14","2016-04-15","2016-04-18","2016-04-19","2016-04-20","2016-04-21","2016-04-22","2016-04-25","2016-04-26","2016-04-27","2016-04-28","2016-04-29","2016-05-02","2016-05-03","2016-05-04","2016-05-05","2016-05-06","2016-05-09","2016-05-10","2016-05-11","2016-05-12","2016-05-13","2016-05-16","2016-05-17","2016-05-18","2016-05-19","2016-05-20","2016-05-23","2016-05-24","2016-05-25","2016-05-26","2016-05-27","2016-05-31","2016-06-01","2016-06-02","2016-06-03","2016-06-06","2016-06-07","2016-06-08","2016-06-09","2016-06-10","2016-06-13","2016-06-14","2016-06-15","2016-06-16","2016-06-17","2016-06-20","2016-06-21","2016-06-22","2016-06-23","2016-06-24","2016-06-27","2016-06-28","2016-06-29","2016-06-30","2016-07-01","2016-07-05","2016-07-06","2016-07-07","2016-07-08","2016-07-11","2016-07-12","2016-07-13","2016-07-14","2016-07-15","2016-07-18","2016-07-19","2016-07-20","2016-07-21","2016-07-22","2016-07-25","2016-07-26","2016-07-27","2016-07-28","2016-07-29","2016-08-01","2016-08-02","2016-08-03","2016-08-04","2016-08-05","2016-08-08","2016-08-09","2016-08-10","2016-08-11","2016-08-12","2016-08-15","2016-08-16","2016-08-17","2016-08-18","2016-08-19","2016-08-22","2016-08-23","2016-08-24","2016-08-25","2016-08-26","2016-08-29","2016-08-30","2016-08-31","2016-09-01","2016-09-02","2016-09-06","2016-09-07","2016-09-08","2016-09-09","2016-09-12","2016-09-13","2016-09-14","2016-09-15","2016-09-16","2016-09-19","2016-09-20","2016-09-21","2016-09-22","2016-09-23","2016-09-26","2016-09-27","2016-09-28","2016-09-29","2016-09-30","2016-10-03","2016-10-04","2016-10-05","2016-10-06","2016-10-07","2016-10-10","2016-10-11","2016-10-12","2016-10-13","2016-10-14","2016-10-17","2016-10-18","2016-10-19","2016-10-20","2016-10-21","2016-10-24","2016-10-25","2016-10-26","2016-10-27","2016-10-28","2016-10-31","2016-11-01","2016-11-02","2016-11-03","2016-11-04","2016-11-07","2016-11-08","2016-11-09","2016-11-10","2016-11-11","2016-11-14","2016-11-15","2016-11-16","2016-11-17","2016-11-18","2016-11-21","2016-11-22","2016-11-23","2016-11-25","2016-11-28","2016-11-29","2016-11-30","2016-12-01","2016-12-02","2016-12-05","2016-12-06","2016-12-07","2016-12-08","2016-12-09","2016-12-12","2016-12-13","2016-12-14","2016-12-15","2016-12-16","2016-12-19","2016-12-20","2016-12-21","2016-12-22","2016-12-23","2016-12-27","2016-12-28","2016-12-29","2016-12-30","2017-01-03","2017-01-04","2017-01-05","2017-01-06","2017-01-09","2017-01-10","2017-01-11","2017-01-12","2017-01-13","2017-01-17","2017-01-18","2017-01-19","2017-01-20","2017-01-23","2017-01-24","2017-01-25","2017-01-26","2017-01-27","2017-01-30","2017-01-31","2017-02-01","2017-02-02","2017-02-03","2017-02-06","2017-02-07","2017-02-08","2017-02-09","2017-02-10","2017-02-13","2017-02-14","2017-02-15","2017-02-16"],"y":[128.88000500000001,128.779999,129.029999,129.5,133,133.60000600000001,131.60000600000001,130.86999499999999,130.570007,130.279999,129.520004,129.55999800000001,128.75,129.36999499999999,129.570007,127.220001,124.769997,124.900002,125.400002,124.949997,127.31999999999999,129.16000399999999,129.25,128.39999399999999,127.849998,128.03999300000001,126.81999999999999,124.879997,124.699997,126.400002,126.489998,125.120003,125.55999799999999,127.510002,128.11999499999999,126.400002,126.58000199999999,127.209999,128.570007,127.290001,127.129997,127.099998,126.139999,128.11999499999999,128.199997,128.86999499999999,130.41999799999999,130.63000500000001,133.13000500000001,134.53999300000001,131.58999600000001,128.63999899999999,130.13000500000001,130.570007,128.449997,126.75,126.08000199999999,127.620003,127.55999799999999,126.879997,127.19000200000001,128.949997,129.490005,130.720001,130.88000500000001,130.979996,131.63000500000001,132.970001,132.91000399999999,132.259995,131.949997,131.449997,131.38999899999999,130.66000399999999,130.94000199999999,130.58000200000001,129.69000199999999,129.21000699999999,128.08000200000001,129.33999600000001,130.179993,128.33000200000001,127.239998,127.849998,127.879997,128.30999800000001,127.81999999999999,128.05999800000001,127.610001,129.800003,129.199997,127.989998,126.470001,126.120003,126.94000200000001,126.69000200000001,126.230003,126.150002,124.639999,124.05999799999999,123.849998,125.760002,126.370003,127.150002,128.570007,129.61999499999999,132.970001,132.91999799999999,125.5,127.089996,125.739998,123.610001,123.910004,123.5,122.56999999999999,122.639999,122.56999999999999,117.699997,117.44000200000001,116.5,116.25,119.989998,118.18000000000001,115.41999800000001,116.400002,116.30999799999999,117.650002,117.44000200000001,116.519997,114.349998,111.900002,108.800003,111.110001,109.889999,113.239998,113.30999799999999,114.529999,111.879997,112.339996,112.779999,110.449997,112.55999799999999,114.019997,113.279999,114.209999,116.889999,116.529999,116.540001,116.489998,114.300003,115.370003,114.18000000000001,114.720001,115.5,116.69000200000001,114.56999999999999,113.510002,111.540001,109.620003,111.010002,111.370003,111.739998,111.769997,110.19000200000001,112.279999,112.75,112.449997,111.519997,112.099998,112,111.75,114.16999800000001,115.58000199999999,115.5,119.230003,118.129997,116.540001,119.300003,120.69000200000001,121.220001,121.360001,123.489998,123.81999999999999,122.69000200000001,121.80999799999999,121.80999799999999,118.06999999999999,117.41999800000001,116.81999999999999,115.56999999999999,114.239998,115.050003,117.489998,119.75,119.91999800000001,119.730003,119.349998,119.230003,118.410004,119.410004,118.80999799999999,118.110001,116.790001,119.25,119.860001,118.599998,117.69000200000001,116.94000200000001,115.389999,112.68000000000001,112.800003,111.989998,112.25,109.519997,107.370003,107.720001,108.849998,109,107.69000200000001,109.43000000000001,108.699997,107.029999,105.370003,105.849998,102.370003,100.129997,99.110000999999997,99.059997999999993,100.69000200000001,101.19000200000001,100.480003,97.709998999999996,98.650002000000001,98.190002000000007,97.879997000000003,101.459999,101.529999,100.879997,96.629997000000003,94.519997000000004,97.339995999999999,96.709998999999996,96.040001000000004,96.839995999999999,97.330001999999993,96.919998000000007,95.699996999999996,95.940002000000007,96.349997999999999,94.720000999999996,94.5,96.849997999999999,98.209998999999996,98.889999000000003,96.760002,96.900002000000001,96.5,96.379997000000003,96.760002,98.019997000000004,98.230002999999996,100.769997,100.889999,101.709999,103.75,102.83000199999999,101.760002,101.58000199999999,102.239998,102.279999,102.910004,105.18000000000001,106.30999799999999,106.470001,106.5,107.650002,107.290001,107.06999999999999,106.25,106.19000200000001,107.790001,110.41999800000001,109.900002,110,112.19000200000001,110.730003,110.980003,110.41999800000001,109.769997,110.610001,110.5,112.339996,112.389999,112.300003,108.949997,108,108.089996,106.93000000000001,106.480003,105.650002,105.300003,98.709998999999996,97.879997000000003,94.720000999999996,94.080001999999993,95.739998,95.900002000000001,94.069999999999993,93.449996999999996,93.769997000000004,93.569999999999993,93.569999999999993,92.779999000000004,91.669998000000007,94.389999000000003,94.699996999999996,95.209998999999996,94.639999000000003,95.430000000000007,97.190002000000007,98.089995999999999,99.739998,100.730003,100.470001,100.400002,99.540001000000004,97.839995999999999,98.269997000000004,101.889999,99.870002999999997,99.559997999999993,99.989998,99.349997999999999,99.120002999999997,98.480002999999996,98.410004000000001,97.75,96.650002000000001,96.569999999999993,96.349997999999999,96.889999000000003,96.290001000000004,94.660004000000001,93.050003000000004,93.660004000000001,94.550003000000004,95.769997000000004,96.470000999999996,95.400002000000001,95.660004000000001,96.5,96.889999000000003,97.650002000000001,97.699996999999996,97.669998000000007,98.989998,99.300003000000004,100.129997,100,100.459999,101,99.300003000000004,98.839995999999999,97.970000999999996,104.349998,104.449997,104.550003,106.150002,106.06999999999999,105.839996,106,107.650002,108.370003,108.94000200000001,108.900002,108.93000000000001,108.44000200000001,109.540001,110.230003,109.370003,109.599998,109.69000200000001,109.099998,109.31999999999999,108.75,107.879997,107.949997,107.44000200000001,106.5,106.56999999999999,106.800003,108,108.300003,108.760002,107.269997,105.720001,105.720001,108.790001,113.029999,115.730003,116.129997,116.18000000000001,114.120003,113.989998,114.94000200000001,114.790001,113.389999,113.18000000000001,114.639999,113.800003,113.370003,113.050003,114.30999799999999,113.660004,114.339996,114.55999799999999,116.75,118.69000200000001,117.980003,117.44000200000001,118.16999800000001,117.839996,118.209999,117.760002,117.379997,116.910004,117.739998,118.360001,115.699997,115.860001,115.209999,114.230003,113.769997,112.349998,111.459999,110.25,110.510002,111.720001,111.31999999999999,111.089996,108.870003,107.80999799999999,107.68000000000001,110.230003,110.349998,110.540001,111.989998,112.41999800000001,111.510002,111.870003,112.470001,112.029999,112.199997,110.94000200000001,110.089996,110.029999,110.360001,111.19000200000001,112.43000000000001,114.699997,115,115.91999800000001,116.199997,116.730003,116.5,117.379997,117.5,117.400002,116.510002,116.519997,117.800003,118.019997,117.110001,117.199997,116.33000199999999,116.510002,116.860001,118.160004,119.43000000000001,119.379997,119.93000000000001,119.300003,119.620003,120.239998,120.5,120.089996,120.449997,120.80999799999999,120.099998,122.099998,122.44000200000001,122.349998,121.629997,121.389999,130.490005,129.38999899999999,129.19000199999999,130.5,132.08999600000001,132.220001,132.449997,132.94000199999999,133.820007,135.08999600000001,136.270004,135.89999399999999],"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>A random walk is the simplest mathematical model of temporal dependence. Each new value is just the previous value plus a random shock (white noise).</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="observational-data.html#cb199-1" tabindex="-1"></a><span class="co"># Generate Random Walk</span></span>
<span id="cb199-2"><a href="observational-data.html#cb199-2" tabindex="-1"></a>tN <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb199-3"><a href="observational-data.html#cb199-3" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">numeric</span>(tN)</span>
<span id="cb199-4"><a href="observational-data.html#cb199-4" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> stock<span class="sc">$</span>AAPL.High[<span class="dv">1</span>]</span>
<span id="cb199-5"><a href="observational-data.html#cb199-5" tabindex="-1"></a><span class="cf">for</span> (ti <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>tN) {</span>
<span id="cb199-6"><a href="observational-data.html#cb199-6" tabindex="-1"></a>    y[ti] <span class="ot">&lt;-</span> y[ti<span class="dv">-1</span>] <span class="sc">+</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb199-7"><a href="observational-data.html#cb199-7" tabindex="-1"></a>}</span>
<span id="cb199-8"><a href="observational-data.html#cb199-8" tabindex="-1"></a><span class="co">#x &lt;- runif(tN, -1,1) White Noise</span></span>
<span id="cb199-9"><a href="observational-data.html#cb199-9" tabindex="-1"></a></span>
<span id="cb199-10"><a href="observational-data.html#cb199-10" tabindex="-1"></a>y_dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Date=</span><span class="dv">1</span><span class="sc">:</span>tN, <span class="at">RandomWalk=</span>y)</span>
<span id="cb199-11"><a href="observational-data.html#cb199-11" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(y_dat, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">mode =</span> <span class="st">&#39;lines&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb199-12"><a href="observational-data.html#cb199-12" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x=</span><span class="sc">~</span>Date, <span class="at">y=</span><span class="sc">~</span>RandomWalk) <span class="sc">%&gt;%</span></span>
<span id="cb199-13"><a href="observational-data.html#cb199-13" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">showlegend =</span> F)</span>
<span id="cb199-14"><a href="observational-data.html#cb199-14" tabindex="-1"></a>fig</span></code></pre></div>
</details>
<div class="plotly html-widget html-fill-item" id="htmlwidget-2504a4d8eaa2647c7e0d" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-2504a4d8eaa2647c7e0d">{"x":{"visdat":{"11c141d5d8cab":["function () ","plotlyVisDat"]},"cur_data":"11c141d5d8cab","attrs":{"11c141d5d8cab":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"11c141d5d8cab.1":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","x":{},"y":{},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"showlegend":false,"xaxis":{"domain":[0,1],"automargin":true,"title":"Date"},"yaxis":{"domain":[0,1],"automargin":true,"title":"RandomWalk"},"hovermode":"closest"},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"mode":"lines","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"lines","type":"scatter","x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200],"y":[128.88000500000001,135.47154095101089,139.91025943386288,138.20381040296436,144.10678025412292,136.26761894284667,144.61073964911432,138.62335045433522,143.42254175881774,146.86933363399388,145.50351317117841,146.00681001863362,152.77298213991256,148.8270442195508,155.91247967055918,164.32344656049193,156.80227750058205,154.42450786552311,153.54422728608282,153.88790571208031,149.91803577246995,151.84274156655104,142.50017461909832,135.04483858200641,138.28953921406449,141.04444244488062,136.23889410014183,135.02655803768815,126.58478252666922,123.592139716101,130.97615641153337,126.97235397606076,132.41725121236325,122.66189801583917,114.96414844023914,111.99894221576781,103.29292748200626,98.91274472310127,105.21959254129709,96.458213139166247,86.576959146958899,87.217516769495916,96.107061236006331,89.171149405491661,91.703218762603711,93.057342270230066,101.89459730016918,100.40069062805654,97.101748176691245,103.07737474406989,99.388993415822398,94.825439886962187,90.466953335170757,93.081974048008334,86.530166855854105,94.257296874028754,90.212721722972702,95.988053927038919,104.46592692828656,109.12653490978212,107.10780275131495,115.49805174193264,121.49364877569408,124.41311257968576,131.5374956287715,126.23930042686791,126.26341784915806,128.14826147242368,122.4780576264757,115.04809479306371,110.0197665261376,103.81227431896062,99.09221104889096,91.151775583465707,93.713542060767423,103.1287174959007,108.39204518667341,106.1672445021841,96.201171312322032,97.54748785945506,94.717745036658954,87.384261834276032,96.358372360308778,98.848757060085546,108.66304660293193,107.55284929259599,107.2568206496808,112.12164423040034,116.91630356556655,110.08767257987441,114.52576180997224,116.78011324799539,108.98308158463718,117.20326585772366,122.56653647015722,118.62239643542947,112.14557866643102,120.87501104998321,113.97376521567733,104.25067793189467,94.597754851755809,99.203285938901018,102.85704903381796,104.66738197098405,105.75127843844623,109.45259131102742,118.9942438302833,110.71883004235954,113.53143484408886,123.49495892024518,124.31264917443426,123.53337498458953,115.53571516259493,121.49556358887733,124.07189378592105,129.64321987315,125.41224393605174,117.99663359376521,119.2966453412819,112.65914013686509,121.06575759670616,128.85864793400199,127.47659678182484,121.2270182937655,117.32279379463674,113.00831356628717,110.15656939784915,114.04082712328912,110.23941051292152,105.90005170631142,109.49390398415656,100.12982394623489,107.75055636729033,99.764745152396273,106.47240911687643,96.828358271931421,101.35562972242863,93.382447162483942,87.36820897630335,85.831690338281106,94.698710176934611,103.05366552046419,100.67784058007331,107.08221248428256,115.78562068364502,120.82544433961542,127.15988228640438,121.8888263318959,124.16554102751346,121.1701021537456,115.73862234207721,108.87210919598968,118.78712700291456,108.80174442271621,103.89894147015096,102.26578318591149,103.96876203439118,100.3333102686602,106.78541060148657,113.90663212242455,106.81110944210471,104.11076190027327,100.34714439495386,100.98196243944497,94.582001148563933,91.08705042938621,100.40241906030954,106.76562636236579,115.17217110454024,115.53682265414776,115.84976519535215,122.07299502178014,120.99392243738205,128.02295473481448,127.87629413030029,123.49747955876322,120.09801363184036,129.44309516421438,127.14275167866529,127.45227984229953,118.0643552316624,115.14279735351832,124.77008417791606,125.2616103653136,126.36154109689326,127.19050169068308,123.05264180603356,123.88879111579539,129.05796266703786,132.30517000502826,131.82456718834968,128.50969331416221,136.05642681087286,139.61786322372885,145.35437421019108,139.9241068966958,130.99371927401901,121.00731317962439,114.56585587079556,123.35220264348121],"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>In both plots, we see that today’s value is not independent of past values. In contrast to cross-sectional data (e.g. individual incomes), time series often require special methods to account for memory and nonstationarity.</p>
<div id="stationary." class="section level4 unnumbered hasAnchor">
<h4><strong>Stationary</strong>.<a href="observational-data.html#stationary." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A stationary time series is one whose statistical properties — mean, variance, and autocovariance — do not change over time. Formally</p>
<ul>
<li>Stationary Means: <span class="math inline">\(E[y_{t}]=E[y_{t&#39;}]\)</span> for all periods <span class="math inline">\(t, t&#39;\)</span></li>
<li>Stationary Vars: <span class="math inline">\(V[y_{t}]=V[y_{t&#39;}]\)</span> for all periods <span class="math inline">\(t, t&#39;\)</span></li>
</ul>
<p>E.g., <span class="math inline">\(y_t = \beta t + u_t, \quad u_t \sim \text{N}(0, \sigma + \alpha t)\)</span></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="observational-data.html#cb200-1" tabindex="-1"></a>tN <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb200-2"><a href="observational-data.html#cb200-2" tabindex="-1"></a>simulate_series <span class="ot">&lt;-</span> <span class="cf">function</span>(beta, alpha, <span class="at">sigma=</span>.<span class="dv">2</span>){</span>
<span id="cb200-3"><a href="observational-data.html#cb200-3" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="fu">numeric</span>(tN)</span>
<span id="cb200-4"><a href="observational-data.html#cb200-4" tabindex="-1"></a>    <span class="cf">for</span> (ti <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>tN) {</span>
<span id="cb200-5"><a href="observational-data.html#cb200-5" tabindex="-1"></a>        mean_ti <span class="ot">&lt;-</span> beta<span class="sc">*</span>ti</span>
<span id="cb200-6"><a href="observational-data.html#cb200-6" tabindex="-1"></a>        sd_ti <span class="ot">&lt;-</span> (.<span class="dv">2</span> <span class="sc">+</span> alpha<span class="sc">*</span>ti)</span>
<span id="cb200-7"><a href="observational-data.html#cb200-7" tabindex="-1"></a>        y[ti] <span class="ot">&lt;-</span> mean_ti <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">sd=</span>sd_ti)</span>
<span id="cb200-8"><a href="observational-data.html#cb200-8" tabindex="-1"></a>    }</span>
<span id="cb200-9"><a href="observational-data.html#cb200-9" tabindex="-1"></a>    <span class="fu">return</span>(y)</span>
<span id="cb200-10"><a href="observational-data.html#cb200-10" tabindex="-1"></a>}</span>
<span id="cb200-11"><a href="observational-data.html#cb200-11" tabindex="-1"></a></span>
<span id="cb200-12"><a href="observational-data.html#cb200-12" tabindex="-1"></a><span class="co"># Plotting Functions</span></span>
<span id="cb200-13"><a href="observational-data.html#cb200-13" tabindex="-1"></a>plot_setup <span class="ot">&lt;-</span> <span class="cf">function</span>(alpha, beta){</span>
<span id="cb200-14"><a href="observational-data.html#cb200-14" tabindex="-1"></a>    <span class="fu">plot.new</span>()</span>
<span id="cb200-15"><a href="observational-data.html#cb200-15" tabindex="-1"></a>    <span class="fu">plot.window</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">1</span>,tN), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">20</span>))</span>
<span id="cb200-16"><a href="observational-data.html#cb200-16" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="dv">1</span>)</span>
<span id="cb200-17"><a href="observational-data.html#cb200-17" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb200-18"><a href="observational-data.html#cb200-18" tabindex="-1"></a>    <span class="fu">mtext</span>(<span class="fu">expression</span>(y[t]),<span class="dv">2</span>, <span class="at">line=</span><span class="fl">2.5</span>)</span>
<span id="cb200-19"><a href="observational-data.html#cb200-19" tabindex="-1"></a>    <span class="fu">mtext</span>(<span class="st">&quot;Time (t)&quot;</span>, <span class="dv">1</span>, <span class="at">line=</span><span class="fl">2.5</span>)</span>
<span id="cb200-20"><a href="observational-data.html#cb200-20" tabindex="-1"></a>}</span>
<span id="cb200-21"><a href="observational-data.html#cb200-21" tabindex="-1"></a>plot_title <span class="ot">&lt;-</span> <span class="cf">function</span>(alpha, beta){</span>
<span id="cb200-22"><a href="observational-data.html#cb200-22" tabindex="-1"></a>    beta_name <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(beta<span class="sc">==</span><span class="dv">0</span>, <span class="st">&#39;Mean Stationary&#39;</span>, <span class="st">&#39;Mean Nonstationary&#39;</span>)</span>
<span id="cb200-23"><a href="observational-data.html#cb200-23" tabindex="-1"></a>    alpha_name <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(alpha<span class="sc">==</span><span class="dv">0</span>, <span class="st">&#39;Var Stationary&#39;</span>, <span class="st">&#39;Var Nonstationary&#39;</span>)</span>
<span id="cb200-24"><a href="observational-data.html#cb200-24" tabindex="-1"></a>    <span class="fu">title</span>(<span class="fu">paste0</span>(beta_name,<span class="st">&#39;, &#39;</span>, alpha_name), <span class="at">font.main=</span><span class="dv">1</span>, <span class="at">adj=</span><span class="dv">0</span>)</span>
<span id="cb200-25"><a href="observational-data.html#cb200-25" tabindex="-1"></a>}</span>
<span id="cb200-26"><a href="observational-data.html#cb200-26" tabindex="-1"></a></span>
<span id="cb200-27"><a href="observational-data.html#cb200-27" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb200-28"><a href="observational-data.html#cb200-28" tabindex="-1"></a><span class="cf">for</span>(alpha <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">015</span>)){</span>
<span id="cb200-29"><a href="observational-data.html#cb200-29" tabindex="-1"></a><span class="cf">for</span>(beta <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">05</span>)){</span>
<span id="cb200-30"><a href="observational-data.html#cb200-30" tabindex="-1"></a>    <span class="fu">plot_setup</span>(<span class="at">alpha=</span>alpha, <span class="at">beta=</span>beta)</span>
<span id="cb200-31"><a href="observational-data.html#cb200-31" tabindex="-1"></a>    <span class="cf">for</span>( sim <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;blue&#39;</span>)){</span>
<span id="cb200-32"><a href="observational-data.html#cb200-32" tabindex="-1"></a>        y_sim <span class="ot">&lt;-</span> <span class="fu">simulate_series</span>(<span class="at">beta=</span>beta, <span class="at">alpha=</span>alpha)</span>
<span id="cb200-33"><a href="observational-data.html#cb200-33" tabindex="-1"></a>        <span class="fu">lines</span>(y_sim, <span class="at">col=</span><span class="fu">adjustcolor</span>(sim ,<span class="at">alpha.f=</span><span class="fl">0.5</span>), <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb200-34"><a href="observational-data.html#cb200-34" tabindex="-1"></a>    }</span>
<span id="cb200-35"><a href="observational-data.html#cb200-35" tabindex="-1"></a>    <span class="fu">plot_title</span>(<span class="at">alpha=</span>alpha, <span class="at">beta=</span>beta)</span>
<span id="cb200-36"><a href="observational-data.html#cb200-36" tabindex="-1"></a>}}</span></code></pre></div>
</details>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
</div>
<div id="measures-of-temporal-association." class="section level4 unnumbered hasAnchor">
<h4><strong>Measures of temporal association</strong>.<a href="observational-data.html#measures-of-temporal-association." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Time series often exhibit serial dependence—values today are related to past values, and potentially to other processes evolving over time. We can visualize this using correlation-based diagnostics.</p>
<p>The Autocorrelation Function (AFC) measures correlation between a time series and its own lagged values:</p>
<p><span class="math inline">\(ACF_{Y}(k) = \frac{Cov(Y_{t},Y_{t-k})}{ \sqrt{Var(Y_{t})Var(Y_{t-k})}}\)</span></p>
<p>This helps detect temporal persistence (memory). For stationary processes, the ACF typically decays quickly, whereas for nonstationary processes, it typically decays slowly or persists.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="observational-data.html#cb201-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb201-2"><a href="observational-data.html#cb201-2" tabindex="-1"></a><span class="cf">for</span>(alpha <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">015</span>)){</span>
<span id="cb201-3"><a href="observational-data.html#cb201-3" tabindex="-1"></a><span class="cf">for</span>(beta <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">05</span>)){</span>
<span id="cb201-4"><a href="observational-data.html#cb201-4" tabindex="-1"></a>    y_sim <span class="ot">&lt;-</span> <span class="fu">simulate_series</span>(<span class="at">beta=</span>beta, <span class="at">alpha=</span>alpha)</span>
<span id="cb201-5"><a href="observational-data.html#cb201-5" tabindex="-1"></a>    <span class="fu">acf</span>(y_sim, <span class="at">main=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb201-6"><a href="observational-data.html#cb201-6" tabindex="-1"></a>    <span class="fu">plot_title</span>(<span class="at">alpha=</span>alpha, <span class="at">beta=</span>beta)</span>
<span id="cb201-7"><a href="observational-data.html#cb201-7" tabindex="-1"></a>}}</span></code></pre></div>
</details>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<p>The Cross-Correlation Function (CCF) measures correlation between two time series at different lags:</p>
<p><span class="math inline">\(CCF_{YX}(k) = \frac{Cov(Y_{t},X_{t-k})}{ \sqrt{Var(Y_t)Var(X_{t-k})}}\)</span></p>
<p>This is useful for detecting lagged relationships between two series, such as leading indicators or external drivers. (If <span class="math inline">\(X\)</span> is white noise, any visible structure in the CCF likely reflects nonstationarity in <span class="math inline">\(Y\)</span>.)</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="observational-data.html#cb202-1" tabindex="-1"></a>x_sim <span class="ot">&lt;-</span> <span class="fu">runif</span>(tN, <span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="co"># White Noise</span></span>
<span id="cb202-2"><a href="observational-data.html#cb202-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb202-3"><a href="observational-data.html#cb202-3" tabindex="-1"></a><span class="cf">for</span>(alpha <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">015</span>)){</span>
<span id="cb202-4"><a href="observational-data.html#cb202-4" tabindex="-1"></a><span class="cf">for</span>(beta <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">05</span>)){</span>
<span id="cb202-5"><a href="observational-data.html#cb202-5" tabindex="-1"></a>    y_sim <span class="ot">&lt;-</span> <span class="fu">simulate_series</span>(<span class="at">beta=</span>beta, <span class="at">alpha=</span>alpha)</span>
<span id="cb202-6"><a href="observational-data.html#cb202-6" tabindex="-1"></a>    <span class="fu">ccf</span>(y_sim, x_sim, <span class="at">main=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb202-7"><a href="observational-data.html#cb202-7" tabindex="-1"></a>    <span class="fu">plot_title</span>(<span class="at">alpha=</span>alpha, <span class="at">beta=</span>beta)</span>
<span id="cb202-8"><a href="observational-data.html#cb202-8" tabindex="-1"></a>}}</span></code></pre></div>
</details>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
</div>
</div>
<div id="spatial-interdependence" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> Spatial Interdependence<a href="observational-data.html#spatial-interdependence" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Many observational datasets exhibit spatial dependence, meaning that values at one location tend to be related to values at nearby locations. This violates the standard assumption of independent observations used in many classical statistical methods.</p>
<p>For example, elevation is spatially dependent: if one location is at high elevation, nearby locations are also likely (though not guaranteed) to be high. Similarly, socioeconomic outcomes like disease rates or income often cluster geographically due to shared environmental or social factors.</p>
<p>Just as stock prices today depend on yesterday, spatial variables often depend on neighboring regions, creating a need for specialized statistical methods that account for spatial autocorrelation.</p>
<div id="raster-vs.-vector-data." class="section level4 unnumbered hasAnchor">
<h4><strong>Raster vs. Vector Data</strong>.<a href="observational-data.html#raster-vs.-vector-data." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Spatial data typically comes in two formats, each suited to different types of information:</p>
<ul>
<li>Vector data uses geometric shapes (points, lines, polygons) to store data. E.g., a census tract map that stores data on population demographics.</li>
<li>Raster data uses grid cells (typically squares, but sometimes hexagons) to store data. E.g., an image that stores data on elevation above seawater.</li>
</ul>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="observational-data.html#cb203-1" tabindex="-1"></a><span class="co"># Vector Data</span></span>
<span id="cb203-2"><a href="observational-data.html#cb203-2" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb203-3"><a href="observational-data.html#cb203-3" tabindex="-1"></a>northcarolina_vector <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">system.file</span>(<span class="st">&quot;shape/nc.shp&quot;</span>, <span class="at">package=</span><span class="st">&quot;sf&quot;</span>))</span>
<span id="cb203-4"><a href="observational-data.html#cb203-4" tabindex="-1"></a><span class="do">## Reading layer `nc&#39; from data source `/home/Jadamso/R-Libs/sf/shape/nc.shp&#39; using driver `ESRI Shapefile&#39;</span></span>
<span id="cb203-5"><a href="observational-data.html#cb203-5" tabindex="-1"></a><span class="do">## Simple feature collection with 100 features and 14 fields</span></span>
<span id="cb203-6"><a href="observational-data.html#cb203-6" tabindex="-1"></a><span class="do">## Geometry type: MULTIPOLYGON</span></span>
<span id="cb203-7"><a href="observational-data.html#cb203-7" tabindex="-1"></a><span class="do">## Dimension:     XY</span></span>
<span id="cb203-8"><a href="observational-data.html#cb203-8" tabindex="-1"></a><span class="do">## Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965</span></span>
<span id="cb203-9"><a href="observational-data.html#cb203-9" tabindex="-1"></a><span class="do">## Geodetic CRS:  NAD27</span></span>
<span id="cb203-10"><a href="observational-data.html#cb203-10" tabindex="-1"></a><span class="fu">plot</span>(northcarolina_vector[<span class="st">&#39;BIR74&#39;</span>], <span class="at">main=</span><span class="st">&#39;Number of Live Births in 1974&#39;</span>)</span></code></pre></div>
</details>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="observational-data.html#cb204-1" tabindex="-1"></a><span class="co"># https://r-spatial.github.io/spdep/articles/sids.html</span></span></code></pre></div>
</details>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="observational-data.html#cb205-1" tabindex="-1"></a><span class="co"># Raster Data</span></span>
<span id="cb205-2"><a href="observational-data.html#cb205-2" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb205-3"><a href="observational-data.html#cb205-3" tabindex="-1"></a>luxembourg_elevation_raster <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">system.file</span>(<span class="st">&quot;ex/elev.tif&quot;</span>, <span class="at">package=</span><span class="st">&quot;terra&quot;</span>))</span>
<span id="cb205-4"><a href="observational-data.html#cb205-4" tabindex="-1"></a><span class="fu">plot</span>(luxembourg_elevation_raster)</span></code></pre></div>
</details>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
</div>
<div id="stationary.-1" class="section level4 unnumbered hasAnchor">
<h4><strong>Stationary.</strong><a href="observational-data.html#stationary.-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Just as with temporal data, stationarity in spatial data means that the statistical properties (like mean, variance, or spatial correlation) are roughly the same across space.</p>
<ul>
<li>Stationary Means: <span class="math inline">\(E[y(s)]=E[y(s&#39;)]\)</span> for all locations <span class="math inline">\(s,s&#39;\)</span></li>
<li>Stationary Vars: <span class="math inline">\(V[y(s)]=V[y(s&#39;)]\)</span> for all locations <span class="math inline">\(s,s&#39;\)</span></li>
</ul>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="observational-data.html#cb206-1" tabindex="-1"></a><span class="co"># Simulated 2D spatial fields</span></span>
<span id="cb206-2"><a href="observational-data.html#cb206-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb206-3"><a href="observational-data.html#cb206-3" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb206-4"><a href="observational-data.html#cb206-4" tabindex="-1"></a>x <span class="ot">&lt;-</span> y <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> n)</span>
<span id="cb206-5"><a href="observational-data.html#cb206-5" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb206-6"><a href="observational-data.html#cb206-6" tabindex="-1"></a></span>
<span id="cb206-7"><a href="observational-data.html#cb206-7" tabindex="-1"></a><span class="co"># 1. Stationary: Gaussian with constant mean and var</span></span>
<span id="cb206-8"><a href="observational-data.html#cb206-8" tabindex="-1"></a>z_stationary <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n<span class="sc">^</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>), n, n)</span>
<span id="cb206-9"><a href="observational-data.html#cb206-9" tabindex="-1"></a></span>
<span id="cb206-10"><a href="observational-data.html#cb206-10" tabindex="-1"></a><span class="co"># 2. Nonstationary: Mean increases with x and y</span></span>
<span id="cb206-11"><a href="observational-data.html#cb206-11" tabindex="-1"></a>z_nonstationary <span class="ot">&lt;-</span> <span class="fu">outer</span>(x, y, <span class="cf">function</span>(x, y) <span class="dv">3</span><span class="sc">*</span>x<span class="sc">*</span>y) <span class="sc">+</span> <span class="fu">rnorm</span>(n<span class="sc">^</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb206-12"><a href="observational-data.html#cb206-12" tabindex="-1"></a></span>
<span id="cb206-13"><a href="observational-data.html#cb206-13" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb206-14"><a href="observational-data.html#cb206-14" tabindex="-1"></a><span class="co"># Stationary field</span></span>
<span id="cb206-15"><a href="observational-data.html#cb206-15" tabindex="-1"></a><span class="fu">image</span>(x, y, z_stationary,</span>
<span id="cb206-16"><a href="observational-data.html#cb206-16" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Stationary Field&quot;</span>,</span>
<span id="cb206-17"><a href="observational-data.html#cb206-17" tabindex="-1"></a>      <span class="at">col =</span> <span class="fu">terrain.colors</span>(<span class="dv">100</span>),</span>
<span id="cb206-18"><a href="observational-data.html#cb206-18" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;y&quot;</span>)</span>
<span id="cb206-19"><a href="observational-data.html#cb206-19" tabindex="-1"></a><span class="co"># Nonstationary field</span></span>
<span id="cb206-20"><a href="observational-data.html#cb206-20" tabindex="-1"></a><span class="fu">image</span>(x, y, z_nonstationary,</span>
<span id="cb206-21"><a href="observational-data.html#cb206-21" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Nonstationary Field&quot;</span>,</span>
<span id="cb206-22"><a href="observational-data.html#cb206-22" tabindex="-1"></a>      <span class="at">col =</span> <span class="fu">terrain.colors</span>(<span class="dv">100</span>),</span>
<span id="cb206-23"><a href="observational-data.html#cb206-23" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
</details>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
</div>
<div id="measures-of-spatial-association." class="section level4 unnumbered hasAnchor">
<h4><strong>Measures of spatial association</strong>.<a href="observational-data.html#measures-of-spatial-association." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Just like temporal data may exhibit autocorrelation, spatial data may show spatial autocorrelation or spatial cross-correlation—meaning that observations located near each other are more (or less) similar than we would expect under spatial independence.</p>
<p>Autocorrelation. We can measure spatial <em>autocorrelation</em> using Moran’s I, a standard index of spatial dependence. Global Moran’s I summarizes overall spatial association (just like the ACF)</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="observational-data.html#cb207-1" tabindex="-1"></a><span class="co"># Raster Data Example</span></span>
<span id="cb207-2"><a href="observational-data.html#cb207-2" tabindex="-1"></a><span class="fu">autocor</span>(luxembourg_elevation_raster, <span class="at">method=</span><span class="st">&#39;moran&#39;</span>, <span class="at">global=</span>T)</span>
<span id="cb207-3"><a href="observational-data.html#cb207-3" tabindex="-1"></a><span class="do">## elevation </span></span>
<span id="cb207-4"><a href="observational-data.html#cb207-4" tabindex="-1"></a><span class="do">## 0.8917057</span></span></code></pre></div>
</details>
<p>Cross-Correlation. We can also assesses the relationship between two variables at varying distances.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="observational-data.html#cb208-1" tabindex="-1"></a><span class="co"># Vector Data Example</span></span>
<span id="cb208-2"><a href="observational-data.html#cb208-2" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(northcarolina_vector)[, <span class="fu">c</span>(<span class="st">&#39;BIR74&#39;</span>, <span class="st">&#39;SID74&#39;</span>)]</span>
<span id="cb208-3"><a href="observational-data.html#cb208-3" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(dat)</span>
<span id="cb208-4"><a href="observational-data.html#cb208-4" tabindex="-1"></a></span>
<span id="cb208-5"><a href="observational-data.html#cb208-5" tabindex="-1"></a><span class="co"># Format Distances</span></span>
<span id="cb208-6"><a href="observational-data.html#cb208-6" tabindex="-1"></a>dmat <span class="ot">&lt;-</span> <span class="fu">st_distance</span>( <span class="fu">st_centroid</span>(northcarolina_vector) )</span>
<span id="cb208-7"><a href="observational-data.html#cb208-7" tabindex="-1"></a>dmat <span class="ot">&lt;-</span> units<span class="sc">::</span><span class="fu">set_units</span>(dmat, <span class="st">&#39;km&#39;</span>)</span>
<span id="cb208-8"><a href="observational-data.html#cb208-8" tabindex="-1"></a></span>
<span id="cb208-9"><a href="observational-data.html#cb208-9" tabindex="-1"></a><span class="co"># At Which Distances to Compute CCF</span></span>
<span id="cb208-10"><a href="observational-data.html#cb208-10" tabindex="-1"></a><span class="co"># summary(dmat[,1])</span></span>
<span id="cb208-11"><a href="observational-data.html#cb208-11" tabindex="-1"></a>rdists <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="at">by=</span><span class="dv">25</span>)) <span class="co"># includes 0</span></span>
<span id="cb208-12"><a href="observational-data.html#cb208-12" tabindex="-1"></a>rdists <span class="ot">&lt;-</span> units<span class="sc">::</span><span class="fu">set_units</span>(rdists , <span class="st">&#39;km&#39;</span>)</span>
<span id="cb208-13"><a href="observational-data.html#cb208-13" tabindex="-1"></a></span>
<span id="cb208-14"><a href="observational-data.html#cb208-14" tabindex="-1"></a><span class="co"># Compute Cross-Covariances</span></span>
<span id="cb208-15"><a href="observational-data.html#cb208-15" tabindex="-1"></a>varXY <span class="ot">&lt;-</span> <span class="fu">prod</span>( <span class="fu">apply</span>(dat, <span class="dv">2</span>, sd) )</span>
<span id="cb208-16"><a href="observational-data.html#cb208-16" tabindex="-1"></a>CCF <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="fu">seq</span>(<span class="dv">2</span>, <span class="fu">length</span>(rdists)), <span class="cf">function</span>(ri){</span>
<span id="cb208-17"><a href="observational-data.html#cb208-17" tabindex="-1"></a>    <span class="co"># Which Observations are within (rmin, rmax] distance</span></span>
<span id="cb208-18"><a href="observational-data.html#cb208-18" tabindex="-1"></a>    dmat_r <span class="ot">&lt;-</span> dmat</span>
<span id="cb208-19"><a href="observational-data.html#cb208-19" tabindex="-1"></a>    d_id <span class="ot">&lt;-</span> (dmat_r <span class="sc">&gt;</span> rdists[ri<span class="dv">-1</span>] <span class="sc">&amp;</span> dmat_r <span class="sc">&lt;=</span> rdists[ri]) </span>
<span id="cb208-20"><a href="observational-data.html#cb208-20" tabindex="-1"></a>    dmat_r[<span class="sc">!</span>d_id]  <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb208-21"><a href="observational-data.html#cb208-21" tabindex="-1"></a>    <span class="co"># Compute All Covariances (Stationary)</span></span>
<span id="cb208-22"><a href="observational-data.html#cb208-22" tabindex="-1"></a>    covs_r <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dmat_r), <span class="cf">function</span>(i){</span>
<span id="cb208-23"><a href="observational-data.html#cb208-23" tabindex="-1"></a>        pairsi <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(dmat_r[i,]))        </span>
<span id="cb208-24"><a href="observational-data.html#cb208-24" tabindex="-1"></a>        covXiYj <span class="ot">&lt;-</span> <span class="fu">sapply</span>(pairsi, <span class="cf">function</span>(j) {</span>
<span id="cb208-25"><a href="observational-data.html#cb208-25" tabindex="-1"></a>            dXi <span class="ot">&lt;-</span> dat[i,<span class="dv">1</span>] <span class="sc">-</span> mu[<span class="dv">1</span>]</span>
<span id="cb208-26"><a href="observational-data.html#cb208-26" tabindex="-1"></a>            dYj <span class="ot">&lt;-</span> dat[j,<span class="dv">2</span>] <span class="sc">-</span> mu[<span class="dv">2</span>]</span>
<span id="cb208-27"><a href="observational-data.html#cb208-27" tabindex="-1"></a>            <span class="fu">return</span>(dXi<span class="sc">*</span>dYj)</span>
<span id="cb208-28"><a href="observational-data.html#cb208-28" tabindex="-1"></a>        })</span>
<span id="cb208-29"><a href="observational-data.html#cb208-29" tabindex="-1"></a>        <span class="fu">return</span>(covXiYj)</span>
<span id="cb208-30"><a href="observational-data.html#cb208-30" tabindex="-1"></a>    })</span>
<span id="cb208-31"><a href="observational-data.html#cb208-31" tabindex="-1"></a>    corXY <span class="ot">&lt;-</span> <span class="fu">unlist</span>(covs_r)<span class="sc">/</span>varXY</span>
<span id="cb208-32"><a href="observational-data.html#cb208-32" tabindex="-1"></a>    <span class="fu">return</span>(corXY)</span>
<span id="cb208-33"><a href="observational-data.html#cb208-33" tabindex="-1"></a>} )</span></code></pre></div>
</details>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="observational-data.html#cb209-1" tabindex="-1"></a><span class="co"># Plot Cross-Covariance Function</span></span>
<span id="cb209-2"><a href="observational-data.html#cb209-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(rdists[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb209-3"><a href="observational-data.html#cb209-3" tabindex="-1"></a></span>
<span id="cb209-4"><a href="observational-data.html#cb209-4" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb209-5"><a href="observational-data.html#cb209-5" tabindex="-1"></a></span>
<span id="cb209-6"><a href="observational-data.html#cb209-6" tabindex="-1"></a><span class="co"># Distributional Summary</span></span>
<span id="cb209-7"><a href="observational-data.html#cb209-7" tabindex="-1"></a><span class="fu">boxplot</span>(CCF,</span>
<span id="cb209-8"><a href="observational-data.html#cb209-8" tabindex="-1"></a>    <span class="at">outline=</span>F, <span class="at">whisklty=</span><span class="dv">0</span>, <span class="at">staplelty=</span><span class="dv">0</span>,</span>
<span id="cb209-9"><a href="observational-data.html#cb209-9" tabindex="-1"></a>    <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>), <span class="co">#quantile(unlist(CCF), probs=c(.05,.95)),</span></span>
<span id="cb209-10"><a href="observational-data.html#cb209-10" tabindex="-1"></a>    <span class="at">names=</span>x, </span>
<span id="cb209-11"><a href="observational-data.html#cb209-11" tabindex="-1"></a>    <span class="at">main=</span><span class="st">&#39;&#39;</span>,</span>
<span id="cb209-12"><a href="observational-data.html#cb209-12" tabindex="-1"></a>    <span class="at">font.main=</span><span class="dv">1</span>,</span>
<span id="cb209-13"><a href="observational-data.html#cb209-13" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">&#39;Distance [km]&#39;</span>,</span>
<span id="cb209-14"><a href="observational-data.html#cb209-14" tabindex="-1"></a>    <span class="at">ylab=</span><span class="st">&#39;Cross-Correlation of BIR74 and SID74&#39;</span>)</span>
<span id="cb209-15"><a href="observational-data.html#cb209-15" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Binned Medians and IQRs&#39;</span>, <span class="at">font.main=</span><span class="dv">1</span>, <span class="at">adj=</span><span class="dv">0</span>)</span>
<span id="cb209-16"><a href="observational-data.html#cb209-16" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb209-17"><a href="observational-data.html#cb209-17" tabindex="-1"></a></span>
<span id="cb209-18"><a href="observational-data.html#cb209-18" tabindex="-1"></a><span class="co"># Inferential Summary</span></span>
<span id="cb209-19"><a href="observational-data.html#cb209-19" tabindex="-1"></a>CCF_means <span class="ot">&lt;-</span> <span class="fu">sapply</span>(CCF, mean)</span>
<span id="cb209-20"><a href="observational-data.html#cb209-20" tabindex="-1"></a><span class="fu">plot</span>(x, CCF_means,</span>
<span id="cb209-21"><a href="observational-data.html#cb209-21" tabindex="-1"></a>    <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb209-22"><a href="observational-data.html#cb209-22" tabindex="-1"></a>    <span class="at">type=</span><span class="st">&#39;o&#39;</span>, <span class="at">pch=</span><span class="dv">16</span>,</span>
<span id="cb209-23"><a href="observational-data.html#cb209-23" tabindex="-1"></a>    <span class="at">main=</span><span class="st">&#39;&#39;</span>,</span>
<span id="cb209-24"><a href="observational-data.html#cb209-24" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">&#39;Distance [km]&#39;</span>,</span>
<span id="cb209-25"><a href="observational-data.html#cb209-25" tabindex="-1"></a>    <span class="at">ylab=</span><span class="st">&#39;Cross-Correlation of BIR74 and SID74&#39;</span>)</span>
<span id="cb209-26"><a href="observational-data.html#cb209-26" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Binned Means + 95% Confidence Band&#39;</span>, <span class="at">font.main=</span><span class="dv">1</span>, <span class="at">adj=</span><span class="dv">0</span>)</span>
<span id="cb209-27"><a href="observational-data.html#cb209-27" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>)    </span>
<span id="cb209-28"><a href="observational-data.html#cb209-28" tabindex="-1"></a><span class="co"># Quick and Dirty Subsampling CI</span></span>
<span id="cb209-29"><a href="observational-data.html#cb209-29" tabindex="-1"></a>CCF_meanCI <span class="ot">&lt;-</span> <span class="fu">sapply</span>(CCF, <span class="cf">function</span>(corXY){</span>
<span id="cb209-30"><a href="observational-data.html#cb209-30" tabindex="-1"></a>    ss_size <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">length</span>(corXY)<span class="sc">*</span><span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>)</span>
<span id="cb209-31"><a href="observational-data.html#cb209-31" tabindex="-1"></a>    corXY_boot <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>, <span class="cf">function</span>(b){</span>
<span id="cb209-32"><a href="observational-data.html#cb209-32" tabindex="-1"></a>        corXY_b <span class="ot">&lt;-</span> <span class="fu">sample</span>(corXY, ss_size, <span class="at">replace=</span>F)</span>
<span id="cb209-33"><a href="observational-data.html#cb209-33" tabindex="-1"></a>        <span class="fu">mean</span>(corXY_b, <span class="at">na.rm=</span>T)</span>
<span id="cb209-34"><a href="observational-data.html#cb209-34" tabindex="-1"></a>    })</span>
<span id="cb209-35"><a href="observational-data.html#cb209-35" tabindex="-1"></a>    <span class="fu">quantile</span>(corXY_boot,  <span class="at">probs=</span><span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb209-36"><a href="observational-data.html#cb209-36" tabindex="-1"></a>})</span>
<span id="cb209-37"><a href="observational-data.html#cb209-37" tabindex="-1"></a><span class="fu">polygon</span>( <span class="fu">c</span>(x, <span class="fu">rev</span>(x)), </span>
<span id="cb209-38"><a href="observational-data.html#cb209-38" tabindex="-1"></a>    <span class="fu">c</span>(CCF_meanCI[<span class="dv">1</span>,], <span class="fu">rev</span>(CCF_meanCI[<span class="dv">2</span>,])), </span>
<span id="cb209-39"><a href="observational-data.html#cb209-39" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">25</span>), <span class="at">border=</span><span class="cn">NA</span>)</span></code></pre></div>
</details>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
</div>
</div>
<div id="variable-interdependence" class="section level2 hasAnchor" number="13.3">
<h2><span class="header-section-number">13.3</span> Variable Interdependence<a href="observational-data.html#variable-interdependence" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In addition to spatial and temporal dependence, many observational datasets exhibit interdependence between variables. Many economic variables are endogenous: meaning that they are an outcome determined (or caused: <span class="math inline">\(\to\)</span>) by some other variable.</p>
<ul>
<li>If <span class="math inline">\(Y \to X\)</span>, then we have reverse causality</li>
<li>If <span class="math inline">\(Y \to X\)</span> and <span class="math inline">\(X \to Y\)</span>, then we have simultaneity</li>
<li>If <span class="math inline">\(Z\to Y\)</span> and either <span class="math inline">\(Z\to X\)</span> or <span class="math inline">\(X \to Z\)</span>, then we have omitted a potentially important variable</li>
</ul>
<p>These endogeneity issues imply <span class="math inline">\(X\)</span> and <span class="math inline">\(\epsilon\)</span> are correlated, which is a barrier to interpreting OLS estimates causally. (<span class="math inline">\(X\)</span> and <span class="math inline">\(\epsilon\)</span> may be correlated for other reasons too, such as when <span class="math inline">\(X\)</span> is measured with error.)</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="observational-data.html#cb210-1" tabindex="-1"></a><span class="co"># Simulate data with an endogeneity issue</span></span>
<span id="cb210-2"><a href="observational-data.html#cb210-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb210-3"><a href="observational-data.html#cb210-3" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n,<span class="dv">1</span>,.<span class="dv">5</span>)</span>
<span id="cb210-4"><a href="observational-data.html#cb210-4" tabindex="-1"></a>xy <span class="ot">&lt;-</span> <span class="fu">sapply</span>(z, <span class="cf">function</span>(zi){</span>
<span id="cb210-5"><a href="observational-data.html#cb210-5" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,zi,<span class="dv">1</span>)</span>
<span id="cb210-6"><a href="observational-data.html#cb210-6" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,zi<span class="sc">*</span><span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb210-7"><a href="observational-data.html#cb210-7" tabindex="-1"></a>    <span class="fu">c</span>(x,y)</span>
<span id="cb210-8"><a href="observational-data.html#cb210-8" tabindex="-1"></a>})</span>
<span id="cb210-9"><a href="observational-data.html#cb210-9" tabindex="-1"></a>xy <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>xy[<span class="dv">1</span>,],<span class="at">y=</span>xy[<span class="dv">2</span>,])</span>
<span id="cb210-10"><a href="observational-data.html#cb210-10" tabindex="-1"></a><span class="fu">plot</span>(y<span class="sc">~</span>x, <span class="at">data=</span>xy, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">5</span>))</span>
<span id="cb210-11"><a href="observational-data.html#cb210-11" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y<span class="sc">~</span>x,<span class="at">data=</span>xy))</span></code></pre></div>
</details>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<p>With multiple linear regression, endogeneity biases are not just a problem for your main variable of interest. Suppose your interested in how <span class="math inline">\(x_{1}\)</span> affects <span class="math inline">\(y\)</span>, conditional on <span class="math inline">\(x_{2}\)</span>. Letting <span class="math inline">\(X=[x_{1}, x_{2}]\)</span>, you estimate
<span class="math display">\[\begin{eqnarray}
\hat{\beta}_{OLS} = [X&#39;X]^{-1}X&#39;y
\end{eqnarray}\]</span>
You paid special attention in your research design to find a case where <span class="math inline">\(x_{1}\)</span> is truly exogenous. Unfortunately, <span class="math inline">\(x_{2}\)</span> is correlated with the error term. (How unfair, I know, especially after all that work). Nonetheless,
<span class="math display">\[\begin{eqnarray}
\mathbb{E}[X&#39;\epsilon] =
\begin{bmatrix}
0 \\ \rho
\end{bmatrix}\\
\mathbb{E}[ \hat{\beta}_{OLS} - \beta] = [X&#39;X]^{-1} \begin{bmatrix}
0 \\ \rho
\end{bmatrix} =
\begin{bmatrix}
\rho_{1} \\ \rho_{2}
\end{bmatrix}
\end{eqnarray}\]</span>
The magnitude of the bias for <span class="math inline">\(x_{1}\)</span> thus depends on the correlations between <span class="math inline">\(x_{1}\)</span> and <span class="math inline">\(x_{2}\)</span> as well as <span class="math inline">\(x_{2}\)</span> and <span class="math inline">\(\epsilon\)</span>.</p>
<p>I will focus on the seminal economic example to provide some intuition.</p>
<div id="competitive-market-equilibrium." class="section level4 unnumbered hasAnchor">
<h4><strong>Competitive Market Equilibrium</strong>.<a href="observational-data.html#competitive-market-equilibrium." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This model has three structural relationships: (1) market supply is the sum of quantities supplied by individual firms at a given price, (2) market demand is the sum of quantities demanded by individual people at a given price, and (3) market supply equals market demand in equilibrium. Assuming market supply and demand are linear, we can write these three relationships as
<span class="math display">\[\begin{eqnarray}
\label{eqn:market_supply}
Q_{S}(P) &amp;=&amp; A_{S} + B_{S} P + E_{S},\\
\label{eqn:market_demand}
Q_{D}(P) &amp;=&amp; A_{D} - B_{D} P + E_{D},\\
\label{eqn:market_eq}
Q_{D} &amp;=&amp; Q_{S} = Q.
%%  $Q_{D}(P) = \sum_{i} q_{D}_{i}(P)$,
\end{eqnarray}\]</span>
This last equation implies a simultaneous “reduced form” relationship where both the price and the quantity are outcomes. With a linear parametric structure to these equations, we can use algebra to solve for the equilibrium price and quantity analytically as
<span class="math display">\[\begin{eqnarray}
P^{*} &amp;=&amp; \frac{A_{D}-A_{S}}{B_{D}+B_{S}} + \frac{E_{D} - E_{S}}{B_{D}+B_{S}}, \\
Q^{*} &amp;=&amp; \frac{A_{S}B_{D}+ A_{D}B_{S}}{B_{D}+B_{S}} + \frac{E_{S}B_{D}+ E_{D}B_{S}}{B_{D}+B_{S}}.
\end{eqnarray}\]</span></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="observational-data.html#cb211-1" tabindex="-1"></a><span class="co"># Demand Curve Simulator</span></span>
<span id="cb211-2"><a href="observational-data.html#cb211-2" tabindex="-1"></a>qd_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p, <span class="at">Ad=</span><span class="dv">8</span>, <span class="at">Bd=</span><span class="sc">-</span>.<span class="dv">8</span>, <span class="at">Ed_sigma=</span>.<span class="dv">25</span>){</span>
<span id="cb211-3"><a href="observational-data.html#cb211-3" tabindex="-1"></a>    Qd <span class="ot">&lt;-</span> Ad <span class="sc">+</span> Bd<span class="sc">*</span>p <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,Ed_sigma)</span>
<span id="cb211-4"><a href="observational-data.html#cb211-4" tabindex="-1"></a>    <span class="fu">return</span>(Qd)</span>
<span id="cb211-5"><a href="observational-data.html#cb211-5" tabindex="-1"></a>}</span>
<span id="cb211-6"><a href="observational-data.html#cb211-6" tabindex="-1"></a></span>
<span id="cb211-7"><a href="observational-data.html#cb211-7" tabindex="-1"></a><span class="co"># Supply Curve Simulator</span></span>
<span id="cb211-8"><a href="observational-data.html#cb211-8" tabindex="-1"></a>qs_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p, <span class="at">As=</span><span class="sc">-</span><span class="dv">8</span>, <span class="at">Bs=</span><span class="dv">1</span>, <span class="at">Es_sigma=</span>.<span class="dv">25</span>){</span>
<span id="cb211-9"><a href="observational-data.html#cb211-9" tabindex="-1"></a>    Qs <span class="ot">&lt;-</span> As <span class="sc">+</span> Bs<span class="sc">*</span>p <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,Es_sigma)</span>
<span id="cb211-10"><a href="observational-data.html#cb211-10" tabindex="-1"></a>    <span class="fu">return</span>(Qs)</span>
<span id="cb211-11"><a href="observational-data.html#cb211-11" tabindex="-1"></a>}</span>
<span id="cb211-12"><a href="observational-data.html#cb211-12" tabindex="-1"></a></span>
<span id="cb211-13"><a href="observational-data.html#cb211-13" tabindex="-1"></a><span class="co"># Quantity Supplied and Demanded at 3 Prices</span></span>
<span id="cb211-14"><a href="observational-data.html#cb211-14" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">P=</span><span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">D=</span><span class="fu">qd_fun</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>), <span class="at">S=</span><span class="fu">qs_fun</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb211-15"><a href="observational-data.html#cb211-15" tabindex="-1"></a><span class="do">##       P          D          S</span></span>
<span id="cb211-16"><a href="observational-data.html#cb211-16" tabindex="-1"></a><span class="do">## [1,]  8  1.1925652 0.01120111</span></span>
<span id="cb211-17"><a href="observational-data.html#cb211-17" tabindex="-1"></a><span class="do">## [2,]  9  0.3925652 1.01120111</span></span>
<span id="cb211-18"><a href="observational-data.html#cb211-18" tabindex="-1"></a><span class="do">## [3,] 10 -0.4074348 2.01120111</span></span>
<span id="cb211-19"><a href="observational-data.html#cb211-19" tabindex="-1"></a></span>
<span id="cb211-20"><a href="observational-data.html#cb211-20" tabindex="-1"></a><span class="co"># Market Equilibrium Finder</span></span>
<span id="cb211-21"><a href="observational-data.html#cb211-21" tabindex="-1"></a>eq_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(demand, supply, P){</span>
<span id="cb211-22"><a href="observational-data.html#cb211-22" tabindex="-1"></a>    <span class="co"># Compute EQ (what we observe)</span></span>
<span id="cb211-23"><a href="observational-data.html#cb211-23" tabindex="-1"></a>    eq_id <span class="ot">&lt;-</span> <span class="fu">which.min</span>( <span class="fu">abs</span>(demand<span class="sc">-</span>supply) )</span>
<span id="cb211-24"><a href="observational-data.html#cb211-24" tabindex="-1"></a>    eq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">P=</span>P[eq_id], <span class="at">Q=</span>demand[eq_id]) </span>
<span id="cb211-25"><a href="observational-data.html#cb211-25" tabindex="-1"></a>    <span class="fu">return</span>(eq)</span>
<span id="cb211-26"><a href="observational-data.html#cb211-26" tabindex="-1"></a>}</span></code></pre></div>
</details>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="observational-data.html#cb212-1" tabindex="-1"></a><span class="co"># Simulations Parameters</span></span>
<span id="cb212-2"><a href="observational-data.html#cb212-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">300</span> <span class="co"># Number of Market Interactions</span></span>
<span id="cb212-3"><a href="observational-data.html#cb212-3" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="at">by=</span>.<span class="dv">01</span>) <span class="co"># Price Range to Consider</span></span>
<span id="cb212-4"><a href="observational-data.html#cb212-4" tabindex="-1"></a></span>
<span id="cb212-5"><a href="observational-data.html#cb212-5" tabindex="-1"></a><span class="co"># Generate Data from Competitive Market  </span></span>
<span id="cb212-6"><a href="observational-data.html#cb212-6" tabindex="-1"></a><span class="co"># Plot Underlying Process</span></span>
<span id="cb212-7"><a href="observational-data.html#cb212-7" tabindex="-1"></a><span class="fu">plot.new</span>()</span>
<span id="cb212-8"><a href="observational-data.html#cb212-8" tabindex="-1"></a><span class="fu">plot.window</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="at">ylim=</span><span class="fu">range</span>(P))</span>
<span id="cb212-9"><a href="observational-data.html#cb212-9" tabindex="-1"></a>EQ1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="cf">function</span>(n){</span>
<span id="cb212-10"><a href="observational-data.html#cb212-10" tabindex="-1"></a>    <span class="co"># Market Data Generating Process</span></span>
<span id="cb212-11"><a href="observational-data.html#cb212-11" tabindex="-1"></a>    demand <span class="ot">&lt;-</span> <span class="fu">qd_fun</span>(P)</span>
<span id="cb212-12"><a href="observational-data.html#cb212-12" tabindex="-1"></a>    supply <span class="ot">&lt;-</span> <span class="fu">qs_fun</span>(P)</span>
<span id="cb212-13"><a href="observational-data.html#cb212-13" tabindex="-1"></a>    eq <span class="ot">&lt;-</span> <span class="fu">eq_fun</span>(demand, supply, P)    </span>
<span id="cb212-14"><a href="observational-data.html#cb212-14" tabindex="-1"></a>    <span class="co"># Plot Theoretical Supply and Demand</span></span>
<span id="cb212-15"><a href="observational-data.html#cb212-15" tabindex="-1"></a>    <span class="fu">lines</span>(demand, P, <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">01</span>))</span>
<span id="cb212-16"><a href="observational-data.html#cb212-16" tabindex="-1"></a>    <span class="fu">lines</span>(supply, P, <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">01</span>))</span>
<span id="cb212-17"><a href="observational-data.html#cb212-17" tabindex="-1"></a>    <span class="fu">points</span>(eq[<span class="dv">2</span>], eq[<span class="dv">1</span>], <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">05</span>), <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb212-18"><a href="observational-data.html#cb212-18" tabindex="-1"></a>    <span class="co"># Save Data</span></span>
<span id="cb212-19"><a href="observational-data.html#cb212-19" tabindex="-1"></a>    <span class="fu">return</span>(eq)</span>
<span id="cb212-20"><a href="observational-data.html#cb212-20" tabindex="-1"></a>})</span>
<span id="cb212-21"><a href="observational-data.html#cb212-21" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>)</span>
<span id="cb212-22"><a href="observational-data.html#cb212-22" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>)</span>
<span id="cb212-23"><a href="observational-data.html#cb212-23" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&#39;Quantity&#39;</span>,<span class="dv">1</span>, <span class="at">line=</span><span class="dv">2</span>)</span>
<span id="cb212-24"><a href="observational-data.html#cb212-24" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&#39;Price&#39;</span>,<span class="dv">2</span>, <span class="at">line=</span><span class="dv">2</span>)</span></code></pre></div>
</details>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<p>Suppose we ask “what is the effect of price on quantity?” You can simply run a regression of quantity (“Y”) on price (“X”): <span class="math inline">\(\widehat{\beta}_{OLS} = Cov(Q^{*}, P^{*}) / Var(P^{*})\)</span>. You get a number back, but it is hard to interpret meaningfully.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="observational-data.html#cb213-1" tabindex="-1"></a><span class="co"># Analyze Market Data</span></span>
<span id="cb213-2"><a href="observational-data.html#cb213-2" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(EQ1), <span class="at">cost=</span><span class="st">&#39;1&#39;</span>, <span class="at">T=</span><span class="dv">1</span><span class="sc">:</span>N)</span>
<span id="cb213-3"><a href="observational-data.html#cb213-3" tabindex="-1"></a>reg1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Q<span class="sc">~</span>P, <span class="at">data=</span>dat1)</span>
<span id="cb213-4"><a href="observational-data.html#cb213-4" tabindex="-1"></a><span class="fu">summary</span>(reg1)</span>
<span id="cb213-5"><a href="observational-data.html#cb213-5" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb213-6"><a href="observational-data.html#cb213-6" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb213-7"><a href="observational-data.html#cb213-7" tabindex="-1"></a><span class="do">## lm(formula = Q ~ P, data = dat1)</span></span>
<span id="cb213-8"><a href="observational-data.html#cb213-8" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb213-9"><a href="observational-data.html#cb213-9" tabindex="-1"></a><span class="do">## Residuals:</span></span>
<span id="cb213-10"><a href="observational-data.html#cb213-10" tabindex="-1"></a><span class="do">##      Min       1Q   Median       3Q      Max </span></span>
<span id="cb213-11"><a href="observational-data.html#cb213-11" tabindex="-1"></a><span class="do">## -0.57279 -0.11977 -0.00272  0.11959  0.45525 </span></span>
<span id="cb213-12"><a href="observational-data.html#cb213-12" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb213-13"><a href="observational-data.html#cb213-13" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb213-14"><a href="observational-data.html#cb213-14" tabindex="-1"></a><span class="do">##             Estimate Std. Error t value Pr(&gt;|t|)  </span></span>
<span id="cb213-15"><a href="observational-data.html#cb213-15" tabindex="-1"></a><span class="do">## (Intercept) -0.21323    0.43212  -0.493   0.6221  </span></span>
<span id="cb213-16"><a href="observational-data.html#cb213-16" tabindex="-1"></a><span class="do">## P            0.12355    0.04864   2.540   0.0116 *</span></span>
<span id="cb213-17"><a href="observational-data.html#cb213-17" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb213-18"><a href="observational-data.html#cb213-18" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb213-19"><a href="observational-data.html#cb213-19" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb213-20"><a href="observational-data.html#cb213-20" tabindex="-1"></a><span class="do">## Residual standard error: 0.1674 on 298 degrees of freedom</span></span>
<span id="cb213-21"><a href="observational-data.html#cb213-21" tabindex="-1"></a><span class="do">## Multiple R-squared:  0.02119,    Adjusted R-squared:  0.0179 </span></span>
<span id="cb213-22"><a href="observational-data.html#cb213-22" tabindex="-1"></a><span class="do">## F-statistic: 6.451 on 1 and 298 DF,  p-value: 0.0116</span></span></code></pre></div>
</details>
<p>This simple derivation has a profound insight: price-quantity data does not generally tell you how price affects quantity (or vice-versa). The reason is simultaneity: price and quantity mutually cause one another in markets.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>
<p>Moreover, this example also clarifies that our initial question “what is the effect of price on quantity?” is misguided. We could more sensibly ask “what is the effect of price on quantity supplied?” or “what is the effect of price on quantity demanded?”</p>
</div>
</div>
<div id="further-reading-8" class="section level2 hasAnchor" number="13.4">
<h2><span class="header-section-number">13.4</span> Further Reading<a href="observational-data.html#further-reading-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="6">
<li id="fn6"><p>Although there are many ways this simultaneity can happen, economic theorists have made great strides in analyzing the simultaneity problem as it arises from equilibrium market relationships. In fact, 2SLS arose to understand agricultural markets.<a href="observational-data.html#fnref6" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intermediate-regression-ii.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="experimental-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["index.pdf", "index.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
