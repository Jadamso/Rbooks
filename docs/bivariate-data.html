<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> 10 Bivariate Data | index</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content=" 10 Bivariate Data | index" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 10 Bivariate Data | index" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reporting.html"/>
<link rel="next" href="multivariate-data.html"/>
<script src="libs/jquery-3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/core-js-2.5.3/shim.min.js"></script>
<script src="libs/react-18.2.0/react.min.js"></script>
<script src="libs/react-18.2.0/react-dom.min.js"></script>
<script src="libs/reactwidget-2.0.0/react-tools.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/reactable-0.4.4/reactable.css" rel="stylesheet" />
<script src="libs/reactable-binding-0.4.4/reactable.js"></script>
<script src="libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<script src="libs/d3-3.5.6/d3.min.js"></script>
<link href="libs/profvis-0.3.6.9000/profvis.css" rel="stylesheet" />
<script src="libs/profvis-0.3.6.9000/profvis.js"></script>
<script src="libs/profvis-0.3.6.9000/scroll.js"></script>
<link href="libs/highlight-11.10.0/textmate.css" rel="stylesheet" />
<script src="libs/highlight-11.10.0/highlight.min.js"></script>
<script src="libs/profvis-binding-0.4.0/profvis.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Rbooks</a></li>
<li class="toc-logo"><a href="./"><img src="Figures_Manual/Logo.png" width="140" height="100"></a></li>        

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="part"><span><b>I Data Analysis in R</b></span></li>
<li class="chapter" data-level="2" data-path="first-steps.html"><a href="first-steps.html"><i class="fa fa-check"></i><b>2</b> First Steps</a>
<ul>
<li class="chapter" data-level="2.1" data-path="first-steps.html"><a href="first-steps.html#why-r"><i class="fa fa-check"></i><b>2.1</b> Why R</a></li>
<li class="chapter" data-level="2.2" data-path="first-steps.html"><a href="first-steps.html#install-r"><i class="fa fa-check"></i><b>2.2</b> Install R</a></li>
<li class="chapter" data-level="2.3" data-path="first-steps.html"><a href="first-steps.html#interfacing-with-r"><i class="fa fa-check"></i><b>2.3</b> Interfacing with R</a></li>
<li class="chapter" data-level="2.4" data-path="first-steps.html"><a href="first-steps.html#introductions-to-r"><i class="fa fa-check"></i><b>2.4</b> Introductions to R</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mathematics.html"><a href="mathematics.html"><i class="fa fa-check"></i><b>3</b> Mathematics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mathematics.html"><a href="mathematics.html#scalars"><i class="fa fa-check"></i><b>3.1</b> Scalars</a></li>
<li class="chapter" data-level="3.2" data-path="mathematics.html"><a href="mathematics.html#vectors"><i class="fa fa-check"></i><b>3.2</b> Vectors</a></li>
<li class="chapter" data-level="3.3" data-path="mathematics.html"><a href="mathematics.html#functions"><i class="fa fa-check"></i><b>3.3</b> Functions</a></li>
<li class="chapter" data-level="3.4" data-path="mathematics.html"><a href="mathematics.html#logic"><i class="fa fa-check"></i><b>3.4</b> Logic</a></li>
<li class="chapter" data-level="3.5" data-path="mathematics.html"><a href="mathematics.html#matrices"><i class="fa fa-check"></i><b>3.5</b> Matrices</a></li>
<li class="chapter" data-level="3.6" data-path="mathematics.html"><a href="mathematics.html#arrays"><i class="fa fa-check"></i><b>3.6</b> Arrays</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>4</b> Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data.html"><a href="data.html#types"><i class="fa fa-check"></i><b>4.1</b> Types</a></li>
<li class="chapter" data-level="4.2" data-path="data.html"><a href="data.html#distributions"><i class="fa fa-check"></i><b>4.2</b> Distributions</a></li>
<li class="chapter" data-level="4.3" data-path="data.html"><a href="data.html#conditional-distributions"><i class="fa fa-check"></i><b>4.3</b> Conditional Distributions</a></li>
<li class="chapter" data-level="4.4" data-path="data.html"><a href="data.html#joint-distributions"><i class="fa fa-check"></i><b>4.4</b> Joint Distributions</a></li>
<li class="chapter" data-level="4.5" data-path="data.html"><a href="data.html#further-reading"><i class="fa fa-check"></i><b>4.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="statistics.html"><a href="statistics.html"><i class="fa fa-check"></i><b>5</b> Statistics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="statistics.html"><a href="statistics.html#random-variables"><i class="fa fa-check"></i><b>5.1</b> Random Variables</a></li>
<li class="chapter" data-level="5.2" data-path="statistics.html"><a href="statistics.html#centerspread-statistics"><i class="fa fa-check"></i><b>5.2</b> Center/Spread Statistics</a></li>
<li class="chapter" data-level="5.3" data-path="statistics.html"><a href="statistics.html#shape-statistics"><i class="fa fa-check"></i><b>5.3</b> Shape Statistics</a></li>
<li class="chapter" data-level="5.4" data-path="statistics.html"><a href="statistics.html#beyond-basics"><i class="fa fa-check"></i><b>5.4</b> Beyond Basics</a></li>
<li class="chapter" data-level="5.5" data-path="statistics.html"><a href="statistics.html#further-reading-1"><i class="fa fa-check"></i><b>5.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="resampling.html"><a href="resampling.html"><i class="fa fa-check"></i><b>6</b> (Re)Sampling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="resampling.html"><a href="resampling.html#sample-distributions"><i class="fa fa-check"></i><b>6.1</b> Sample Distributions</a></li>
<li class="chapter" data-level="6.2" data-path="resampling.html"><a href="resampling.html#intervals"><i class="fa fa-check"></i><b>6.2</b> Intervals</a></li>
<li class="chapter" data-level="6.3" data-path="resampling.html"><a href="resampling.html#resampling-1"><i class="fa fa-check"></i><b>6.3</b> Resampling</a></li>
<li class="chapter" data-level="6.4" data-path="resampling.html"><a href="resampling.html#value-of-more-data"><i class="fa fa-check"></i><b>6.4</b> Value of More Data</a></li>
<li class="chapter" data-level="6.5" data-path="resampling.html"><a href="resampling.html#further-reading-2"><i class="fa fa-check"></i><b>6.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="hypothesis-tests.html"><a href="hypothesis-tests.html"><i class="fa fa-check"></i><b>7</b> Hypothesis Tests</a>
<ul>
<li class="chapter" data-level="7.1" data-path="hypothesis-tests.html"><a href="hypothesis-tests.html#basic-ideas"><i class="fa fa-check"></i><b>7.1</b> Basic Ideas</a></li>
<li class="chapter" data-level="7.2" data-path="hypothesis-tests.html"><a href="hypothesis-tests.html#default-statistics"><i class="fa fa-check"></i><b>7.2</b> Default Statistics</a></li>
<li class="chapter" data-level="7.3" data-path="hypothesis-tests.html"><a href="hypothesis-tests.html#two-sample-differences"><i class="fa fa-check"></i><b>7.3</b> Two-Sample Differences</a></li>
<li class="chapter" data-level="7.4" data-path="hypothesis-tests.html"><a href="hypothesis-tests.html#distributional-tests"><i class="fa fa-check"></i><b>7.4</b> Distributional Tests</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-analysis.html"><a href="data-analysis.html"><i class="fa fa-check"></i><b>8</b> Data Analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-analysis.html"><a href="data-analysis.html#reading-in"><i class="fa fa-check"></i><b>8.1</b> Reading In</a></li>
<li class="chapter" data-level="8.2" data-path="data-analysis.html"><a href="data-analysis.html#cleaning-data"><i class="fa fa-check"></i><b>8.2</b> Cleaning Data</a></li>
<li class="chapter" data-level="8.3" data-path="data-analysis.html"><a href="data-analysis.html#polishing"><i class="fa fa-check"></i><b>8.3</b> Polishing</a></li>
<li class="chapter" data-level="8.4" data-path="data-analysis.html"><a href="data-analysis.html#interactive"><i class="fa fa-check"></i><b>8.4</b> Interactive</a></li>
<li class="chapter" data-level="8.5" data-path="data-analysis.html"><a href="data-analysis.html#custom-figures"><i class="fa fa-check"></i><b>8.5</b> Custom Figures</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="reporting.html"><a href="reporting.html"><i class="fa fa-check"></i><b>9</b> Reporting</a>
<ul>
<li class="chapter" data-level="9.1" data-path="reporting.html"><a href="reporting.html#r-and-r-markdown"><i class="fa fa-check"></i><b>9.1</b> R and R-Markdown</a></li>
<li class="chapter" data-level="9.2" data-path="reporting.html"><a href="reporting.html#simple-reports"><i class="fa fa-check"></i><b>9.2</b> Simple Reports</a></li>
<li class="chapter" data-level="9.3" data-path="reporting.html"><a href="reporting.html#posters-and-slides"><i class="fa fa-check"></i><b>9.3</b> Posters and Slides</a></li>
<li class="chapter" data-level="9.4" data-path="reporting.html"><a href="reporting.html#more-literature"><i class="fa fa-check"></i><b>9.4</b> More Literature</a></li>
</ul></li>
<li class="part"><span><b>II Linear Regression in R</b></span></li>
<li class="chapter" data-level="10" data-path="bivariate-data.html"><a href="bivariate-data.html"><i class="fa fa-check"></i><b>10</b> Bivariate Data</a>
<ul>
<li class="chapter" data-level="10.1" data-path="bivariate-data.html"><a href="bivariate-data.html#linear-correlation"><i class="fa fa-check"></i><b>10.1</b> Linear Correlation</a></li>
<li class="chapter" data-level="10.2" data-path="bivariate-data.html"><a href="bivariate-data.html#simple-linear-regression"><i class="fa fa-check"></i><b>10.2</b> Simple Linear Regression</a></li>
<li class="chapter" data-level="10.3" data-path="bivariate-data.html"><a href="bivariate-data.html#variability-estimates"><i class="fa fa-check"></i><b>10.3</b> Variability Estimates</a></li>
<li class="chapter" data-level="10.4" data-path="bivariate-data.html"><a href="bivariate-data.html#hypothesis-tests-1"><i class="fa fa-check"></i><b>10.4</b> Hypothesis Tests</a></li>
<li class="chapter" data-level="10.5" data-path="bivariate-data.html"><a href="bivariate-data.html#prediction-intervals"><i class="fa fa-check"></i><b>10.5</b> Prediction Intervals</a></li>
<li class="chapter" data-level="10.6" data-path="bivariate-data.html"><a href="bivariate-data.html#locally-linear"><i class="fa fa-check"></i><b>10.6</b> Locally Linear</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="multivariate-data.html"><a href="multivariate-data.html"><i class="fa fa-check"></i><b>11</b> Multivariate Data</a>
<ul>
<li class="chapter" data-level="11.1" data-path="multivariate-data.html"><a href="multivariate-data.html#multiple-linear-regression"><i class="fa fa-check"></i><b>11.1</b> Multiple Linear Regression</a></li>
<li class="chapter" data-level="11.2" data-path="multivariate-data.html"><a href="multivariate-data.html#variability-and-hypothesis-tests"><i class="fa fa-check"></i><b>11.2</b> Variability and Hypothesis Tests</a></li>
<li class="chapter" data-level="11.3" data-path="multivariate-data.html"><a href="multivariate-data.html#factor-variables"><i class="fa fa-check"></i><b>11.3</b> Factor Variables</a></li>
<li class="chapter" data-level="11.4" data-path="multivariate-data.html"><a href="multivariate-data.html#coefficient-interpretation"><i class="fa fa-check"></i><b>11.4</b> Coefficient Interpretation</a></li>
<li class="chapter" data-level="11.5" data-path="multivariate-data.html"><a href="multivariate-data.html#transformations"><i class="fa fa-check"></i><b>11.5</b> Transformations</a></li>
<li class="chapter" data-level="11.6" data-path="multivariate-data.html"><a href="multivariate-data.html#diagnostics"><i class="fa fa-check"></i><b>11.6</b> Diagnostics</a></li>
<li class="chapter" data-level="11.7" data-path="multivariate-data.html"><a href="multivariate-data.html#more-literature-1"><i class="fa fa-check"></i><b>11.7</b> More Literature</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="endogeneity-issues.html"><a href="endogeneity-issues.html"><i class="fa fa-check"></i><b>12</b> Endogeneity Issues</a>
<ul>
<li class="chapter" data-level="12.1" data-path="endogeneity-issues.html"><a href="endogeneity-issues.html#two-stage-least-squares-2sls"><i class="fa fa-check"></i><b>12.1</b> Two Stage Least Squares (2SLS)</a></li>
<li class="chapter" data-level="12.2" data-path="endogeneity-issues.html"><a href="endogeneity-issues.html#regression-discontinuitieskink-rdrk"><i class="fa fa-check"></i><b>12.2</b> Regression Discontinuities/Kink (RD/RK)</a></li>
<li class="chapter" data-level="12.3" data-path="endogeneity-issues.html"><a href="endogeneity-issues.html#difference-in-differences-did"><i class="fa fa-check"></i><b>12.3</b> Difference in Differences (DID)</a></li>
<li class="chapter" data-level="12.4" data-path="endogeneity-issues.html"><a href="endogeneity-issues.html#more-literature-2"><i class="fa fa-check"></i><b>12.4</b> More Literature</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="data-scientism.html"><a href="data-scientism.html"><i class="fa fa-check"></i><b>13</b> Data Scientism</a>
<ul>
<li class="chapter" data-level="13.1" data-path="data-scientism.html"><a href="data-scientism.html#data-errors"><i class="fa fa-check"></i><b>13.1</b> Data Errors</a></li>
<li class="chapter" data-level="13.2" data-path="data-scientism.html"><a href="data-scientism.html#p-hacking"><i class="fa fa-check"></i><b>13.2</b> P-Hacking</a></li>
<li class="chapter" data-level="13.3" data-path="data-scientism.html"><a href="data-scientism.html#spurious-regression"><i class="fa fa-check"></i><b>13.3</b> Spurious Regression</a></li>
<li class="chapter" data-level="13.4" data-path="data-scientism.html"><a href="data-scientism.html#spurious-causal-impacts"><i class="fa fa-check"></i><b>13.4</b> Spurious Causal Impacts</a></li>
</ul></li>
<li class="part"><span><b>III Reproducible Research in R</b></span></li>
<li class="chapter" data-level="14" data-path="why.html"><a href="why.html"><i class="fa fa-check"></i><b>14</b> Why?</a>
<ul>
<li class="chapter" data-level="14.1" data-path="why.html"><a href="why.html#an-example-workflow"><i class="fa fa-check"></i><b>14.1</b> An example workflow</a></li>
<li class="chapter" data-level="14.2" data-path="why.html"><a href="why.html#an-alternative-workflow"><i class="fa fa-check"></i><b>14.2</b> An alternative workflow</a></li>
<li class="chapter" data-level="14.3" data-path="why.html"><a href="why.html#task-views"><i class="fa fa-check"></i><b>14.3</b> Task Views</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="large-projects.html"><a href="large-projects.html"><i class="fa fa-check"></i><b>15</b> Large Projects</a>
<ul>
<li class="chapter" data-level="15.1" data-path="large-projects.html"><a href="large-projects.html#scripting"><i class="fa fa-check"></i><b>15.1</b> Scripting</a></li>
<li class="chapter" data-level="15.2" data-path="large-projects.html"><a href="large-projects.html#organization"><i class="fa fa-check"></i><b>15.2</b> Organization</a></li>
<li class="chapter" data-level="15.3" data-path="large-projects.html"><a href="large-projects.html#loggingsinking"><i class="fa fa-check"></i><b>15.3</b> Logging/Sinking</a></li>
<li class="chapter" data-level="15.4" data-path="large-projects.html"><a href="large-projects.html#class-projects"><i class="fa fa-check"></i><b>15.4</b> Class Projects</a></li>
<li class="chapter" data-level="15.5" data-path="large-projects.html"><a href="large-projects.html#debugging"><i class="fa fa-check"></i><b>15.5</b> Debugging</a></li>
<li class="chapter" data-level="15.6" data-path="large-projects.html"><a href="large-projects.html#optimizing"><i class="fa fa-check"></i><b>15.6</b> Optimizing</a></li>
<li class="chapter" data-level="15.7" data-path="large-projects.html"><a href="large-projects.html#more-literature-3"><i class="fa fa-check"></i><b>15.7</b> More Literature</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>16</b> Applications</a>
<ul>
<li class="chapter" data-level="16.1" data-path="applications.html"><a href="applications.html#more-literature-4"><i class="fa fa-check"></i><b>16.1</b> More Literature</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="software.html"><a href="software.html"><i class="fa fa-check"></i><b>17</b> Software</a>
<ul>
<li class="chapter" data-level="17.1" data-path="software.html"><a href="software.html#latest-versions"><i class="fa fa-check"></i><b>17.1</b> Latest versions</a></li>
<li class="chapter" data-level="17.2" data-path="software.html"><a href="software.html#general-workflow"><i class="fa fa-check"></i><b>17.2</b> General Workflow</a></li>
<li class="chapter" data-level="17.3" data-path="software.html"><a href="software.html#sweave"><i class="fa fa-check"></i><b>17.3</b> Sweave</a></li>
<li class="chapter" data-level="17.4" data-path="software.html"><a href="software.html#stata"><i class="fa fa-check"></i><b>17.4</b> Stata</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://sites.google.com/view/jordan-adamson" target="blank">Jordan Adamson</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bivariate-data" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number"> 10</span> Bivariate Data<a href="bivariate-data.html#bivariate-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<hr />
<p>Given some data</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="bivariate-data.html#cb376-1" tabindex="-1"></a><span class="co"># Bivariate Data from USArrests</span></span>
<span id="cb376-2"><a href="bivariate-data.html#cb376-2" tabindex="-1"></a>xy <span class="ot">&lt;-</span> USArrests[,<span class="fu">c</span>(<span class="st">&#39;Murder&#39;</span>,<span class="st">&#39;UrbanPop&#39;</span>)]</span>
<span id="cb376-3"><a href="bivariate-data.html#cb376-3" tabindex="-1"></a><span class="fu">colnames</span>(xy) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;y&#39;</span>,<span class="st">&#39;x&#39;</span>)</span></code></pre></div>
<p>first inspect it, as in Part I.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="bivariate-data.html#cb377-1" tabindex="-1"></a><span class="co"># Inspect Dataset</span></span>
<span id="cb377-2"><a href="bivariate-data.html#cb377-2" tabindex="-1"></a><span class="co"># head(xy)</span></span>
<span id="cb377-3"><a href="bivariate-data.html#cb377-3" tabindex="-1"></a><span class="co"># summary(xy)</span></span>
<span id="cb377-4"><a href="bivariate-data.html#cb377-4" tabindex="-1"></a><span class="fu">plot</span>(y<span class="sc">~</span>x, xy, <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">pch=</span><span class="dv">16</span>)</span></code></pre></div>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div id="linear-correlation" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Linear Correlation<a href="bivariate-data.html#linear-correlation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To quantitatively describe the relationship between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span>, you can compute the covariance:
<span class="math display">\[
\widehat{Cov}(X,Y) =  \sum_{i} [X_i - \bar{x}] [Y_i - \bar{y}]
\]</span></p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="bivariate-data.html#cb378-1" tabindex="-1"></a><span class="fu">cov</span>(xy)</span></code></pre></div>
<pre><code>##           y          x
## y 18.970465   4.386204
## x  4.386204 209.518776</code></pre>
<p>Note that <span class="math inline">\(\widehat{Cov}(X,X)=\widehat{Var}(X)\)</span>.
For ease of interpretation, we rescale this statistic to always lay between <span class="math inline">\(-1\)</span> and <span class="math inline">\(1\)</span>
<span class="math display">\[
\widehat{Cor}(X,Y) = \frac{\widehat{Cov}(X,Y) }{ \sqrt{\widehat{Cov}(X,X)} \sqrt{\widehat{Cov}(Y,Y)}}
\]</span></p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="bivariate-data.html#cb380-1" tabindex="-1"></a><span class="fu">cor</span>(xy)</span></code></pre></div>
<pre><code>##            y          x
## y 1.00000000 0.06957262
## x 0.06957262 1.00000000</code></pre>
</div>
<div id="simple-linear-regression" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Simple Linear Regression<a href="bivariate-data.html#simple-linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Simple Linear Regression refers to fitting a linear model to bivariate data. Specifically, the model is
<span class="math display">\[
y_i=\beta_{0}+\beta_{1} x_i+\epsilon_{i}
\]</span>
and our objective function is
<span class="math display">\[
min_{\beta_{0}, \beta_{1}} \sum_{i=1}^{N} \left( \epsilon_{i} \right)^2 =  min_{\beta_{0}, \beta_{1}} \sum_{i=1} \left( y_i - [\beta_{0}+\beta_{1} x_i] \right).
\]</span>
Minimizing the sum of squared errors yields parameter estimates
<span class="math display">\[
\hat{\beta_{0}}=\bar{y}-\hat{\beta_{1}}\bar{x} = \widehat{\mathbb{E}}[Y] - \hat{\beta_{1}} \widehat{\mathbb{E}}[X] \\
\hat{\beta_{1}}=\frac{\sum_{i}^{}(x_i-\bar{x})(y_i-\bar{y})}{\sum_{i}^{}(x_i-\bar{x})^2} = \frac{\widehat{Cov}[X,Y]}{\widehat{Var}[X]}
\]</span>
and predictions
<span class="math display">\[
\hat{y}_i=\hat{\beta_{0}}+\hat{\beta}x_i\\
\hat{\epsilon}_i=y_i-\hat{y}_i
\]</span></p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="bivariate-data.html#cb382-1" tabindex="-1"></a><span class="co"># Estimate Regression Coefficients</span></span>
<span id="cb382-2"><a href="bivariate-data.html#cb382-2" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">dat=</span>xy)</span>
<span id="cb382-3"><a href="bivariate-data.html#cb382-3" tabindex="-1"></a>reg </span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x, data = xy)
## 
## Coefficients:
## (Intercept)            x  
##     6.41594      0.02093</code></pre>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="bivariate-data.html#cb384-1" tabindex="-1"></a><span class="co"># Coefficient Estimates</span></span>
<span id="cb384-2"><a href="bivariate-data.html#cb384-2" tabindex="-1"></a><span class="fu">coef</span>(reg)</span></code></pre></div>
<pre><code>## (Intercept)           x 
##  6.41594246  0.02093466</code></pre>
<p>To qualitatively analyze the ‘’Goodness of fit’’ of our model, we plot our predictions.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="bivariate-data.html#cb386-1" tabindex="-1"></a><span class="co"># Plot Data and Predictions</span></span>
<span id="cb386-2"><a href="bivariate-data.html#cb386-2" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb386-3"><a href="bivariate-data.html#cb386-3" tabindex="-1"></a>xy<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">rownames</span>(USArrests)</span>
<span id="cb386-4"><a href="bivariate-data.html#cb386-4" tabindex="-1"></a>xy<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(reg)</span>
<span id="cb386-5"><a href="bivariate-data.html#cb386-5" tabindex="-1"></a>xy<span class="sc">$</span>resid <span class="ot">&lt;-</span> <span class="fu">resid</span>(reg)</span>
<span id="cb386-6"><a href="bivariate-data.html#cb386-6" tabindex="-1"></a>fig <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>(</span>
<span id="cb386-7"><a href="bivariate-data.html#cb386-7" tabindex="-1"></a>  xy, <span class="at">x=</span><span class="sc">~</span>x, <span class="at">y=</span><span class="sc">~</span>y,</span>
<span id="cb386-8"><a href="bivariate-data.html#cb386-8" tabindex="-1"></a>  <span class="at">mode=</span><span class="st">&#39;markers&#39;</span>,</span>
<span id="cb386-9"><a href="bivariate-data.html#cb386-9" tabindex="-1"></a>  <span class="at">type=</span><span class="st">&#39;scatter&#39;</span>,</span>
<span id="cb386-10"><a href="bivariate-data.html#cb386-10" tabindex="-1"></a>  <span class="at">hoverinfo=</span><span class="st">&#39;text&#39;</span>,</span>
<span id="cb386-11"><a href="bivariate-data.html#cb386-11" tabindex="-1"></a>  <span class="at">marker=</span><span class="fu">list</span>(<span class="at">color=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">25</span>), <span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb386-12"><a href="bivariate-data.html#cb386-12" tabindex="-1"></a>  <span class="at">text=</span><span class="sc">~</span><span class="fu">paste</span>(<span class="st">&#39;&lt;b&gt;&#39;</span>, ID, <span class="st">&#39;&lt;/b&gt;&#39;</span>,</span>
<span id="cb386-13"><a href="bivariate-data.html#cb386-13" tabindex="-1"></a>              <span class="st">&#39;&lt;br&gt;Urban  :&#39;</span>, x,</span>
<span id="cb386-14"><a href="bivariate-data.html#cb386-14" tabindex="-1"></a>              <span class="st">&#39;&lt;br&gt;Murder :&#39;</span>, y,</span>
<span id="cb386-15"><a href="bivariate-data.html#cb386-15" tabindex="-1"></a>              <span class="st">&#39;&lt;br&gt;Predicted Murder :&#39;</span>, <span class="fu">round</span>(pred,<span class="dv">2</span>),</span>
<span id="cb386-16"><a href="bivariate-data.html#cb386-16" tabindex="-1"></a>              <span class="st">&#39;&lt;br&gt;Residual :&#39;</span>, <span class="fu">round</span>(resid,<span class="dv">2</span>)))              </span>
<span id="cb386-17"><a href="bivariate-data.html#cb386-17" tabindex="-1"></a><span class="co"># Add Legend</span></span>
<span id="cb386-18"><a href="bivariate-data.html#cb386-18" tabindex="-1"></a>fig <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">layout</span>(fig,</span>
<span id="cb386-19"><a href="bivariate-data.html#cb386-19" tabindex="-1"></a>          <span class="at">showlegend=</span>F,</span>
<span id="cb386-20"><a href="bivariate-data.html#cb386-20" tabindex="-1"></a>          <span class="at">title=</span><span class="st">&#39;Crime and Urbanization in America 1975&#39;</span>,</span>
<span id="cb386-21"><a href="bivariate-data.html#cb386-21" tabindex="-1"></a>          <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title=</span><span class="st">&#39;Percent of People in an Urban Area&#39;</span>),</span>
<span id="cb386-22"><a href="bivariate-data.html#cb386-22" tabindex="-1"></a>          <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title=</span><span class="st">&#39;Homicide Arrests per 100,000 People&#39;</span>))</span>
<span id="cb386-23"><a href="bivariate-data.html#cb386-23" tabindex="-1"></a><span class="co"># Plot Model Predictions</span></span>
<span id="cb386-24"><a href="bivariate-data.html#cb386-24" tabindex="-1"></a><span class="fu">add_trace</span>(fig, <span class="at">x=</span><span class="sc">~</span>x, <span class="at">y=</span><span class="sc">~</span>pred,</span>
<span id="cb386-25"><a href="bivariate-data.html#cb386-25" tabindex="-1"></a>    <span class="at">inherit=</span>F, <span class="at">hoverinfo=</span><span class="st">&#39;none&#39;</span>,</span>
<span id="cb386-26"><a href="bivariate-data.html#cb386-26" tabindex="-1"></a>    <span class="at">mode=</span><span class="st">&#39;lines+markers&#39;</span>, <span class="at">type=</span><span class="st">&#39;scatter&#39;</span>,</span>
<span id="cb386-27"><a href="bivariate-data.html#cb386-27" tabindex="-1"></a>    <span class="at">color=</span><span class="fu">I</span>(<span class="st">&#39;black&#39;</span>),</span>
<span id="cb386-28"><a href="bivariate-data.html#cb386-28" tabindex="-1"></a>    <span class="at">line=</span><span class="fu">list</span>(<span class="at">width=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb386-29"><a href="bivariate-data.html#cb386-29" tabindex="-1"></a>    <span class="at">marker=</span><span class="fu">list</span>(<span class="at">symbol=</span><span class="dv">134</span>, <span class="at">size=</span><span class="dv">5</span>))</span></code></pre></div>
<div class="plotly html-widget html-fill-item" id="htmlwidget-e5eef9f1a2ab21fb87a1" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-e5eef9f1a2ab21fb87a1">{"x":{"visdat":{"2a0a5cae89dc":["function () ","plotlyVisDat"]},"cur_data":"2a0a5cae89dc","attrs":{"2a0a5cae89dc":{"x":{},"y":{},"mode":"markers","hoverinfo":"text","marker":{"color":"#00000040","size":10},"text":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"2a0a5cae89dc.1":{"x":{},"y":{},"hoverinfo":"none","mode":"lines+markers","type":"scatter","color":["black"],"line":{"width":0.5},"marker":{"symbol":134,"size":5},"inherit":false}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"showlegend":false,"title":"Crime and Urbanization in America 1975","xaxis":{"domain":[0,1],"automargin":true,"title":"Percent of People in an Urban Area"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Homicide Arrests per 100,000 People"},"hovermode":"closest"},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[58,48,80,50,91,78,77,72,80,60,83,54,83,65,57,66,52,66,51,67,85,74,66,44,70,53,62,81,56,89,70,86,45,44,75,68,67,72,87,48,45,59,80,80,32,63,73,39,66,60],"y":[13.199999999999999,10,8.0999999999999996,8.8000000000000007,9,7.9000000000000004,3.2999999999999998,5.9000000000000004,15.4,17.399999999999999,5.2999999999999998,2.6000000000000001,10.4,7.2000000000000002,2.2000000000000002,6,9.6999999999999993,15.4,2.1000000000000001,11.300000000000001,4.4000000000000004,12.1,2.7000000000000002,16.100000000000001,9,6,4.2999999999999998,12.199999999999999,2.1000000000000001,7.4000000000000004,11.4,11.1,13,0.80000000000000004,7.2999999999999998,6.5999999999999996,4.9000000000000004,6.2999999999999998,3.3999999999999999,14.4,3.7999999999999998,13.199999999999999,12.699999999999999,3.2000000000000002,2.2000000000000002,8.5,4,5.7000000000000002,2.6000000000000001,6.7999999999999998],"mode":"markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"marker":{"color":"#00000040","size":10,"line":{"color":"rgba(31,119,180,1)"}},"text":["<b> Alabama <\/b> <br>Urban  : 58 <br>Murder : 13.2 <br>Predicted Murder : 7.63 <br>Residual : 5.57","<b> Alaska <\/b> <br>Urban  : 48 <br>Murder : 10 <br>Predicted Murder : 7.42 <br>Residual : 2.58","<b> Arizona <\/b> <br>Urban  : 80 <br>Murder : 8.1 <br>Predicted Murder : 8.09 <br>Residual : 0.01","<b> Arkansas <\/b> <br>Urban  : 50 <br>Murder : 8.8 <br>Predicted Murder : 7.46 <br>Residual : 1.34","<b> California <\/b> <br>Urban  : 91 <br>Murder : 9 <br>Predicted Murder : 8.32 <br>Residual : 0.68","<b> Colorado <\/b> <br>Urban  : 78 <br>Murder : 7.9 <br>Predicted Murder : 8.05 <br>Residual : -0.15","<b> Connecticut <\/b> <br>Urban  : 77 <br>Murder : 3.3 <br>Predicted Murder : 8.03 <br>Residual : -4.73","<b> Delaware <\/b> <br>Urban  : 72 <br>Murder : 5.9 <br>Predicted Murder : 7.92 <br>Residual : -2.02","<b> Florida <\/b> <br>Urban  : 80 <br>Murder : 15.4 <br>Predicted Murder : 8.09 <br>Residual : 7.31","<b> Georgia <\/b> <br>Urban  : 60 <br>Murder : 17.4 <br>Predicted Murder : 7.67 <br>Residual : 9.73","<b> Hawaii <\/b> <br>Urban  : 83 <br>Murder : 5.3 <br>Predicted Murder : 8.15 <br>Residual : -2.85","<b> Idaho <\/b> <br>Urban  : 54 <br>Murder : 2.6 <br>Predicted Murder : 7.55 <br>Residual : -4.95","<b> Illinois <\/b> <br>Urban  : 83 <br>Murder : 10.4 <br>Predicted Murder : 8.15 <br>Residual : 2.25","<b> Indiana <\/b> <br>Urban  : 65 <br>Murder : 7.2 <br>Predicted Murder : 7.78 <br>Residual : -0.58","<b> Iowa <\/b> <br>Urban  : 57 <br>Murder : 2.2 <br>Predicted Murder : 7.61 <br>Residual : -5.41","<b> Kansas <\/b> <br>Urban  : 66 <br>Murder : 6 <br>Predicted Murder : 7.8 <br>Residual : -1.8","<b> Kentucky <\/b> <br>Urban  : 52 <br>Murder : 9.7 <br>Predicted Murder : 7.5 <br>Residual : 2.2","<b> Louisiana <\/b> <br>Urban  : 66 <br>Murder : 15.4 <br>Predicted Murder : 7.8 <br>Residual : 7.6","<b> Maine <\/b> <br>Urban  : 51 <br>Murder : 2.1 <br>Predicted Murder : 7.48 <br>Residual : -5.38","<b> Maryland <\/b> <br>Urban  : 67 <br>Murder : 11.3 <br>Predicted Murder : 7.82 <br>Residual : 3.48","<b> Massachusetts <\/b> <br>Urban  : 85 <br>Murder : 4.4 <br>Predicted Murder : 8.2 <br>Residual : -3.8","<b> Michigan <\/b> <br>Urban  : 74 <br>Murder : 12.1 <br>Predicted Murder : 7.97 <br>Residual : 4.13","<b> Minnesota <\/b> <br>Urban  : 66 <br>Murder : 2.7 <br>Predicted Murder : 7.8 <br>Residual : -5.1","<b> Mississippi <\/b> <br>Urban  : 44 <br>Murder : 16.1 <br>Predicted Murder : 7.34 <br>Residual : 8.76","<b> Missouri <\/b> <br>Urban  : 70 <br>Murder : 9 <br>Predicted Murder : 7.88 <br>Residual : 1.12","<b> Montana <\/b> <br>Urban  : 53 <br>Murder : 6 <br>Predicted Murder : 7.53 <br>Residual : -1.53","<b> Nebraska <\/b> <br>Urban  : 62 <br>Murder : 4.3 <br>Predicted Murder : 7.71 <br>Residual : -3.41","<b> Nevada <\/b> <br>Urban  : 81 <br>Murder : 12.2 <br>Predicted Murder : 8.11 <br>Residual : 4.09","<b> New Hampshire <\/b> <br>Urban  : 56 <br>Murder : 2.1 <br>Predicted Murder : 7.59 <br>Residual : -5.49","<b> New Jersey <\/b> <br>Urban  : 89 <br>Murder : 7.4 <br>Predicted Murder : 8.28 <br>Residual : -0.88","<b> New Mexico <\/b> <br>Urban  : 70 <br>Murder : 11.4 <br>Predicted Murder : 7.88 <br>Residual : 3.52","<b> New York <\/b> <br>Urban  : 86 <br>Murder : 11.1 <br>Predicted Murder : 8.22 <br>Residual : 2.88","<b> North Carolina <\/b> <br>Urban  : 45 <br>Murder : 13 <br>Predicted Murder : 7.36 <br>Residual : 5.64","<b> North Dakota <\/b> <br>Urban  : 44 <br>Murder : 0.8 <br>Predicted Murder : 7.34 <br>Residual : -6.54","<b> Ohio <\/b> <br>Urban  : 75 <br>Murder : 7.3 <br>Predicted Murder : 7.99 <br>Residual : -0.69","<b> Oklahoma <\/b> <br>Urban  : 68 <br>Murder : 6.6 <br>Predicted Murder : 7.84 <br>Residual : -1.24","<b> Oregon <\/b> <br>Urban  : 67 <br>Murder : 4.9 <br>Predicted Murder : 7.82 <br>Residual : -2.92","<b> Pennsylvania <\/b> <br>Urban  : 72 <br>Murder : 6.3 <br>Predicted Murder : 7.92 <br>Residual : -1.62","<b> Rhode Island <\/b> <br>Urban  : 87 <br>Murder : 3.4 <br>Predicted Murder : 8.24 <br>Residual : -4.84","<b> South Carolina <\/b> <br>Urban  : 48 <br>Murder : 14.4 <br>Predicted Murder : 7.42 <br>Residual : 6.98","<b> South Dakota <\/b> <br>Urban  : 45 <br>Murder : 3.8 <br>Predicted Murder : 7.36 <br>Residual : -3.56","<b> Tennessee <\/b> <br>Urban  : 59 <br>Murder : 13.2 <br>Predicted Murder : 7.65 <br>Residual : 5.55","<b> Texas <\/b> <br>Urban  : 80 <br>Murder : 12.7 <br>Predicted Murder : 8.09 <br>Residual : 4.61","<b> Utah <\/b> <br>Urban  : 80 <br>Murder : 3.2 <br>Predicted Murder : 8.09 <br>Residual : -4.89","<b> Vermont <\/b> <br>Urban  : 32 <br>Murder : 2.2 <br>Predicted Murder : 7.09 <br>Residual : -4.89","<b> Virginia <\/b> <br>Urban  : 63 <br>Murder : 8.5 <br>Predicted Murder : 7.73 <br>Residual : 0.77","<b> Washington <\/b> <br>Urban  : 73 <br>Murder : 4 <br>Predicted Murder : 7.94 <br>Residual : -3.94","<b> West Virginia <\/b> <br>Urban  : 39 <br>Murder : 5.7 <br>Predicted Murder : 7.23 <br>Residual : -1.53","<b> Wisconsin <\/b> <br>Urban  : 66 <br>Murder : 2.6 <br>Predicted Murder : 7.8 <br>Residual : -5.2","<b> Wyoming <\/b> <br>Urban  : 60 <br>Murder : 6.8 <br>Predicted Murder : 7.67 <br>Residual : -0.87"],"type":"scatter","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[58,48,80,50,91,78,77,72,80,60,83,54,83,65,57,66,52,66,51,67,85,74,66,44,70,53,62,81,56,89,70,86,45,44,75,68,67,72,87,48,45,59,80,80,32,63,73,39,66,60],"y":[7.630152672499273,7.4208060843020238,8.0907151665332222,7.4626754019414738,8.3209964135501959,8.0488458488937713,8.0279111900740467,7.9232378959754222,8.0907151665332222,7.672021990138723,8.1535191429923959,7.546414037220373,8.1535191429923959,7.7766952842373476,7.6092180136795484,7.7976299430570721,7.5045447195809238,7.7976299430570721,7.4836100607611984,7.8185646018767976,8.1953884606318468,7.9651072136148722,7.7976299430570721,7.3370674490231238,7.8813685783359722,7.5254793784006484,7.713891307778173,8.1116498253529468,7.588283354859823,8.279127095910745,7.8813685783359722,8.2163231194515713,7.3580021078428492,7.3370674490231238,7.9860418724345967,7.8394992606965221,7.8185646018767976,7.9232378959754222,8.2372577782712959,7.4208060843020238,7.3580021078428492,7.6510873313189975,8.0907151665332222,8.0907151665332222,7.0858515431864246,7.7348259665978976,7.9441725547951467,7.2323941549244992,7.7976299430570721,7.672021990138723],"hoverinfo":["none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none"],"mode":"lines+markers","type":"scatter","line":{"color":"rgba(0,0,0,1)","width":0.5},"marker":{"color":"rgba(0,0,0,1)","symbol":134,"size":5,"line":{"color":"rgba(0,0,0,1)"}},"textfont":{"color":"rgba(0,0,0,1)"},"error_y":{"color":"rgba(0,0,0,1)"},"error_x":{"color":"rgba(0,0,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>To quantitatively analyze Goodness of Fit, we can intuitively compute the linear correlation between the predictions and the data
<span class="math display">\[
R = Cor( \hat{y}_i, y)
\]</span>
With linear models, we typically compute <span class="math inline">\(R^2\)</span>, known as the “coefficient of determination”, using the sums of squared errors (Total, Explained, and Residual)
<span class="math display">\[
\underbrace{\sum_{i}(y_i-\bar{y})^2}_\text{TSS}=\underbrace{\sum_{i}(\hat{y}_i-\bar{y})^2}_\text{ESS}+\underbrace{\sum_{i}\hat{\epsilon_{i}}^2}_\text{RSS}\\
R^2 = \frac{ESS}{TSS}=1-\frac{RSS}{TSS}
\]</span></p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="bivariate-data.html#cb387-1" tabindex="-1"></a><span class="co"># Manually Compute R2</span></span>
<span id="cb387-2"><a href="bivariate-data.html#cb387-2" tabindex="-1"></a>Ehat <span class="ot">&lt;-</span> <span class="fu">resid</span>(reg)</span>
<span id="cb387-3"><a href="bivariate-data.html#cb387-3" tabindex="-1"></a>RSS  <span class="ot">&lt;-</span> <span class="fu">sum</span>(Ehat<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb387-4"><a href="bivariate-data.html#cb387-4" tabindex="-1"></a>Y <span class="ot">&lt;-</span> xy<span class="sc">$</span>y</span>
<span id="cb387-5"><a href="bivariate-data.html#cb387-5" tabindex="-1"></a>TSS  <span class="ot">&lt;-</span> <span class="fu">sum</span>((Y<span class="sc">-</span><span class="fu">mean</span>(Y))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb387-6"><a href="bivariate-data.html#cb387-6" tabindex="-1"></a>R2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> RSS<span class="sc">/</span>TSS</span>
<span id="cb387-7"><a href="bivariate-data.html#cb387-7" tabindex="-1"></a>R2</span></code></pre></div>
<pre><code>## [1] 0.00484035</code></pre>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="bivariate-data.html#cb389-1" tabindex="-1"></a><span class="co"># Check R2</span></span>
<span id="cb389-2"><a href="bivariate-data.html#cb389-2" tabindex="-1"></a><span class="fu">summary</span>(reg)<span class="sc">$</span>r.squared</span></code></pre></div>
<pre><code>## [1] 0.00484035</code></pre>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="bivariate-data.html#cb391-1" tabindex="-1"></a><span class="co"># Double Check R2</span></span>
<span id="cb391-2"><a href="bivariate-data.html#cb391-2" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">cor</span>(xy<span class="sc">$</span>y, <span class="fu">predict</span>(reg))</span>
<span id="cb391-3"><a href="bivariate-data.html#cb391-3" tabindex="-1"></a>R<span class="sc">^</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 0.00484035</code></pre>
</div>
<div id="variability-estimates" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Variability Estimates<a href="bivariate-data.html#variability-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A regression coefficient is a statistic. And, just like all statistics, we can calculate</p>
<ul>
<li><em>standard deviation</em>: variability within a single sample.</li>
<li><em>standard error</em>: variability across different samples.</li>
<li><em>confidence interval:</em> range your statistic varies across different samples.</li>
</ul>
<p>Note that values reported by your computer do not necessarily satisfy this definition. To calculate these statistics, we will estimate variability using <em>data-driven</em> methods. (For some theoretical background, see, e.g., <a href="https://www.sagepub.com/sites/default/files/upm-binaries/21122_Chapter_21.pdf" class="uri">https://www.sagepub.com/sites/default/files/upm-binaries/21122_Chapter_21.pdf</a>.)</p>
<p>We first consider the simplest, the jackknife. In this procedure, we loop through each row of the dataset. And, in each iteration of the loop, we drop that observation from the dataset and reestimate the statistic of interest. We then calculate the standard deviation of the statistic across all ``subsamples’’.</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="bivariate-data.html#cb393-1" tabindex="-1"></a><span class="co"># Jackknife Standard Errors for OLS Coefficient</span></span>
<span id="cb393-2"><a href="bivariate-data.html#cb393-2" tabindex="-1"></a>jack_regs <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(xy), <span class="cf">function</span>(i){</span>
<span id="cb393-3"><a href="bivariate-data.html#cb393-3" tabindex="-1"></a>    xy_i <span class="ot">&lt;-</span> xy[<span class="sc">-</span>i,]</span>
<span id="cb393-4"><a href="bivariate-data.html#cb393-4" tabindex="-1"></a>    reg_i <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">dat=</span>xy_i)</span>
<span id="cb393-5"><a href="bivariate-data.html#cb393-5" tabindex="-1"></a>})</span>
<span id="cb393-6"><a href="bivariate-data.html#cb393-6" tabindex="-1"></a>jack_coefs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(jack_regs, coef)[<span class="st">&#39;x&#39;</span>,]</span>
<span id="cb393-7"><a href="bivariate-data.html#cb393-7" tabindex="-1"></a>jack_se <span class="ot">&lt;-</span> <span class="fu">sd</span>(jack_coefs)</span>
<span id="cb393-8"><a href="bivariate-data.html#cb393-8" tabindex="-1"></a><span class="co"># classic_se &lt;- sqrt(diag(vcov(reg)))[[&#39;x&#39;]]</span></span>
<span id="cb393-9"><a href="bivariate-data.html#cb393-9" tabindex="-1"></a></span>
<span id="cb393-10"><a href="bivariate-data.html#cb393-10" tabindex="-1"></a></span>
<span id="cb393-11"><a href="bivariate-data.html#cb393-11" tabindex="-1"></a><span class="co"># Jackknife Sampling Distribution</span></span>
<span id="cb393-12"><a href="bivariate-data.html#cb393-12" tabindex="-1"></a><span class="fu">hist</span>(jack_coefs, <span class="at">breaks=</span><span class="dv">25</span>,</span>
<span id="cb393-13"><a href="bivariate-data.html#cb393-13" tabindex="-1"></a>    <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&#39;SE est. = &#39;</span>, <span class="fu">round</span>(jack_se,<span class="dv">4</span>)),</span>
<span id="cb393-14"><a href="bivariate-data.html#cb393-14" tabindex="-1"></a>    <span class="at">font.main=</span><span class="dv">1</span>, <span class="at">border=</span><span class="cn">NA</span>,</span>
<span id="cb393-15"><a href="bivariate-data.html#cb393-15" tabindex="-1"></a>    <span class="at">xlab=</span><span class="fu">expression</span>(beta[<span class="sc">-</span>i]))</span>
<span id="cb393-16"><a href="bivariate-data.html#cb393-16" tabindex="-1"></a><span class="co"># Original Estimate</span></span>
<span id="cb393-17"><a href="bivariate-data.html#cb393-17" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">coef</span>(reg)[<span class="st">&#39;x&#39;</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb393-18"><a href="bivariate-data.html#cb393-18" tabindex="-1"></a><span class="co"># Jackknife Confidence Intervals</span></span>
<span id="cb393-19"><a href="bivariate-data.html#cb393-19" tabindex="-1"></a>jack_ci_percentile <span class="ot">&lt;-</span> <span class="fu">quantile</span>(jack_coefs, <span class="at">probs=</span><span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>))</span>
<span id="cb393-20"><a href="bivariate-data.html#cb393-20" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>jack_ci_percentile, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="bivariate-data.html#cb394-1" tabindex="-1"></a><span class="co"># Plot Normal Approximation</span></span>
<span id="cb394-2"><a href="bivariate-data.html#cb394-2" tabindex="-1"></a><span class="co"># jack_ci_normal &lt;- jack_mean+c(-1.96, +1.96)*jack_se</span></span>
<span id="cb394-3"><a href="bivariate-data.html#cb394-3" tabindex="-1"></a><span class="co"># abline(v=jack_ci_normal, col=&quot;red&quot;, lty=3)</span></span></code></pre></div>
<p>There are several resampling techniques. The other main one is the bootstrap, which resamples with <em>replacement</em> for an <em>arbitrary</em> number of iterations. When bootstrapping a dataset with <span class="math inline">\(n\)</span> observations, you randomly resample all <span class="math inline">\(n\)</span> rows in your data set <span class="math inline">\(B\)</span> times. Random subsampling is one of many hybrid approaches that tries to combine the best of both worlds.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Sample Size per Iteration</th>
<th>Number of Iterations</th>
<th>Resample</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Bootstrap</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(B\)</span></td>
<td>With Replacement</td>
</tr>
<tr class="even">
<td>Jackknife</td>
<td><span class="math inline">\(n-1\)</span></td>
<td><span class="math inline">\(n\)</span></td>
<td>Without Replacement</td>
</tr>
<tr class="odd">
<td>Random Subsample</td>
<td><span class="math inline">\(m &lt; n\)</span></td>
<td><span class="math inline">\(B\)</span></td>
<td>Without Replacement</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="bivariate-data.html#cb395-1" tabindex="-1"></a><span class="co"># Bootstrap</span></span>
<span id="cb395-2"><a href="bivariate-data.html#cb395-2" tabindex="-1"></a>boot_regs <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">399</span>, <span class="cf">function</span>(b){</span>
<span id="cb395-3"><a href="bivariate-data.html#cb395-3" tabindex="-1"></a>    b_id <span class="ot">&lt;-</span> <span class="fu">sample</span>( <span class="fu">nrow</span>(xy), <span class="at">replace=</span>T)</span>
<span id="cb395-4"><a href="bivariate-data.html#cb395-4" tabindex="-1"></a>    xy_b <span class="ot">&lt;-</span> xy[b_id,]</span>
<span id="cb395-5"><a href="bivariate-data.html#cb395-5" tabindex="-1"></a>    reg_b <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">dat=</span>xy_b)</span>
<span id="cb395-6"><a href="bivariate-data.html#cb395-6" tabindex="-1"></a>})</span>
<span id="cb395-7"><a href="bivariate-data.html#cb395-7" tabindex="-1"></a>boot_coefs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(boot_regs, coef)[<span class="st">&#39;x&#39;</span>,]</span>
<span id="cb395-8"><a href="bivariate-data.html#cb395-8" tabindex="-1"></a>boot_se <span class="ot">&lt;-</span> <span class="fu">sd</span>(boot_coefs)</span>
<span id="cb395-9"><a href="bivariate-data.html#cb395-9" tabindex="-1"></a></span>
<span id="cb395-10"><a href="bivariate-data.html#cb395-10" tabindex="-1"></a><span class="fu">hist</span>(boot_coefs, <span class="at">breaks=</span><span class="dv">25</span>,</span>
<span id="cb395-11"><a href="bivariate-data.html#cb395-11" tabindex="-1"></a>    <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&#39;SE est. = &#39;</span>, <span class="fu">round</span>(boot_se,<span class="dv">4</span>)),</span>
<span id="cb395-12"><a href="bivariate-data.html#cb395-12" tabindex="-1"></a>    <span class="at">font.main=</span><span class="dv">1</span>, <span class="at">border=</span><span class="cn">NA</span>,</span>
<span id="cb395-13"><a href="bivariate-data.html#cb395-13" tabindex="-1"></a>    <span class="at">xlab=</span><span class="fu">expression</span>(beta[b]))</span>
<span id="cb395-14"><a href="bivariate-data.html#cb395-14" tabindex="-1"></a>boot_ci_percentile <span class="ot">&lt;-</span> <span class="fu">quantile</span>(boot_coefs, <span class="at">probs=</span><span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>))</span>
<span id="cb395-15"><a href="bivariate-data.html#cb395-15" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>boot_ci_percentile, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb395-16"><a href="bivariate-data.html#cb395-16" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">coef</span>(reg)[<span class="st">&#39;x&#39;</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="bivariate-data.html#cb396-1" tabindex="-1"></a><span class="co"># Random Subsamples</span></span>
<span id="cb396-2"><a href="bivariate-data.html#cb396-2" tabindex="-1"></a>rs_regs <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">399</span>, <span class="cf">function</span>(b){</span>
<span id="cb396-3"><a href="bivariate-data.html#cb396-3" tabindex="-1"></a>    b_id <span class="ot">&lt;-</span> <span class="fu">sample</span>( <span class="fu">nrow</span>(xy), <span class="fu">nrow</span>(xy)<span class="sc">-</span><span class="dv">10</span>, <span class="at">replace=</span>F)</span>
<span id="cb396-4"><a href="bivariate-data.html#cb396-4" tabindex="-1"></a>    xy_b <span class="ot">&lt;-</span> xy[b_id,]</span>
<span id="cb396-5"><a href="bivariate-data.html#cb396-5" tabindex="-1"></a>    reg_b <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">dat=</span>xy_b)</span>
<span id="cb396-6"><a href="bivariate-data.html#cb396-6" tabindex="-1"></a>})</span>
<span id="cb396-7"><a href="bivariate-data.html#cb396-7" tabindex="-1"></a>rs_coefs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(rs_regs, coef)[<span class="st">&#39;x&#39;</span>,]</span>
<span id="cb396-8"><a href="bivariate-data.html#cb396-8" tabindex="-1"></a>rs_se <span class="ot">&lt;-</span> <span class="fu">sd</span>(rs_coefs)</span>
<span id="cb396-9"><a href="bivariate-data.html#cb396-9" tabindex="-1"></a></span>
<span id="cb396-10"><a href="bivariate-data.html#cb396-10" tabindex="-1"></a><span class="fu">hist</span>(rs_coefs, <span class="at">breaks=</span><span class="dv">25</span>,</span>
<span id="cb396-11"><a href="bivariate-data.html#cb396-11" tabindex="-1"></a>    <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&#39;SE est. = &#39;</span>, <span class="fu">round</span>(rs_se,<span class="dv">4</span>)),</span>
<span id="cb396-12"><a href="bivariate-data.html#cb396-12" tabindex="-1"></a>    <span class="at">font.main=</span><span class="dv">1</span>, <span class="at">border=</span><span class="cn">NA</span>,</span>
<span id="cb396-13"><a href="bivariate-data.html#cb396-13" tabindex="-1"></a>    <span class="at">xlab=</span><span class="fu">expression</span>(beta[b]))</span>
<span id="cb396-14"><a href="bivariate-data.html#cb396-14" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">coef</span>(reg)[<span class="st">&#39;x&#39;</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb396-15"><a href="bivariate-data.html#cb396-15" tabindex="-1"></a>rs_ci_percentile <span class="ot">&lt;-</span> <span class="fu">quantile</span>(rs_coefs, <span class="at">probs=</span><span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>))</span>
<span id="cb396-16"><a href="bivariate-data.html#cb396-16" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>rs_ci_percentile, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>We can also bootstrap other statistics, such as a t-statistic or <span class="math inline">\(R^2\)</span>. We do such things to test a null hypothesis, which is often ``no relationship’’. We are rarely interested in computing standard errors and conducting hypothesis tests for two variables. However, we work through the ideas in the two-variable case to better understand the multi-variable case.</p>
</div>
<div id="hypothesis-tests-1" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Hypothesis Tests<a href="bivariate-data.html#hypothesis-tests-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Invert a CI</strong>.
One main way to conduct hypothesis tests is to examine whether a confidence interval contains a hypothesized value. Does the slope coefficient equal <span class="math inline">\(0\)</span>? For reasons we won’t go into in this class, we typically normalize the coefficient by its standard error: <span class="math display">\[ \hat{t} = \frac{\hat{\beta}}{\hat{\sigma}_{\hat{\beta}}} \]</span></p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="bivariate-data.html#cb397-1" tabindex="-1"></a>tvalue <span class="ot">&lt;-</span> <span class="fu">coef</span>(reg)[<span class="st">&#39;x&#39;</span>]<span class="sc">/</span>jack_se</span>
<span id="cb397-2"><a href="bivariate-data.html#cb397-2" tabindex="-1"></a></span>
<span id="cb397-3"><a href="bivariate-data.html#cb397-3" tabindex="-1"></a>jack_t <span class="ot">&lt;-</span> <span class="fu">sapply</span>(jack_regs, <span class="cf">function</span>(reg_b){</span>
<span id="cb397-4"><a href="bivariate-data.html#cb397-4" tabindex="-1"></a>    <span class="co"># Data</span></span>
<span id="cb397-5"><a href="bivariate-data.html#cb397-5" tabindex="-1"></a>    xy_b <span class="ot">&lt;-</span> reg_b<span class="sc">$</span>model</span>
<span id="cb397-6"><a href="bivariate-data.html#cb397-6" tabindex="-1"></a>    <span class="co"># Coefficient</span></span>
<span id="cb397-7"><a href="bivariate-data.html#cb397-7" tabindex="-1"></a>    beta_b <span class="ot">&lt;-</span> <span class="fu">coef</span>(reg_b)[[<span class="st">&#39;x&#39;</span>]]</span>
<span id="cb397-8"><a href="bivariate-data.html#cb397-8" tabindex="-1"></a>    t_hat_b <span class="ot">&lt;-</span> beta_b<span class="sc">/</span>jack_se</span>
<span id="cb397-9"><a href="bivariate-data.html#cb397-9" tabindex="-1"></a>    <span class="fu">return</span>(t_hat_b)</span>
<span id="cb397-10"><a href="bivariate-data.html#cb397-10" tabindex="-1"></a>})</span>
<span id="cb397-11"><a href="bivariate-data.html#cb397-11" tabindex="-1"></a></span>
<span id="cb397-12"><a href="bivariate-data.html#cb397-12" tabindex="-1"></a><span class="fu">hist</span>(jack_t, <span class="at">breaks=</span><span class="dv">25</span>,</span>
<span id="cb397-13"><a href="bivariate-data.html#cb397-13" tabindex="-1"></a>    <span class="at">main=</span><span class="st">&#39;Jackknife t Density&#39;</span>,</span>
<span id="cb397-14"><a href="bivariate-data.html#cb397-14" tabindex="-1"></a>    <span class="at">font.main=</span><span class="dv">1</span>, <span class="at">border=</span><span class="cn">NA</span>,</span>
<span id="cb397-15"><a href="bivariate-data.html#cb397-15" tabindex="-1"></a>    <span class="at">xlab=</span><span class="fu">expression</span>(<span class="fu">hat</span>(t)[b]), </span>
<span id="cb397-16"><a href="bivariate-data.html#cb397-16" tabindex="-1"></a>    <span class="at">xlim=</span><span class="fu">range</span>(<span class="fu">c</span>(<span class="dv">0</span>, jack_t)) )</span>
<span id="cb397-17"><a href="bivariate-data.html#cb397-17" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">quantile</span>(jack_t, <span class="at">probs=</span><span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>)), <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb397-18"><a href="bivariate-data.html#cb397-18" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p><strong>Impose the Null</strong>.
We can also compute a null distribution. We focus on the simplest: bootstrap simulations that each impose the null hypothesis and re-estimate the statistic of interest. Specifically, we compute the distribution of t-values on data with randomly reshuffled outcomes (imposing the null), and compare how extreme the observed value is.</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="bivariate-data.html#cb398-1" tabindex="-1"></a><span class="co"># Null Distribution for Beta</span></span>
<span id="cb398-2"><a href="bivariate-data.html#cb398-2" tabindex="-1"></a>boot_t0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">399</span>, <span class="cf">function</span>(b){</span>
<span id="cb398-3"><a href="bivariate-data.html#cb398-3" tabindex="-1"></a>    xy_b <span class="ot">&lt;-</span> xy</span>
<span id="cb398-4"><a href="bivariate-data.html#cb398-4" tabindex="-1"></a>    xy_b<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">sample</span>( xy_b<span class="sc">$</span>y, <span class="at">replace=</span>T)</span>
<span id="cb398-5"><a href="bivariate-data.html#cb398-5" tabindex="-1"></a>    reg_b <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">dat=</span>xy_b)</span>
<span id="cb398-6"><a href="bivariate-data.html#cb398-6" tabindex="-1"></a>    beta_b <span class="ot">&lt;-</span> <span class="fu">coef</span>(reg_b)[[<span class="st">&#39;x&#39;</span>]]</span>
<span id="cb398-7"><a href="bivariate-data.html#cb398-7" tabindex="-1"></a>    t_hat_b <span class="ot">&lt;-</span> beta_b<span class="sc">/</span>jack_se</span>
<span id="cb398-8"><a href="bivariate-data.html#cb398-8" tabindex="-1"></a>    <span class="fu">return</span>(t_hat_b)</span>
<span id="cb398-9"><a href="bivariate-data.html#cb398-9" tabindex="-1"></a>})</span>
<span id="cb398-10"><a href="bivariate-data.html#cb398-10" tabindex="-1"></a></span>
<span id="cb398-11"><a href="bivariate-data.html#cb398-11" tabindex="-1"></a><span class="co"># Null Bootstrap Distribution</span></span>
<span id="cb398-12"><a href="bivariate-data.html#cb398-12" tabindex="-1"></a>boot_ci_percentile0 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(boot_t0, <span class="at">probs=</span><span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>))</span>
<span id="cb398-13"><a href="bivariate-data.html#cb398-13" tabindex="-1"></a><span class="fu">hist</span>(boot_t0, <span class="at">breaks=</span><span class="dv">25</span>,</span>
<span id="cb398-14"><a href="bivariate-data.html#cb398-14" tabindex="-1"></a>    <span class="at">main=</span><span class="st">&#39;Null Bootstrap Density&#39;</span>,</span>
<span id="cb398-15"><a href="bivariate-data.html#cb398-15" tabindex="-1"></a>    <span class="at">font.main=</span><span class="dv">1</span>, <span class="at">border=</span><span class="cn">NA</span>,</span>
<span id="cb398-16"><a href="bivariate-data.html#cb398-16" tabindex="-1"></a>    <span class="at">xlab=</span><span class="fu">expression</span>(<span class="fu">hat</span>(t)[b]),</span>
<span id="cb398-17"><a href="bivariate-data.html#cb398-17" tabindex="-1"></a>    <span class="at">xlim=</span><span class="fu">range</span>(boot_t0))</span>
<span id="cb398-18"><a href="bivariate-data.html#cb398-18" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>boot_ci_percentile0, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb398-19"><a href="bivariate-data.html#cb398-19" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>tvalue, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Alternatively, you can impose the null by recentering the sampling distribution around the theoretical value; <span class="math display">\[\hat{t} = \frac{\hat{\beta} - \beta_{0} }{\hat{\sigma}_{\hat{\beta}}}.\]</span> Under some assumptions, the null distribution follows a t-distribution. (For more on parametric t-testing based on statistical theory, see <a href="https://www.econometrics-with-r.org/4-lrwor.html" class="uri">https://www.econometrics-with-r.org/4-lrwor.html</a>.)</p>
<p>In any case, we can calculate a <em>p-value</em>: the probability you would see something as extreme as your statistic under the null (assuming your null hypothesis was true). We can always calculate a p-value from an explicit null distribution.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="bivariate-data.html#cb399-1" tabindex="-1"></a><span class="co"># One Sided Test for P(t &gt; boot_t | Null) = 1 - P(t &lt; boot_t | Null)</span></span>
<span id="cb399-2"><a href="bivariate-data.html#cb399-2" tabindex="-1"></a>That_NullDist1 <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(boot_t0)</span>
<span id="cb399-3"><a href="bivariate-data.html#cb399-3" tabindex="-1"></a>Phat1  <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">That_NullDist1</span>(jack_t)</span>
<span id="cb399-4"><a href="bivariate-data.html#cb399-4" tabindex="-1"></a></span>
<span id="cb399-5"><a href="bivariate-data.html#cb399-5" tabindex="-1"></a><span class="co"># Two Sided Test for P(t &gt; jack_t or t &lt; -jack_t | Null)</span></span>
<span id="cb399-6"><a href="bivariate-data.html#cb399-6" tabindex="-1"></a>That_NullDist2 <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(<span class="fu">abs</span>(boot_t0))</span>
<span id="cb399-7"><a href="bivariate-data.html#cb399-7" tabindex="-1"></a><span class="fu">plot</span>(That_NullDist2, <span class="at">xlim=</span><span class="fu">range</span>(boot_t0, jack_t),</span>
<span id="cb399-8"><a href="bivariate-data.html#cb399-8" tabindex="-1"></a>    <span class="at">xlab=</span><span class="fu">expression</span>( <span class="fu">abs</span>(<span class="fu">hat</span>(t)[b]) ),</span>
<span id="cb399-9"><a href="bivariate-data.html#cb399-9" tabindex="-1"></a>    <span class="at">main=</span><span class="st">&#39;Null Bootstrap Distribution&#39;</span>, <span class="at">font.main=</span><span class="dv">1</span>)</span>
<span id="cb399-10"><a href="bivariate-data.html#cb399-10" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>tvalue, <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="bivariate-data.html#cb400-1" tabindex="-1"></a>Phat2  <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">-</span><span class="fu">That_NullDist2</span>( <span class="fu">abs</span>(tvalue))</span>
<span id="cb400-2"><a href="bivariate-data.html#cb400-2" tabindex="-1"></a>Phat2</span></code></pre></div>
<pre><code>## [1] 0.5789474</code></pre>
</div>
<div id="prediction-intervals" class="section level2 hasAnchor" number="10.5">
<h2><span class="header-section-number">10.5</span> Prediction Intervals<a href="bivariate-data.html#prediction-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In addition to confidence intervals, we can also compute a <em>prediction interval</em> which estimates the range of variability across different samples for the outcomes. These intervals also take into account the residuals— the variability of individuals around the mean.</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="bivariate-data.html#cb402-1" tabindex="-1"></a><span class="co"># Bootstrap Prediction Interval</span></span>
<span id="cb402-2"><a href="bivariate-data.html#cb402-2" tabindex="-1"></a>boot_resids <span class="ot">&lt;-</span> <span class="fu">lapply</span>(boot_regs, <span class="cf">function</span>(reg_b){</span>
<span id="cb402-3"><a href="bivariate-data.html#cb402-3" tabindex="-1"></a>    e_b <span class="ot">&lt;-</span> <span class="fu">resid</span>(reg_b)</span>
<span id="cb402-4"><a href="bivariate-data.html#cb402-4" tabindex="-1"></a>    x_b <span class="ot">&lt;-</span> reg_b<span class="sc">$</span>model<span class="sc">$</span>x</span>
<span id="cb402-5"><a href="bivariate-data.html#cb402-5" tabindex="-1"></a>    res_b <span class="ot">&lt;-</span> <span class="fu">cbind</span>(e_b, x_b)</span>
<span id="cb402-6"><a href="bivariate-data.html#cb402-6" tabindex="-1"></a>})</span>
<span id="cb402-7"><a href="bivariate-data.html#cb402-7" tabindex="-1"></a>boot_resids <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind, boot_resids))</span>
<span id="cb402-8"><a href="bivariate-data.html#cb402-8" tabindex="-1"></a><span class="co"># Homoskedastic</span></span>
<span id="cb402-9"><a href="bivariate-data.html#cb402-9" tabindex="-1"></a>ehat <span class="ot">&lt;-</span> <span class="fu">quantile</span>(boot_resids<span class="sc">$</span>e_b, <span class="at">probs=</span><span class="fu">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>))</span>
<span id="cb402-10"><a href="bivariate-data.html#cb402-10" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">quantile</span>(xy<span class="sc">$</span>x,<span class="at">probs=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span>.<span class="dv">1</span>))</span>
<span id="cb402-11"><a href="bivariate-data.html#cb402-11" tabindex="-1"></a>boot_pi <span class="ot">&lt;-</span> <span class="fu">coef</span>(reg)[<span class="dv">1</span>] <span class="sc">+</span> x<span class="sc">*</span><span class="fu">coef</span>(reg)[<span class="st">&#39;x&#39;</span>]</span>
<span id="cb402-12"><a href="bivariate-data.html#cb402-12" tabindex="-1"></a>boot_pi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(boot_pi <span class="sc">+</span> ehat[<span class="dv">1</span>], boot_pi <span class="sc">+</span> ehat[<span class="dv">2</span>])</span>
<span id="cb402-13"><a href="bivariate-data.html#cb402-13" tabindex="-1"></a></span>
<span id="cb402-14"><a href="bivariate-data.html#cb402-14" tabindex="-1"></a><span class="co"># Plot Bootstrap PI</span></span>
<span id="cb402-15"><a href="bivariate-data.html#cb402-15" tabindex="-1"></a><span class="fu">plot</span>(y<span class="sc">~</span>x, <span class="at">dat=</span>xy, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">main=</span><span class="st">&#39;Prediction Intervals&#39;</span>,</span>
<span id="cb402-16"><a href="bivariate-data.html#cb402-16" tabindex="-1"></a>    <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">20</span>), <span class="at">font.main=</span><span class="dv">1</span>)</span>
<span id="cb402-17"><a href="bivariate-data.html#cb402-17" tabindex="-1"></a><span class="fu">polygon</span>( <span class="fu">c</span>(x, <span class="fu">rev</span>(x)), <span class="fu">c</span>(boot_pi[,<span class="dv">1</span>], <span class="fu">rev</span>(boot_pi[,<span class="dv">2</span>])),</span>
<span id="cb402-18"><a href="bivariate-data.html#cb402-18" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">2</span>), <span class="at">border=</span><span class="cn">NA</span>)</span>
<span id="cb402-19"><a href="bivariate-data.html#cb402-19" tabindex="-1"></a></span>
<span id="cb402-20"><a href="bivariate-data.html#cb402-20" tabindex="-1"></a><span class="co"># Parametric PI (For Comparison)</span></span>
<span id="cb402-21"><a href="bivariate-data.html#cb402-21" tabindex="-1"></a>pi <span class="ot">&lt;-</span> <span class="fu">predict</span>(reg, <span class="at">interval=</span><span class="st">&#39;prediction&#39;</span>, <span class="at">newdata=</span><span class="fu">data.frame</span>(x))</span>
<span id="cb402-22"><a href="bivariate-data.html#cb402-22" tabindex="-1"></a><span class="fu">lines</span>( x, pi[,<span class="st">&#39;lwr&#39;</span>], <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb402-23"><a href="bivariate-data.html#cb402-23" tabindex="-1"></a><span class="fu">lines</span>( x, pi[,<span class="st">&#39;upr&#39;</span>], <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>For a nice overview of different types of intervals, see <a href="https://www.jstor.org/stable/2685212" class="uri">https://www.jstor.org/stable/2685212</a>. For an in-depth view, see “Statistical Intervals: A Guide for Practitioners and Researchers” or “Statistical Tolerance Regions: Theory, Applications, and Computation”. See <a href="https://robjhyndman.com/hyndsight/intervals/" class="uri">https://robjhyndman.com/hyndsight/intervals/</a> for constructing intervals for future observations in a time-series context. See Davison and Hinkley, chapters 5 and 6 (also Efron and Tibshirani, or Wehrens et al.)</p>
</div>
<div id="locally-linear" class="section level2 hasAnchor" number="10.6">
<h2><span class="header-section-number">10.6</span> Locally Linear<a href="bivariate-data.html#locally-linear" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It is generally safe to assume that you could be analyzing data with nonlinear relationships. Here, our model can be represented as
<span class="math display">\[\begin{eqnarray}
y_{i} = m(x_{i}) + e_{i},
\end{eqnarray}\]</span>
with <span class="math inline">\(m\)</span> being some unknown but smooth function. In such cases, linear regressions can still be useful.</p>
<p>The simplest case is <strong>segmented/piecewise regression</strong></p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="bivariate-data.html#cb403-1" tabindex="-1"></a><span class="co"># Globally Linear</span></span>
<span id="cb403-2"><a href="bivariate-data.html#cb403-2" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>xy)</span>
<span id="cb403-3"><a href="bivariate-data.html#cb403-3" tabindex="-1"></a></span>
<span id="cb403-4"><a href="bivariate-data.html#cb403-4" tabindex="-1"></a><span class="co"># Diagnose Fit</span></span>
<span id="cb403-5"><a href="bivariate-data.html#cb403-5" tabindex="-1"></a><span class="co">#plot( fitted(reg), resid(reg), pch=16, col=grey(0,.5))</span></span>
<span id="cb403-6"><a href="bivariate-data.html#cb403-6" tabindex="-1"></a><span class="co">#plot( xy$x, resid(reg), pch=16, col=grey(0,.5))</span></span>
<span id="cb403-7"><a href="bivariate-data.html#cb403-7" tabindex="-1"></a></span>
<span id="cb403-8"><a href="bivariate-data.html#cb403-8" tabindex="-1"></a><span class="co"># Linear in 2 Pieces (subsets)</span></span>
<span id="cb403-9"><a href="bivariate-data.html#cb403-9" tabindex="-1"></a>xcut2 <span class="ot">&lt;-</span> <span class="fu">cut</span>(xy<span class="sc">$</span>x,<span class="dv">2</span>)</span>
<span id="cb403-10"><a href="bivariate-data.html#cb403-10" tabindex="-1"></a>xy_list2 <span class="ot">&lt;-</span> <span class="fu">split</span>(xy, xcut2)</span>
<span id="cb403-11"><a href="bivariate-data.html#cb403-11" tabindex="-1"></a>regs2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(xy_list2, <span class="cf">function</span>(xy_s){</span>
<span id="cb403-12"><a href="bivariate-data.html#cb403-12" tabindex="-1"></a>    <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>xy_s)</span>
<span id="cb403-13"><a href="bivariate-data.html#cb403-13" tabindex="-1"></a>})</span>
<span id="cb403-14"><a href="bivariate-data.html#cb403-14" tabindex="-1"></a><span class="fu">sapply</span>(regs2, coef)</span></code></pre></div>
<pre><code>##             (31.9,61.5] (61.5,91.1]
## (Intercept)  -0.2836303  4.15337509
## x             0.1628157  0.04760783</code></pre>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="bivariate-data.html#cb405-1" tabindex="-1"></a><span class="co"># Linear in 3 Pieces (subsets or bins)</span></span>
<span id="cb405-2"><a href="bivariate-data.html#cb405-2" tabindex="-1"></a>xcut3 <span class="ot">&lt;-</span> <span class="fu">cut</span>(xy<span class="sc">$</span>x, <span class="fu">seq</span>(<span class="dv">32</span>,<span class="dv">92</span>,<span class="at">by=</span><span class="dv">20</span>)) <span class="co"># Finer Bins</span></span>
<span id="cb405-3"><a href="bivariate-data.html#cb405-3" tabindex="-1"></a>xy_list3 <span class="ot">&lt;-</span> <span class="fu">split</span>(xy, xcut3)</span>
<span id="cb405-4"><a href="bivariate-data.html#cb405-4" tabindex="-1"></a>regs3 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(xy_list3, <span class="cf">function</span>(xy_s){</span>
<span id="cb405-5"><a href="bivariate-data.html#cb405-5" tabindex="-1"></a>    <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>xy_s)</span>
<span id="cb405-6"><a href="bivariate-data.html#cb405-6" tabindex="-1"></a>})</span>
<span id="cb405-7"><a href="bivariate-data.html#cb405-7" tabindex="-1"></a><span class="fu">sapply</span>(regs3, coef)</span></code></pre></div>
<pre><code>##                (32,52]    (52,72]      (72,92]
## (Intercept) 4.60313390 2.36291848  8.653829140
## x           0.08233618 0.08132841 -0.007174454</code></pre>
<p>Compare Predictions</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="bivariate-data.html#cb407-1" tabindex="-1"></a>pred1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">yhat=</span><span class="fu">predict</span>(reg), <span class="at">x=</span>reg<span class="sc">$</span>model<span class="sc">$</span>x)</span>
<span id="cb407-2"><a href="bivariate-data.html#cb407-2" tabindex="-1"></a>pred1 <span class="ot">&lt;-</span> pred1[<span class="fu">order</span>(pred1<span class="sc">$</span>x),]</span>
<span id="cb407-3"><a href="bivariate-data.html#cb407-3" tabindex="-1"></a></span>
<span id="cb407-4"><a href="bivariate-data.html#cb407-4" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(regs2, <span class="cf">function</span>(reg){</span>
<span id="cb407-5"><a href="bivariate-data.html#cb407-5" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">yhat=</span><span class="fu">predict</span>(reg), <span class="at">x=</span>reg<span class="sc">$</span>model<span class="sc">$</span>x)</span>
<span id="cb407-6"><a href="bivariate-data.html#cb407-6" tabindex="-1"></a>})</span>
<span id="cb407-7"><a href="bivariate-data.html#cb407-7" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind,pred2)</span>
<span id="cb407-8"><a href="bivariate-data.html#cb407-8" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> pred2[<span class="fu">order</span>(pred2<span class="sc">$</span>x),]</span>
<span id="cb407-9"><a href="bivariate-data.html#cb407-9" tabindex="-1"></a></span>
<span id="cb407-10"><a href="bivariate-data.html#cb407-10" tabindex="-1"></a>pred3 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(regs3, <span class="cf">function</span>(reg){</span>
<span id="cb407-11"><a href="bivariate-data.html#cb407-11" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">yhat=</span><span class="fu">predict</span>(reg), <span class="at">x=</span>reg<span class="sc">$</span>model<span class="sc">$</span>x)</span>
<span id="cb407-12"><a href="bivariate-data.html#cb407-12" tabindex="-1"></a>})</span>
<span id="cb407-13"><a href="bivariate-data.html#cb407-13" tabindex="-1"></a>pred3 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind,pred3)</span>
<span id="cb407-14"><a href="bivariate-data.html#cb407-14" tabindex="-1"></a>pred3 <span class="ot">&lt;-</span> pred3[<span class="fu">order</span>(pred3<span class="sc">$</span>x),]</span>
<span id="cb407-15"><a href="bivariate-data.html#cb407-15" tabindex="-1"></a></span>
<span id="cb407-16"><a href="bivariate-data.html#cb407-16" tabindex="-1"></a><span class="co"># Compare Predictions</span></span>
<span id="cb407-17"><a href="bivariate-data.html#cb407-17" tabindex="-1"></a><span class="fu">plot</span>(y <span class="sc">~</span> x, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">dat=</span>xy)</span>
<span id="cb407-18"><a href="bivariate-data.html#cb407-18" tabindex="-1"></a><span class="fu">lines</span>(yhat<span class="sc">~</span>x, pred1, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="dv">2</span>)</span>
<span id="cb407-19"><a href="bivariate-data.html#cb407-19" tabindex="-1"></a><span class="fu">lines</span>(yhat<span class="sc">~</span>x, pred2, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="dv">4</span>)</span>
<span id="cb407-20"><a href="bivariate-data.html#cb407-20" tabindex="-1"></a><span class="fu">lines</span>(yhat<span class="sc">~</span>x, pred3, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="dv">3</span>)</span>
<span id="cb407-21"><a href="bivariate-data.html#cb407-21" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topleft&#39;</span>,</span>
<span id="cb407-22"><a href="bivariate-data.html#cb407-22" tabindex="-1"></a>    <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&#39;Globally Linear&#39;</span>, <span class="st">&#39;Peicewise Linear (2)&#39;</span>,<span class="st">&#39;Peicewise Linear (3)&#39;</span>),</span>
<span id="cb407-23"><a href="bivariate-data.html#cb407-23" tabindex="-1"></a>    <span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">3</span>), <span class="at">cex=</span>.<span class="dv">8</span>)</span></code></pre></div>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>A less simple case is a <strong>local linear regression</strong> which conducts a linear regression for each data point using a subsample of data around it.</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="bivariate-data.html#cb408-1" tabindex="-1"></a><span class="co"># ``Naive&quot; Smoother</span></span>
<span id="cb408-2"><a href="bivariate-data.html#cb408-2" tabindex="-1"></a>pred_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x0, h, xy){</span>
<span id="cb408-3"><a href="bivariate-data.html#cb408-3" tabindex="-1"></a>    <span class="co"># Assign equal weight to observations within h distance to x0</span></span>
<span id="cb408-4"><a href="bivariate-data.html#cb408-4" tabindex="-1"></a>    <span class="co"># 0 weight for all other observations</span></span>
<span id="cb408-5"><a href="bivariate-data.html#cb408-5" tabindex="-1"></a>    ki   <span class="ot">&lt;-</span> <span class="fu">dunif</span>(xy<span class="sc">$</span>x, x0<span class="sc">-</span>h, x0<span class="sc">+</span>h) </span>
<span id="cb408-6"><a href="bivariate-data.html#cb408-6" tabindex="-1"></a>    llls <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>xy, <span class="at">weights=</span>ki)</span>
<span id="cb408-7"><a href="bivariate-data.html#cb408-7" tabindex="-1"></a>    yhat_i <span class="ot">&lt;-</span> <span class="fu">predict</span>(llls, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>x0))</span>
<span id="cb408-8"><a href="bivariate-data.html#cb408-8" tabindex="-1"></a>}</span>
<span id="cb408-9"><a href="bivariate-data.html#cb408-9" tabindex="-1"></a></span>
<span id="cb408-10"><a href="bivariate-data.html#cb408-10" tabindex="-1"></a>X0 <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(xy<span class="sc">$</span>x))</span>
<span id="cb408-11"><a href="bivariate-data.html#cb408-11" tabindex="-1"></a>pred_lo1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(X0, pred_fun, <span class="at">h=</span><span class="dv">2</span>, <span class="at">xy=</span>xy)</span>
<span id="cb408-12"><a href="bivariate-data.html#cb408-12" tabindex="-1"></a>pred_lo2 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(X0, pred_fun, <span class="at">h=</span><span class="dv">20</span>, <span class="at">xy=</span>xy)</span>
<span id="cb408-13"><a href="bivariate-data.html#cb408-13" tabindex="-1"></a></span>
<span id="cb408-14"><a href="bivariate-data.html#cb408-14" tabindex="-1"></a><span class="fu">plot</span>(y<span class="sc">~</span>x, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">data=</span>xy, <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">5</span>),</span>
<span id="cb408-15"><a href="bivariate-data.html#cb408-15" tabindex="-1"></a>    <span class="at">ylab=</span><span class="st">&#39;Murder Rate&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;Population Density&#39;</span>)</span>
<span id="cb408-16"><a href="bivariate-data.html#cb408-16" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rgb</span>(.<span class="dv">8</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">8</span>,.<span class="dv">5</span>))</span>
<span id="cb408-17"><a href="bivariate-data.html#cb408-17" tabindex="-1"></a><span class="fu">lines</span>(X0, pred_lo1, <span class="at">col=</span>cols[<span class="dv">1</span>], <span class="at">lwd=</span><span class="dv">1</span>, <span class="at">type=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb408-18"><a href="bivariate-data.html#cb408-18" tabindex="-1"></a><span class="fu">lines</span>(X0, pred_lo2, <span class="at">col=</span>cols[<span class="dv">2</span>], <span class="at">lwd=</span><span class="dv">1</span>, <span class="at">type=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb408-19"><a href="bivariate-data.html#cb408-19" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topleft&#39;</span>, <span class="at">title=</span><span class="st">&#39;Locally Linear&#39;</span>,</span>
<span id="cb408-20"><a href="bivariate-data.html#cb408-20" tabindex="-1"></a>    <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&#39;h=2 &#39;</span>, <span class="st">&#39;h=20&#39;</span>),</span>
<span id="cb408-21"><a href="bivariate-data.html#cb408-21" tabindex="-1"></a>    <span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span>cols, <span class="at">cex=</span>.<span class="dv">8</span>)</span></code></pre></div>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-18-1.png" width="672" />
Note that there are more complex versions of local linear regressions (see <a href="https://shinyserv.es/shiny/kreg/" class="uri">https://shinyserv.es/shiny/kreg/</a> for a nice illustration.) An even more complex (and more powerful) version is <strong>loess</strong>, which uses adaptive bandwidths in order to have a similar number of data points in each subsample (especially useful when <span class="math inline">\(X\)</span> is not uniform.)</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="bivariate-data.html#cb409-1" tabindex="-1"></a><span class="co"># Adaptive-width subsamples with non-uniform weights</span></span>
<span id="cb409-2"><a href="bivariate-data.html#cb409-2" tabindex="-1"></a>xy0 <span class="ot">&lt;-</span> xy[<span class="fu">order</span>(xy<span class="sc">$</span>x),]</span>
<span id="cb409-3"><a href="bivariate-data.html#cb409-3" tabindex="-1"></a><span class="fu">plot</span>(y<span class="sc">~</span>x, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">dat=</span>xy0)</span>
<span id="cb409-4"><a href="bivariate-data.html#cb409-4" tabindex="-1"></a></span>
<span id="cb409-5"><a href="bivariate-data.html#cb409-5" tabindex="-1"></a>reg_lo4 <span class="ot">&lt;-</span> <span class="fu">loess</span>(y<span class="sc">~</span>x, <span class="at">data=</span>xy0, <span class="at">span=</span>.<span class="dv">4</span>)</span>
<span id="cb409-6"><a href="bivariate-data.html#cb409-6" tabindex="-1"></a>reg_lo8 <span class="ot">&lt;-</span> <span class="fu">loess</span>(y<span class="sc">~</span>x, <span class="at">data=</span>xy0, <span class="at">span=</span>.<span class="dv">8</span>)</span>
<span id="cb409-7"><a href="bivariate-data.html#cb409-7" tabindex="-1"></a></span>
<span id="cb409-8"><a href="bivariate-data.html#cb409-8" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">hcl.colors</span>(<span class="dv">3</span>,<span class="at">alpha=</span>.<span class="dv">75</span>)[<span class="sc">-</span><span class="dv">3</span>]</span>
<span id="cb409-9"><a href="bivariate-data.html#cb409-9" tabindex="-1"></a><span class="fu">lines</span>(xy0<span class="sc">$</span>x, <span class="fu">predict</span>(reg_lo4),</span>
<span id="cb409-10"><a href="bivariate-data.html#cb409-10" tabindex="-1"></a>    <span class="at">col=</span>cols[<span class="dv">1</span>], <span class="at">type=</span><span class="st">&#39;o&#39;</span>, <span class="at">pch=</span><span class="dv">2</span>)</span>
<span id="cb409-11"><a href="bivariate-data.html#cb409-11" tabindex="-1"></a><span class="fu">lines</span>(xy0<span class="sc">$</span>x, <span class="fu">predict</span>(reg_lo8),</span>
<span id="cb409-12"><a href="bivariate-data.html#cb409-12" tabindex="-1"></a>    <span class="at">col=</span>cols[<span class="dv">2</span>], <span class="at">type=</span><span class="st">&#39;o&#39;</span>, <span class="at">pch=</span><span class="dv">2</span>)</span>
<span id="cb409-13"><a href="bivariate-data.html#cb409-13" tabindex="-1"></a></span>
<span id="cb409-14"><a href="bivariate-data.html#cb409-14" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topleft&#39;</span>, <span class="at">title=</span><span class="st">&#39;Loess&#39;</span>,</span>
<span id="cb409-15"><a href="bivariate-data.html#cb409-15" tabindex="-1"></a>    <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&#39;span=.4 &#39;</span>, <span class="st">&#39;span=.8&#39;</span>),</span>
<span id="cb409-16"><a href="bivariate-data.html#cb409-16" tabindex="-1"></a>    <span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span>cols, <span class="at">cex=</span>.<span class="dv">8</span>)</span></code></pre></div>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>The smoothed predicted values estimate the local means. So we can also construct confidence bands</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="bivariate-data.html#cb410-1" tabindex="-1"></a><span class="co"># Loess</span></span>
<span id="cb410-2"><a href="bivariate-data.html#cb410-2" tabindex="-1"></a>xy0 <span class="ot">&lt;-</span> xy[<span class="fu">order</span>(xy<span class="sc">$</span>x),]</span>
<span id="cb410-3"><a href="bivariate-data.html#cb410-3" tabindex="-1"></a>X0 <span class="ot">&lt;-</span> <span class="fu">unique</span>(xy0<span class="sc">$</span>x)</span>
<span id="cb410-4"><a href="bivariate-data.html#cb410-4" tabindex="-1"></a>reg_lo <span class="ot">&lt;-</span> <span class="fu">loess</span>(y<span class="sc">~</span>x, <span class="at">data=</span>xy0, <span class="at">span=</span>.<span class="dv">8</span>)</span>
<span id="cb410-5"><a href="bivariate-data.html#cb410-5" tabindex="-1"></a></span>
<span id="cb410-6"><a href="bivariate-data.html#cb410-6" tabindex="-1"></a><span class="co"># Jackknife CI</span></span>
<span id="cb410-7"><a href="bivariate-data.html#cb410-7" tabindex="-1"></a>jack_lo <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(xy), <span class="cf">function</span>(i){</span>
<span id="cb410-8"><a href="bivariate-data.html#cb410-8" tabindex="-1"></a>    xy_i <span class="ot">&lt;-</span> xy[<span class="sc">-</span>i,]</span>
<span id="cb410-9"><a href="bivariate-data.html#cb410-9" tabindex="-1"></a>    reg_i <span class="ot">&lt;-</span> <span class="fu">loess</span>(y<span class="sc">~</span>x, <span class="at">dat=</span>xy_i, <span class="at">span=</span>.<span class="dv">8</span>)</span>
<span id="cb410-10"><a href="bivariate-data.html#cb410-10" tabindex="-1"></a>    <span class="fu">predict</span>(reg_i, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>X0))</span>
<span id="cb410-11"><a href="bivariate-data.html#cb410-11" tabindex="-1"></a>})</span>
<span id="cb410-12"><a href="bivariate-data.html#cb410-12" tabindex="-1"></a>jack_cb <span class="ot">&lt;-</span> <span class="fu">apply</span>(jack_lo,<span class="dv">1</span>, quantile,</span>
<span id="cb410-13"><a href="bivariate-data.html#cb410-13" tabindex="-1"></a>    <span class="at">probs=</span><span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb410-14"><a href="bivariate-data.html#cb410-14" tabindex="-1"></a></span>
<span id="cb410-15"><a href="bivariate-data.html#cb410-15" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb410-16"><a href="bivariate-data.html#cb410-16" tabindex="-1"></a><span class="fu">plot</span>(y<span class="sc">~</span>x, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">dat=</span>xy0)</span>
<span id="cb410-17"><a href="bivariate-data.html#cb410-17" tabindex="-1"></a>preds_lo <span class="ot">&lt;-</span> <span class="fu">predict</span>(reg_lo, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>X0))</span>
<span id="cb410-18"><a href="bivariate-data.html#cb410-18" tabindex="-1"></a><span class="fu">lines</span>(X0, preds_lo,</span>
<span id="cb410-19"><a href="bivariate-data.html#cb410-19" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">hcl.colors</span>(<span class="dv">3</span>,<span class="at">alpha=</span>.<span class="dv">75</span>)[<span class="dv">2</span>],</span>
<span id="cb410-20"><a href="bivariate-data.html#cb410-20" tabindex="-1"></a>    <span class="at">type=</span><span class="st">&#39;o&#39;</span>, <span class="at">pch=</span><span class="dv">2</span>)</span>
<span id="cb410-21"><a href="bivariate-data.html#cb410-21" tabindex="-1"></a><span class="co"># Plot CI</span></span>
<span id="cb410-22"><a href="bivariate-data.html#cb410-22" tabindex="-1"></a><span class="fu">polygon</span>(</span>
<span id="cb410-23"><a href="bivariate-data.html#cb410-23" tabindex="-1"></a>    <span class="fu">c</span>(X0, <span class="fu">rev</span>(X0)),</span>
<span id="cb410-24"><a href="bivariate-data.html#cb410-24" tabindex="-1"></a>    <span class="fu">c</span>(jack_cb[<span class="dv">1</span>,], <span class="fu">rev</span>(jack_cb[<span class="dv">2</span>,])),</span>
<span id="cb410-25"><a href="bivariate-data.html#cb410-25" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">hcl.colors</span>(<span class="dv">3</span>,<span class="at">alpha=</span>.<span class="dv">25</span>)[<span class="dv">2</span>],</span>
<span id="cb410-26"><a href="bivariate-data.html#cb410-26" tabindex="-1"></a>    <span class="at">border=</span><span class="cn">NA</span>)</span></code></pre></div>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>You can also construct prediction bands, which estimate the variability of new data rather than a statistic (a range for <span class="math inline">\(y_{i}(x)\)</span> rather than for <span class="math inline">\(m(x)\)</span>).</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="bivariate-data.html#cb411-1" tabindex="-1"></a><span class="fu">plot</span>(y<span class="sc">~</span>x, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">grey</span>(<span class="dv">0</span>,.<span class="dv">5</span>),</span>
<span id="cb411-2"><a href="bivariate-data.html#cb411-2" tabindex="-1"></a>    <span class="at">dat=</span>xy0, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>))</span>
<span id="cb411-3"><a href="bivariate-data.html#cb411-3" tabindex="-1"></a><span class="fu">lines</span>(X0, preds_lo,</span>
<span id="cb411-4"><a href="bivariate-data.html#cb411-4" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">hcl.colors</span>(<span class="dv">3</span>,<span class="at">alpha=</span>.<span class="dv">75</span>)[<span class="dv">2</span>],</span>
<span id="cb411-5"><a href="bivariate-data.html#cb411-5" tabindex="-1"></a>    <span class="at">type=</span><span class="st">&#39;o&#39;</span>, <span class="at">pch=</span><span class="dv">2</span>)</span>
<span id="cb411-6"><a href="bivariate-data.html#cb411-6" tabindex="-1"></a></span>
<span id="cb411-7"><a href="bivariate-data.html#cb411-7" tabindex="-1"></a><span class="co"># Estimate Residuals CI at design points</span></span>
<span id="cb411-8"><a href="bivariate-data.html#cb411-8" tabindex="-1"></a>res_lo <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(xy), <span class="cf">function</span>(i){</span>
<span id="cb411-9"><a href="bivariate-data.html#cb411-9" tabindex="-1"></a>    y_i <span class="ot">&lt;-</span> xy[i,<span class="st">&#39;y&#39;</span>]</span>
<span id="cb411-10"><a href="bivariate-data.html#cb411-10" tabindex="-1"></a>    preds_i <span class="ot">&lt;-</span> jack_lo[,i]</span>
<span id="cb411-11"><a href="bivariate-data.html#cb411-11" tabindex="-1"></a>    resids_i <span class="ot">&lt;-</span> y_i <span class="sc">-</span> preds_i</span>
<span id="cb411-12"><a href="bivariate-data.html#cb411-12" tabindex="-1"></a>})</span>
<span id="cb411-13"><a href="bivariate-data.html#cb411-13" tabindex="-1"></a>res_cb <span class="ot">&lt;-</span> <span class="fu">apply</span>(res_lo, <span class="dv">1</span>, quantile,</span>
<span id="cb411-14"><a href="bivariate-data.html#cb411-14" tabindex="-1"></a>    <span class="at">probs=</span><span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb411-15"><a href="bivariate-data.html#cb411-15" tabindex="-1"></a></span>
<span id="cb411-16"><a href="bivariate-data.html#cb411-16" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb411-17"><a href="bivariate-data.html#cb411-17" tabindex="-1"></a><span class="fu">lines</span>( X0, preds_lo <span class="sc">+</span>res_cb[<span class="dv">1</span>,],</span>
<span id="cb411-18"><a href="bivariate-data.html#cb411-18" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">hcl.colors</span>(<span class="dv">3</span>,<span class="at">alpha=</span>.<span class="dv">75</span>)[<span class="dv">2</span>], <span class="at">lt=</span><span class="dv">2</span>)</span>
<span id="cb411-19"><a href="bivariate-data.html#cb411-19" tabindex="-1"></a><span class="fu">lines</span>( X0, preds_lo <span class="sc">+</span>res_cb[<span class="dv">2</span>,],</span>
<span id="cb411-20"><a href="bivariate-data.html#cb411-20" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">hcl.colors</span>(<span class="dv">3</span>,<span class="at">alpha=</span>.<span class="dv">75</span>)[<span class="dv">2</span>], <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb411-21"><a href="bivariate-data.html#cb411-21" tabindex="-1"></a></span>
<span id="cb411-22"><a href="bivariate-data.html#cb411-22" tabindex="-1"></a></span>
<span id="cb411-23"><a href="bivariate-data.html#cb411-23" tabindex="-1"></a></span>
<span id="cb411-24"><a href="bivariate-data.html#cb411-24" tabindex="-1"></a><span class="co"># Smooth estimates </span></span>
<span id="cb411-25"><a href="bivariate-data.html#cb411-25" tabindex="-1"></a>res_lo <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(xy), <span class="cf">function</span>(i){</span>
<span id="cb411-26"><a href="bivariate-data.html#cb411-26" tabindex="-1"></a>    y_i <span class="ot">&lt;-</span> xy[i,<span class="st">&#39;y&#39;</span>]</span>
<span id="cb411-27"><a href="bivariate-data.html#cb411-27" tabindex="-1"></a>    x_i <span class="ot">&lt;-</span> xy[i,<span class="st">&#39;x&#39;</span>]</span>
<span id="cb411-28"><a href="bivariate-data.html#cb411-28" tabindex="-1"></a>    preds_i <span class="ot">&lt;-</span> jack_lo[,i]</span>
<span id="cb411-29"><a href="bivariate-data.html#cb411-29" tabindex="-1"></a>    resids_i <span class="ot">&lt;-</span> y_i <span class="sc">-</span> preds_i</span>
<span id="cb411-30"><a href="bivariate-data.html#cb411-30" tabindex="-1"></a>    <span class="fu">cbind</span>(<span class="at">e=</span>resids_i, <span class="at">x=</span>x_i)</span>
<span id="cb411-31"><a href="bivariate-data.html#cb411-31" tabindex="-1"></a>})</span>
<span id="cb411-32"><a href="bivariate-data.html#cb411-32" tabindex="-1"></a>res_lo <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind, res_lo))</span>
<span id="cb411-33"><a href="bivariate-data.html#cb411-33" tabindex="-1"></a></span>
<span id="cb411-34"><a href="bivariate-data.html#cb411-34" tabindex="-1"></a>res_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x0, h, res_lo){</span>
<span id="cb411-35"><a href="bivariate-data.html#cb411-35" tabindex="-1"></a>    <span class="co"># Assign equal weight to observations within h distance to x0</span></span>
<span id="cb411-36"><a href="bivariate-data.html#cb411-36" tabindex="-1"></a>    <span class="co"># 0 weight for all other observations</span></span>
<span id="cb411-37"><a href="bivariate-data.html#cb411-37" tabindex="-1"></a>    ki <span class="ot">&lt;-</span> <span class="fu">dunif</span>(res_lo<span class="sc">$</span>x, x0<span class="sc">-</span>h, x0<span class="sc">+</span>h) </span>
<span id="cb411-38"><a href="bivariate-data.html#cb411-38" tabindex="-1"></a>    ei <span class="ot">&lt;-</span> res_lo[ki<span class="sc">!=</span><span class="dv">0</span>,<span class="st">&#39;e&#39;</span>]</span>
<span id="cb411-39"><a href="bivariate-data.html#cb411-39" tabindex="-1"></a>    res_i <span class="ot">&lt;-</span> <span class="fu">quantile</span>(ei, <span class="at">probs=</span><span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb411-40"><a href="bivariate-data.html#cb411-40" tabindex="-1"></a>}</span>
<span id="cb411-41"><a href="bivariate-data.html#cb411-41" tabindex="-1"></a>X0 <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(xy<span class="sc">$</span>x))</span>
<span id="cb411-42"><a href="bivariate-data.html#cb411-42" tabindex="-1"></a>res_lo2 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(X0, res_fun, <span class="at">h=</span><span class="dv">15</span>, <span class="at">res_lo=</span>res_lo)</span>
<span id="cb411-43"><a href="bivariate-data.html#cb411-43" tabindex="-1"></a></span>
<span id="cb411-44"><a href="bivariate-data.html#cb411-44" tabindex="-1"></a><span class="fu">lines</span>( X0, preds_lo <span class="sc">+</span>res_lo2[<span class="dv">1</span>,],</span>
<span id="cb411-45"><a href="bivariate-data.html#cb411-45" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">hcl.colors</span>(<span class="dv">3</span>,<span class="at">alpha=</span>.<span class="dv">75</span>)[<span class="dv">2</span>], <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb411-46"><a href="bivariate-data.html#cb411-46" tabindex="-1"></a><span class="fu">lines</span>( X0, preds_lo <span class="sc">+</span>res_lo2[<span class="dv">2</span>,],</span>
<span id="cb411-47"><a href="bivariate-data.html#cb411-47" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">hcl.colors</span>(<span class="dv">3</span>,<span class="at">alpha=</span>.<span class="dv">75</span>)[<span class="dv">2</span>], <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="03-LinearRegression_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reporting.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multivariate-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["index.pdf", "index.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
