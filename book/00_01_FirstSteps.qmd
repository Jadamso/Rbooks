
# First Steps
***

## Why Program in R?

You should program your statistical analysis, and we will cover some of the basics of how to do this in R. You also want your work to be replicable

* *Replicable*: someone collecting new data comes to the same results.
* *Reproducibile*: someone reusing your data comes to the same results.

You can read more about the distinction in many places, including

* <https://www.annualreviews.org/doi/10.1146/annurev-psych-020821-114157>
* <https://nceas.github.io/sasap-training/materials/reproducible_research_in_r_fairbanks/>

We focus on R because it is good for complex stats, concise figures, and coherent organization. It is built and developed by applied statisticians for statistics, and used by many in academia and industry. 

* You see the exact steps you took and found an error
  * Google *"worst Excel errors"* and note the frequency they arise from copy/paste via the "point-and-click" approach. E.g., *Fidelity's $2.6 Billion Dividend Error*.
    * Glad you found a problem before sending your research out! See <https://retractionwatch.com/> and <https://econjwatch.org/>.
* You try out a new plot you found in *The Visual Display of Quantitative Information*, by Edward Tufte.
  * It's not a standard plot, but google answers most of your questions.
  * Tutorials help avoid bad practices, such as plotting 2D data as a 3D object (see e.g., <https://clauswilke.com/dataviz/no-3d.html>).
* You try out an obscure statistical approach that's hot in your field.
  * it doesn't make the report, but you have some confidence that candidate issue isn't a big problem
  
So my main sell to you is that being reproducible is in your own self-interest. For students, think about labor demand and what may be good for getting a job. Do some of your own research to best understand how much to invest.


## First Steps

#### **Install R**. {-}

First Install [R](https://cloud.r-project.org/).
Then Install [Rstudio](https://www.rstudio.com/products/rstudio/download/).

For Fedora (linux) users, note that you need to first enable the repo and then install

```{bash, eval=F}
sudo dnf install 'dnf-command(copr)'
sudo dnf copr enable iucar/rstudio
sudo dnf install rstudio-desktop
```


*Make sure you have the latest version of R and Rstudio for class.* If not, then reinstall. 

#### **Interfacing with R Studio**. {-}

Rstudio is perhaps the easiest to get going with. (There are other GUI's.)

In Rstudio, there are 4 panes. (If you do not see 4, click "file > new file > R script" on the top left of the toolbar.)

```{r, echo=F}
knitr::include_graphics("../docs/Figures_Manual/Rstudio.svg")
```

The top left pane is where you write your code. For example, type
```{r, eval=F}
#| code-fold: false
1+1
```

The pane below is where your code is executed. 
Keep you mouse on the same line as your code, and then click "Run". 
You should see
```
> 1+1
[1] 2
```
If you click "Run" again, you should see that same output printed again.

You should add comments to your codes, and you do this with hashtags. For example
```
# This is my first comment!
1+1 # The simplest calculation I could think of
```
You can execute each line one-at-a-time. Or you can highlight them both, to take advantage of how R executes commands line-by-line.

#### **Reading This Textbook**. {-}

As we proceed, you can see both my source code and output like this:
```{r}
1+1
```

In later chapters, there are also special boxes for especially important statistical examples.

:::{.callout-note icon=false collapse="true"}
This box contains *need to know* examples. Such as 
```{r}
1+1
```
:::

:::{.callout-tip icon=false collapse="true"}
This box contains *test yourself* examples and questions. Such as 
```{r}
2+7
2/7
```
:::


To understand each chunk of code:

* Copy/paste it into your Rstudio
* Run it
* Predict what happens if changed
* Change it
* Break it
* Fix it


#### **Assignment**. {-}

You can create "variables" that store values. For example,
```{r}
x <- 1 # Make your first variable
x + 1 # The simplest calculation I could think of
```

```{r}
x <- 23 #Another example
x + 1
```

```{r}
y <- x + 1 #Another example
y
```

Your variables must be defined in order to use them. Otherwise you get an error. For example,
```{r, error=TRUE}
X +   1 # notice that R is sensitive to capitalization 
```


#### **Scripting**. {-}

* Create a folder on your computer to save your scripts
* Save your `R Script` file as *My_First_Script.R* in your folder
* Close Rstudio
* Open your script and re-run it

As you work through the material, make sure to both execute and save your scripts. Add lots of commentary to your scripts. Name your scripts systematically.

There are often many ways to accomplish the same goal. You first scripts will be very basic and rough, but you can edit them later based on what you learn. And you can always ask R for help
```{r, eval=F}
sum(x, 2) # x + 2
?sum
```

We write script in the top left so that we can edit common mistakes.
```{r, eval=F}
# Mistake 1: using undefined objects
Y

#  Mistake 2: spelling and spacing
Y < - 43
Y_plus_z <- Y + z

# Mistake 3: half-completed code
x + y + 
x_plus_y_plus_z <- x + y + z
# Seeing "+" in the bottom console?
# press "Escape" and try again
```
Your variable names do not matter technically, but they should be informative to help avoid common mistakes.

## Mathematical Objects

In R: scalars, vectors, and matrices are different kinds of "objects". 

These objects are used extensively in data analysis

* *scalars*: summary statistics (average household income).
* *vectors*: single variables in data sets (the household income of each family in Vancouver).
* *matrices*: two variables in data sets (the age and education level of every person in class).


Vectors are probably your most common object in R, but we will start with scalars.


#### **Scalars**. {-}

Make your first scalar
```{r}
xs <- 2 # Make your first scalar
xs  # Print the scalar
```

Perform simple calculations and see how R is doing the math for you
```{r}
xs + 2
xs*2 # Perform and print a simple calculation
(xs+1)^2 # Perform and print a simple calculation
xs + NA # often used for missing values
```

Now change `xs`, predict what will happen, then re-run the code.

#### **Vectors**. {-}

Make your first vector
```{r}
x <- c(0,1,3,10,6) # Your First Vector
x # Print the vector
x[2] # Print the 2nd Element; 1
x+2 # Print simple calculation; 2,3,5,8,12
x*2
x^2
```

Apply mathematical calculations elementwise
```{r}
x+x
x*x
x^x
```

In R, scalars are treated as a vector with one element.
```{r}
c(1)
```


#### **Matrices**. {-}

Matrices are also common objects
```{r}
x1 <- c(1,4,9)
x2 <- c(3,0,2)
x_mat <- rbind(x1, x2)

x_mat       # Print full matrix
x_mat[2,]   # Print Second Row
x_mat[,2]   # Print Second Column
x_mat[2,2]  # Print Element in Second Column and Second Row
```


There are elementwise calculations
```{r}
x_mat+2
x_mat*2
x_mat^2

x_mat + x_mat
x_mat * x_mat
```


## Mathematical Functions

#### **Creating Simple Functions**. {-}

Functions are applied to objects
```{r}
# Define a function that adds two to any vector
add_two <- function(input_vector) { #input_vector is a placeholder
    output_vector <- input_vector + 2 # new object defined locally 
    return(output_vector) # return new object 
}
# Apply that function to a vector
x <- c(0,1,3,10,6)
add_two(input_vector=x) #same as add_two(x)
```

Common mistakes:
```{r, eval=F}
print(output_vector)
# This is not available globally

# Double check your spelling
x < - add_two(input_vector=X) 

# Seeing "+" in the bottom console
# often means you forgot to close the function with "}" 
# press "Escape" and try again
add_two <- function(input_vector) { 
    output_vector <- input_vector + 2 
    return(output_vector)
x <- c(0,1,3,10,6)
add_two(x)
```

There are many different functions. Many of which functions have defaults.
```{r}
add_scalar <- function(input_vector1, input_scalar2) {
    output_vector <- input_vector1 + input_scalar2
    return(output_vector)
}
add_scalar(x,3)
add_scalar(x,4)

add_scalar0 <- function(input_vector1, input_scalar2=3) {
    output_vector <- input_vector1 + input_scalar2
    return(output_vector)
}
add_scalar0(x)
add_scalar0(x,4)
```


#### **Common Functions**. {-}

Perhaps the most common function we will use is summation

```{r}
x
sum(x)
```

Sometimes, we will use vectors that are entirely ordered. We make them with functions.
```{r}
seq(1,7,by=1) #1:7
seq(1,7,by=0.5)

# Ordering data
sort(x)
x[order(x)]
```

You can apply functions to each row or column of a matrix
```{r}
x_mat
sum(x_mat[1,]) #sum first row
sum(x_mat[,1]) #sum first column

y_row <- apply(x_mat, 1, sum)
y_row

y_col <- apply(x_mat, 2, sum)
y_col
```


You can see what a function does and various options with `?`.
```{r, eval=F}
?seq

?apply 
```


#### **Loops**. {-}

Applying the same function over and over again
```{r}
# Example 1: simple division
x <- vector(length=3)
#Fill empty vector
for(i in seq(1,3)){
    x[i] <- i/2
}
x
# Compare

# Example 2: exponential
#Create empty vector
x <- vector(length=3)
#Fill empty vector
for(i in seq(1,3)){
    x[i] <- exp(i)
}
# Compare
x
c( exp(1), exp(2), exp(3))

# Example 3: using existing data
x <- c(1,3,9,2)
y <- vector(length=length(x))
for(i in seq_along(x) ){
    y[i] <- x[i] + 1
}
y
```


A recursive example
```{r}
x <- vector(length=4)
x[1] <- 1
for(i in seq(2,4) ){
    x[i] <- x[i-1]^2
}
x
```


#### **Basic Logic**. {-}

TRUE/FALSE
```{r}
x <- c(1,2,3,NA)
x > 2
x==2

any(x==2)
all(x==2)
2 %in% x

2==TRUE
2==FALSE
 
is.numeric(x)
is.na(x)
```

The "&" and "|" commands are logical calculations that compare vectors to the left and right.
```{r}
x <- seq(1,3)
(x >= 1) & (x < 2)
(x >= 1) | (x < 2)

if( all(x >= 1) ){
    print("ok")
} else {
    print("not ok")
}

logic_fun <- function(x){
    if( all(x >= 1) ){
        print("ok")
    } else {
        print("not ok")
    }
}
logic_fun( seq(1,3) )
logic_fun( seq(0,2) )
```


## Further Reading


For more on why to program in R, see

* <http://www.r-bloggers.com/the-reproducibility-crisis-in-science-and-prospects-for-r/>
* <http://fmwww.bc.edu/GStat/docs/pointclick.html>
* <https://github.com/qinwf/awesome-R\#reproducible-research>
* A Guide to Reproducible Code in Ecology and Evolution
* <https://biostat.app.vumc.org/wiki/pub/Main/TheresaScott/ReproducibleResearch.TAScott.handout.pdf>

The most common programming tasks can be found <https://github.com/rstudio/cheatsheets/blob/main/rstudio-ide.pdf>

There are many good and free programming materials online. For help setting up, see any of the following links

* <https://learnr-examples.shinyapps.io/ex-setup-r/>
* <https://rstudio-education.github.io/hopr/starting.html>
* <https://a-little-book-of-r-for-bioinformatics.readthedocs.io/en/latest/src/installr.html>
* <https://cran.r-project.org/doc/manuals/R-admin.html>
* <https://courses.edx.org/courses/UTAustinX/UT.7.01x/3T2014/56c5437b88fa43cf828bff5371c6a924/>
* <https://owi.usgs.gov/R/training-curriculum/installr/>
* <https://www.earthdatascience.org/courses/earth-analytics/document-your-science/setup-r-rstudio/>

