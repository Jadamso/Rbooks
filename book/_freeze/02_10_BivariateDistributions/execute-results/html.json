{
  "hash": "053dab924d5533854ebd2f50f6ba77cb",
  "result": {
    "engine": "knitr",
    "markdown": "\n# Bivariate Distributions\n***\n\nWe will now study two variables. The data for each observation data can be grouped together as a vector $(\\hat{X}_{i}, \\hat{Y}_{i})$.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Bivariate Data from USArrests\nxy <- USArrests[,c('Murder','UrbanPop')]\nxy[1,]\n##         Murder UrbanPop\n## Alabama   13.2       58\n```\n:::\n\n\n## Joint Distributions\n\n#### **Discrete Data**.{-}\n\nWe have multiple observations of $(\\hat{X}_{i}, \\hat{Y}_{i})$, each of which corresponds to a unique value $(x,y)$. A frequency table shows how often each combination of values appear. The *joint distribution* counts up the number of pairs with the same values and divides by the number of obersvations, $n$;\n\\begin{eqnarray}\n\\hat{p}_{xy} = \\sum_{i=1}^{n}\\mathbf{1}\\left( \\hat{X}_{i}=x, \\hat{Y}_{i}=y \\right)/n,\n\\end{eqnarray}\nThe *marginal distributions* are just the univariate information, which can be computed independently (see [here](https://jadamso.github.io/Rbooks/01_06_PopStatistics.html#estimates) ) and also from the joint distribution\n\\begin{eqnarray}\n\\hat{p}_{x} = \\sum_{y} \\hat{p}_{xy}\n\\end{eqnarray}\n\nFor example, suppose we observe a sample of $n=13$ students with two discrete variables:\n\n* $X_{i}$ depicts years of education, taking values in $\\{12, 14\\}$\n* $Y_{i}$ depicts sex, where $y=1$ means female and $y=0$ means male\n\nAssume the count data are summarized by the following table:\n\n\\begin{array}{c|cc|c}\n & y=0\\ (\\text{male}) & y=1\\ (\\text{female})\\\\\n\\hline\nx=12 & 4 & 3 \\\\\nx=14 & 1 & 5 \\\\\n\\hline\n\\end{array}\n\nThe joint distributions divides each cell count by the total number of observations to obtain\n\\begin{array}{c|cc}\n & y=0 & y=1\\\\\n\\hline\nx=12 & 4/13 & 3/13 \\\\\nx=14 & 1/13 & 5/13\n\\end{array}\nThe marginal distribution of $X_{i}$ is\n\\begin{eqnarray}\n\\hat{p}_{x=12} &=& \\frac{4}{13} + \\frac{3}{13} = \\frac{7}{13},\\\\\n\\hat{p}_{x=14} &=& \\frac{1}{13} + \\frac{5}{13} = \\frac{6}{13}.\n\\end{eqnarray}\nThe marginal distribution of $Y_{i}$ is\n\\begin{eqnarray}\n\\hat{p}_{y=0} &=& \\frac{4}{13}  + \\frac{1}{13} = \\frac{5}{13} \\approx 0.38,\\\\\n\\hat{p}_{y=1} &=& \\frac{3}{13}  + \\frac{5}{13} = \\frac{8}{13} \\approx 0.62.\n\\end{eqnarray}\n\nTogether, this yields a frequency table with marginals\n\\begin{array}{c|cc|c}\n & y=0\\ (\\text{male}) & y=1\\ (\\text{female}) & \\text{Row total}\\\\\n\\hline\nx=12 & 4/13 & 3/13 & 7/13\\\\\nx=14 & 1/13 & 5/13 & 6/13\\\\\n\\hline\n\\text{Column total} & 5/13 & 8/13 & 1\n\\end{array}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simple hand-built dataset: 13 students\ndat <- rbind(\n    c(12, 0), c(12, 0), c(12, 0), c(12, 0), #Male\n    c(14, 0), \n    c(12, 1), c(12, 1), c(12, 1),\n    c(14, 1), c(14, 1), c(14, 1), c(14, 1), c(14, 1))\ncolnames(dat) <- c('educ', 'female')\ndat <- as.data.frame(dat)\n\n# Frequency table\ntab  <- table(dat)          # counts\nprop <- tab/sum(tab)        # joint distribution p_xy\n\n# joint distribution with marginals added\nprop_m <- addmargins(prop)\nround(prop_m,2)\n##      female\n## educ     0    1  Sum\n##   12  0.31 0.23 0.54\n##   14  0.08 0.38 0.46\n##   Sum 0.38 0.62 1.00\n```\n:::\n\n\nNote that you can compute various univariate statistics using the marginal distributions. E.g., the mean of $\\hat{X}_{i}$ is $\\hat{M}_{X}=\\sum_{x} x \\hat{p}_{x}$. In the the above example, that equals $12 \\frac{7}{13} + 14\\frac{6}{13} \\approx 12.9$. Try computing the standard deviation $\\hat{S}_{X}$ yourself.\n\n::: {.cell}\n\n```{.r .cell-code}\n# marginals and univariate statistics\np_x <- margin.table(prop, 1)\nsum(p_x* as.numeric(names(p_x)) )\n## [1] 12.92308\nmean(dat[,1])\n## [1] 12.92308\n\n# p_y <- margin.table(prop, 2)\n```\n:::\n\n\n\n\n:::{.callout-tip icon=false collapse=\"true\"}\nSummarize the distribution of sex and education attainment for highschool students\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(wooldridge)\n\n# Highschool Students, Sex and Education Attainment\ndat <- wage1[,c('educ','female')]\ndat <- dat[ dat[,'educ'] >=10,]\n```\n:::\n\nTry it yourself before looking at this answer\n\n::: {.cell}\n\n```{.r .cell-code}\ntab <- table(dat) ## counts\ntab\n##     female\n## educ   0   1\n##   10  13  17\n##   11  17  12\n##   12  85 113\n##   13  14  25\n##   14  31  22\n##   15  12   9\n##   16  45  23\n##   17  10   2\n##   18  13   6\n\nprop <- tab/sum(tab) ## frequencies\nround(prop,3)\n##     female\n## educ     0     1\n##   10 0.028 0.036\n##   11 0.036 0.026\n##   12 0.181 0.241\n##   13 0.030 0.053\n##   14 0.066 0.047\n##   15 0.026 0.019\n##   16 0.096 0.049\n##   17 0.021 0.004\n##   18 0.028 0.013\n\nprop_full <- addmargins(prop) ## column and row sums\nround(prop_full,3)\n##      female\n## educ      0     1   Sum\n##   10  0.028 0.036 0.064\n##   11  0.036 0.026 0.062\n##   12  0.181 0.241 0.422\n##   13  0.030 0.053 0.083\n##   14  0.066 0.047 0.113\n##   15  0.026 0.019 0.045\n##   16  0.096 0.049 0.145\n##   17  0.021 0.004 0.026\n##   18  0.028 0.013 0.041\n##   Sum 0.512 0.488 1.000\n```\n:::\n\n:::\n\n\n#### **Continuous Data**.{-}\n\nScatterplots are used frequently to summarizes the joint distribution of continuous data. They can be enhanced in several ways. As a default, use semi-transparent points so as not to hide any points (and perhaps see if your observations are concentrated anywhere). You can also add other features that help summarize the relationship, although I will defer this until later.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(Murder~UrbanPop, USArrests, pch=16, col=grey(0.,.5))\n```\n\n::: {.cell-output-display}\n![](02_10_BivariateDistributions_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nYou can also show the *marginal distributions* of each variable along each axis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Setup Plot\nlayout( matrix(c(2,0,1,3), ncol=2, byrow=TRUE),\n    widths=c(9/10,1/10), heights=c(1/10,9/10))\n\n# Scatterplot\npar(mar=c(4,4,1,1))\nplot(Murder~UrbanPop, USArrests, pch=16, col=rgb(0,0,0,.5))\n\n# Add Marginals\npar(mar=c(0,4,1,1))\nxhist <- hist(USArrests[,'UrbanPop'], plot=FALSE)\nbarplot(xhist[['counts']], axes=FALSE, space=0, border=NA)\n\npar(mar=c(4,0,1,1))\nyhist <- hist(USArrests[,'Murder'], plot=FALSE)\nbarplot(yhist[['counts']], axes=FALSE, space=0, horiz=TRUE, border=NA)\n```\n\n::: {.cell-output-display}\n![](02_10_BivariateDistributions_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## Conditional Distributions\n\n#### **Discrete Data**.{-}\n\nIn contrast to marginal and joint distributions, *conditional* distributions describe how the distribution of one variable changes when we restrict attention to a subgroup defined by another variable. Formally, if $\\hat{p}_{xy}$ denotes the empirical joint distribution, then the empirical conditional distribution of $Y_{i}$ given $X_{i}=x$ is\n\\begin{eqnarray}\n\\hat{p}_{y \\mid x} = \\frac{\\hat{p}_{xy}}{\\hat{p}_{x} },\n\\end{eqnarray}\nwhere $\\hat{p}_{x} = \\sum_y \\hat{p}_{xy}$.\n\n\nFor example, suppose we observe a sample of $n=13$ students with two discrete variables:\n\n* $X_{i}$ depicts years of education, taking values in $\\{12, 14\\}$\n* $Y_{i}$ depicts sex, where $y=1$ means female and $y=0$ means male\n\nAssume the count data are summarized by the following frequency table:\n\n\\begin{array}{c|cc|c}\n & y=0\\ (\\text{male}) & y=1\\ (\\text{female}) & \\text{Row total}\\\\\n\\hline\nx=12 & 4/13 & 3/13 & 7/13\\\\\nx=14 & 1/13 & 5/13 & 6/13\\\\\n\\hline\n\\text{Column total} & 5/13 & 7/13 & 1\n\\end{array}\n\nWe will compute the conditional distribution of $Y_{i}$ given $X_{i}=x$. For $x=12$, we compute\n\\begin{eqnarray}\n\\hat{p}_{y=0 \\mid x=12}\n&=& \\frac{\\hat{p}_{x=12, y=0}}{\\hat{p}_{x=12}}\n= \\frac{4/13}{7/13}\n= \\frac{4}{7} \n\\approx 0.57. \\\\\n\\hat{p}_{y=1\\mid x=12}\n&=& \\frac{\\hat p_{x=12, y=1}}{\\hat{p}_{x=12}}\n= \\frac{3/13}{7/13}\n= \\frac{3}{7}\n\\approx 0.43.\n\\end{eqnarray}\nSimilarly, for $x=14$, we compute\n\\begin{eqnarray}\n\\hat{p}_{y=0 \\mid x=14}\n&=& \\frac{\\hat{p}_{x=14, y=0}}{\\hat{p}_{x=14}}\n= \\frac{1/13}{6/13}\n= \\frac{1}{6}\n\\approx 0.17. \\\\\n\\hat{p}_{y=1\\mid x=14}\n&=& \\frac{\\hat p_{x=14, y=1}}{\\hat{p}_{x=14}}\n= \\frac{5/13}{6/13}\n= \\frac{5}{6}\n\\approx 0.83.\n\\end{eqnarray}\n\nIn this example, we say that\n\n* conditional on students having $12$ years of education, $\\approx 57\\%$ are male and $\\approx 43\\%$ are female.\n* conditional on students having $14$ years of education, $\\approx 17\\%$ are male and $\\approx 83\\%$ are female.\n\n\nWe can also compute the conditional distribution of $X_{i}$ given $Y_{i}=y$, $\\hat{p}_{x \\mid y} = \\hat{p}_{xy} / \\hat{p}_{y}$,just as we did above.\n\n:::{.callout-tip icon=false collapse=\"true\"}\nContinuing the example above, show that\n\n* among male students, $\\approx 80\\%$ have 12 years of education.\n* among female students, $\\approx 38\\%$ have 12 years of education.\n\nTry programming the results, especially if you are stuck or uncertain\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- rbind(\n    c(12, 0), c(12, 0), c(12, 0), c(12, 0), #Male\n    c(14, 0), \n    c(12, 1), c(12, 1), c(12, 1),\n    c(14, 1), c(14, 1), c(14, 1), c(14, 1), c(14, 1))\ncolnames(dat) <- c('educ', 'female')\ndat <- as.data.frame(dat)\n\ntab <- table(dat)\ntab\n##     female\n## educ 0 1\n##   12 4 3\n##   14 1 5\n\n# Joint distribution\nround(prop.table(tab), 3)\n##     female\n## educ     0     1\n##   12 0.308 0.231\n##   14 0.077 0.385\n\n# Conditional distribution of Y given X\nround(prop.table(tab, 1), 3)\n##     female\n## educ     0     1\n##   12 0.571 0.429\n##   14 0.167 0.833\n\n# Conditional distribution of X given Y\nround(prop.table(tab, 2), 3)\n##     female\n## educ     0     1\n##   12 0.800 0.375\n##   14 0.200 0.625\n```\n:::\n\n\n:::\n\nConditional distributions change the unit of analysis:\n\n* $\\hat{p}_{y=1 \\mid x=14}$ answers \"what fraction of student are female within the subgroup with 14 years of education?\"\n* $\\hat{p}_{x=14 \\mid y=1}$ answers \"what fraction of students have 14 years of education within the subgroup that is female?\"\n\n\n#### **Continuous Data**.{-}\n\nThese describe the relationship between $\\hat{Y}_{i}$ and $\\hat{X}_{i}$. We show how $Y$ changes according to $X$ using a \n[histogram](https://jadamso.github.io/Rbooks/01_02_Data.html#histogram-density-estimate) or bar plot. When $X$ is continuous, as it often is, we split it into distinct bins and convert it to a factor variable. E.g.,  \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Split Data by Urban Population above/below mean\npop_mean <- mean(USArrests[,'UrbanPop'])\npop_cut <- USArrests[,'UrbanPop'] <= pop_mean\nmurder_lowpop <- USArrests[pop_cut,'Murder']\nmurder_highpop <- USArrests[!pop_cut,'Murder']\ncols <- c(low=rgb(0,0,1,.75), high=rgb(1,0,0,.75))\n\n# Common Histogram \nylim <- c(0,.25)\nxbks <-  seq(min(USArrests[,'Murder'])-1, max(USArrests[,'Murder'])+1, by=1)\n\npar(mfrow=c(1,2))\nhist(murder_lowpop,\n    breaks=xbks, col=cols[1],\n    main='Urban Pop <= Mean', font.main=1,\n    xlab='Murder Arrests', freq=F,\n    border=NA, ylim=ylim)\n\nhist(murder_highpop,\n    breaks=xbks, col=cols[2],\n    main='Urban Pop > Mean', font.main=1,\n    xlab='Murder Arrests', freq=F,\n    border=NA, ylim=ylim)\n```\n\n::: {.cell-output-display}\n![](02_10_BivariateDistributions_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nIt is sometimes it is preferable to show the [ECDF](https://jadamso.github.io/Rbooks/docs/01_02_Data.html#empirical-cumulative-distribution-function) instead. And you can glue various combinations together to convey more information all at once\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlayout( t(c(1,2,2)))\n# Full Sample Density\nhist(USArrests[,'Murder'], \n    main='Full Sample Density', font.main=1,\n    xlab='Murder Arrests',\n    breaks=xbks, freq=F, border=NA)\n\n# Split Sample Distribution Comparison\nF_lowpop <- ecdf(murder_lowpop)\nplot(F_lowpop, col=cols[1],\n    pch=16, xlab='Murder Arrests',\n    main='Split Sample Distributions',\n    font.main=1, bty='n')\nF_highpop <- ecdf(murder_highpop)\nplot(F_highpop, add=T, col=cols[2], pch=16)\n\nlegend('bottomright', col=cols,\n    pch=16, bty='n', inset=c(0,.1),\n    title='% Urban Pop.',\n    legend=c('Low (<= Mean)','High (> Mean)'))\n```\n\n::: {.cell-output-display}\n![](02_10_BivariateDistributions_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simple Interactive Scatter Plot\n# plot(Assault~UrbanPop, USArrests, col=grey(0,.5), pch=16,\n#    cex=USArrests[,'Murder']/diff(range(USArrests[,'Murder']))*2,\n#    main='US Murder arrests (per 100,000)')\n```\n:::\n\n\nYou can also split data into more than two groups. For more than three groups, boxplots are often more effective than histograms or ECDF's.\n\n::: {.cell}\n\n```{.r .cell-code}\n# K Groups with even spacing (not even counts)\nK <- 4\nUSArrests[,'UrbanPop_Kcut'] <- cut(USArrests[,'UrbanPop'],K)\ntable(USArrests[,'UrbanPop_Kcut'] )\n## \n## (31.9,46.8] (46.8,61.5] (61.5,76.2] (76.2,91.1] \n##           6          13          17          14\n\n# Full sample\n#boxplot(USArrests[,'Murder'], main='',\n#    xlab='All Data', ylab='Murder Arrests')\n\n# Boxplots for each group\nKcols <- hcl.colors(K,alpha=.5)\nboxplot(Murder~UrbanPop_Kcut, USArrests,\n    main='', col=Kcols, \n    varwidth=T, #show number of obs. per group\n    xlab='Urban Population', ylab='')\n```\n\n::: {.cell-output-display}\n![](02_10_BivariateDistributions_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\n# 4 Groups with equal numbers of observations\n#Qcuts <- c(\n#    '0%'=min(USArrests[,'UrbanPop'])-10*.Machine[['double.eps']],\n#    quantile(USArrests[,'UrbanPop'], probs=c(.25,.5,.75,1)))\n#USArrests[,'UrbanPop']_cut <- cut(USArrests[,'UrbanPop'], Qcuts)\n#boxplot(Murder~UrbanPop_cut, USArrests, col=hcl.colors(4,alpha=.5))\n```\n:::\n\n\n\n## Simpson's Paradox\n\nConditional distributions can be tricky, so take your time making and interpreting them. \n\nConsider the following example, which shows that $400$ men and $400$ women applied to university and that only a share were accepted in each department (English or Engineering). If you computed percents for each sex within each cell, you would find men have a higher overall acceptance rate, but women have higher acceptance rates within each department! This counterintuitive phenomena is known as Simpson's Paradox, and the example is part of a real debate about discrimination (<http://homepage.stat.uiowa.edu/~mbognar/1030/Bickel-Berkeley.pdf>). \n\nEven if women have higher admission rates within both departments, women can still have a lower overall admission rate if women disproportionately apply to the more selective department (English) and men disproportionately apply to the less selective department (Engineering). The same issue is relevant for a variety of labor market issues, such as the gender pay gap, and a great many other social issues, such as why are some countries rich and others poor.^[In general, one should also remember that a ratio can change due changes in either the numerator or the denominator.]\n\n\n| Department   | Men                  | Women                 | Total                 |\n|-------------|-----------------------|-----------------------|-----------------------|\n| English     | 100 (40, **$40\\%$**)      | 350 (150, **$43\\%$**)     | 450 (190, **$42\\%$**)     |\n| Engineering | 300 (160, **$53\\%$**)     | 50 (30, **$60\\%$**)       | 350 (190, **$54\\%$**)     |\n| Total       | 400 (200, **$50\\%$**)     | 400 (180, **$45\\%$**)     | 800 (380, **$48\\%$**)     |\n\n: School Applicants (Admitted), by Sex and Department\n\n\nThe same issue shows up in continuous data. Here is an example where the overall relationship differs from the relationship within each group.\n\n::: {.cell}\n::: {.cell-output-display}\n![](02_10_BivariateDistributions_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n## Further Reading \n\nFor plotting histograms and marginal distributions, see \n\n* <https://www.r-bloggers.com/2011/06/example-8-41-scatterplot-with-marginal-histograms/>\n* <https://r-graph-gallery.com/histogram.html>\n* <https://r-graph-gallery.com/74-margin-and-oma-cheatsheet.html>\n* <https://jtr13.github.io/cc21fall2/tutorial-for-scatter-plot-with-marginal-distribution.html>\n\n\n\n",
    "supporting": [
      "02_10_BivariateDistributions_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}