{
  "hash": "aea345af10624f7eb41355dd1239a9ae",
  "result": {
    "engine": "knitr",
    "markdown": "\n# Bivariate Statistics\n***\n\nAll of the univariate statistics we have covered apply to marginal distributions. For joint distributions, there are several ways to statistically describe the relationship between two variables. The major differences surround whether the data are cardinal or an ordered/unordered factor. \n\n## Statistics of Association\n\n#### **Two Cardinals**. {-}\n*Pearson (Linear) Correlation*.\nSuppose you have two vectors, $\\hat{X}$ and $\\hat{Y}$, that are both cardinal data. As such, you can compute the most famous measure of association, the covariance. Letting $\\hat{M}_{X}$ and $\\hat{M}_{Y}$ denote the mean of $\\hat{X}$ and $\\hat{Y}$, we have\n\\begin{eqnarray}\n\\hat{C}_{XY} =  \\sum_{i=1}^{n} [\\hat{X}_{i} - \\hat{M}_{X}] [\\hat{Y}_i - \\hat{M}_{Y}] / n\n\\end{eqnarray}\n\nNote that covariance of $\\hat{X}$ and $\\hat{X}$ is just the variance of $\\hat{X}$; $\\hat{C}_{XX}=\\hat{V}_{X}$, and recall that the standard deviation is $\\hat{S}_{X}=\\sqrt{\\hat{V}_X}$. For ease of interpretation and comparison, we rescale the correlation statistic to always lay on a scale $-1$ and $+1$. A value close to $-1$ suggests negative association, a value close to $0$ suggests no association, and a value close to $+1$ suggests positive association.\n\\begin{eqnarray}\n\\hat{R}_{XY} = \\frac{ \\hat{C}_{XY} }{ \\hat{S}_{X} \\hat{S}_{Y}}\n\\end{eqnarray}\n\n:::{.callout-note icon=false collapse=\"true\"}\nWhat is the correlation for the dataset $\\{ (0,0.1) , (1, 0.3), (2, 0.2) \\}$? Find the answer both mathematically and computationally.\n\nMathematically, there are five steps.\n\nStep 1: Compute the means\n\\begin{eqnarray}\n\\hat{M}_{X} &=& \\frac{0+1+2}{3} = 1 \\\\\n\\hat{M}_{Y} &=& \\frac{0.1+0.3+0.2}{3} = 0.2\n\\end{eqnarray}\n\nStep 2: Compute the deviances\n\\begin{eqnarray}\n\\begin{array}{c|rrrr}\n\\hat{X}_i   & 0   & 1 & 2 \\\\\n\\hat{X}_i-\\hat{M}_{X} & -1  & 0 & 1 \\\\\n\\hat{Y}_i   & 0.1 & 0.3 & 0.2 \\\\\n\\hat{Y}_i-\\hat{M}_{Y}   & -0.1 & 0.1 & 0 \n\\end{array}\n\\end{eqnarray}\n\nStep 3: Compute the Covariance\n\\begin{eqnarray}\n\\hat{C}_{XY} &=&\n\\sum  (\\hat{X}_i-\\hat{M}_{X})(\\hat{Y}_i-\\hat{M}_{Y})/n \n= \\left[ (-1)(-0.1) + 0(0.1) + 1(0) \\right] \\frac{1}{3} \n=  (-0.1) \\frac{1}{3}\n= 1/30\n\\end{eqnarray}\n\nStep 4: Compute Standard Deviations\n\\begin{eqnarray}\n\\hat{V}_{X} &=& \\sum_{i=1}^n \\left(\\hat{X}_i-\\hat{M}_{X}\\right)^2 / n\n= \\left[(-1)^2+0^2+1^2 \\right]/3\n= 2/3 \\\\\n\\hat{S}_{X} &=& \\sqrt{2/3} \\\\\n\\hat{V}_{Y} &=& \\sum_{i=1}^n \\left( \\hat{Y}_i-\\hat{M}_{Y} \\right)^2 / n\n= \\left[ (-0.1)^2+(0.1)^2+0^2 \\right]/3\n= \\left[0.01+0.01\\right]/3\n= \\frac{2}{100} \\frac{1}{3} = 2/300 \\\\\n\\hat{S}_{Y} &=& \\sqrt{2/300}\n\\end{eqnarray}\n\nStep 5: Compute the Correlation\n\\begin{eqnarray}\n\\frac{\\hat{C}_{XY}}{\\hat{S}_X \\hat{S}_Y}\n&=& \\frac{1/30}{ \\sqrt{2/3}  \\sqrt{2/300}}\n= \\frac{1/30}{ 2 /\\sqrt{900}}\n= \\frac{1/30}{2/30} = 1/2\n\\end{eqnarray}\n\nNote that this value suggests a positive relationship between the variables.\n\nComputationally, we do the same steps\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the Data\nX <- c(0,1,2)\nX\n## [1] 0 1 2\nY <- c(0.1,0.3,0.2)\nY\n## [1] 0.1 0.3 0.2\n\n# Compute the Means\nmX <- mean(X)\nmY <- mean(Y)\n\n# Compute the Deviances\ndev_X <- X - mX\ndev_Y <- Y - mY\n\n# Compute the Covariance\ncov_manual <-  sum(dev_X * dev_Y) / length(X)\n\n# Compute the Standard Deviations\nvar_X <- sum(dev_X^2) / length(X)\nsd_X <- sqrt(var_X)\nvar_Y <- sum(dev_Y^2) / length(Y)\nsd_Y <- sqrt(var_Y)\n\n# Compute the Correlation\ncor_manual <- cov_manual / (sd_X * sd_Y)\ncor_manual\n## [1] 0.5\n\n# Verify with the built-in function\ncor(X,Y)\n## [1] 0.5\n```\n:::\n\n:::\n\n\n\nYou can conduct hypothesis tests for these statistics using the same procedures we learned for univariate data. For example, by inverting a confidence interval.\n\n:::{.callout-note icon=false collapse=\"true\"}\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the Data\nxy <- USArrests[,c('Murder','UrbanPop')]\nxy_cor <- cor(xy[, 1], xy[, 2])\n#plot(xy, pch=16, col=grey(0,.25))\n    \n# Bootstrap Distribution of Correlation\nn <- nrow(xy)\nbootstrap_cor <- vector(length=9999)\nfor(b in seq(bootstrap_cor) ){\n    xy_b <- xy[sample(n, replace=T),]\n    xy_cor_b <- cor(xy_b[, 1], xy_b[, 2])\n    bootstrap_cor[b] <- xy_cor_b\n}\nhist(bootstrap_cor, breaks=100,\n    border=NA, font.main=1,\n    xlab='Correlation',\n    main='Bootstrap Distribution')\n\n## Test whether correlation is statistically different from 0\nboot_ci <- quantile(bootstrap_cor, probs=c(0.025, 0.975))\nabline(v=boot_ci)\nabline(v=0, col='red')\n```\n\n::: {.cell-output-display}\n![](02_11_BivariateStatistics_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n:::\n\n\nImportantly, we can also impose the null of hypothesis of no association by reshuffling the data. If we resample without replacement, this is known as a *permutation test*.\n\n:::{.callout-note icon=false collapse=\"true\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nxy <- USArrests[,c('Murder','UrbanPop')]\nxy_cor <- cor(xy[, 1], xy[, 2])\n#plot(xy, pch=16, col=grey(0,.25))\n    \n# Null Bootstrap Distribution of Correlation\nn <- nrow(xy)\nnull_bootstrap_cor <- vector(length=9999)\nfor(b in seq(null_bootstrap_cor) ){\n    xy_b <- xy\n    xy_b[,'UrbanPop'] <- xy[sample(n, replace=T),'UrbanPop'] ## Reshuffle X\n    xy_cor_b <- cor(xy_b[, 1], xy_b[, 2])\n    null_bootstrap_cor[b] <- xy_cor_b\n}\nhist(null_bootstrap_cor, breaks=100,\n    border=NA, font.main=1,\n    xlab='Correlation',\n    main='Null Bootstrap Distribution')\n\n## Test whether correlation is statistically different from 0\nboot_ci <- quantile(null_bootstrap_cor, probs=c(0.025, 0.975))\nabline(v=boot_ci)\nabline(v=xy_cor, col='blue')\n```\n\n::: {.cell-output-display}\n![](02_11_BivariateStatistics_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\nBecause all dependence resides in the pairing, and permuting one margin destroys the pairing completely.\n\nTo construct a permutation test, we need to use `replace=F`. Rework the above code to make a Permutation Null Distribution and conduct a permutation test.\n:::\n\nSo the bootstrap evaluates sampling variability in the world that generated your data. A permutation test constructs the distribution of the statistic in a world where the null is true. Altogether, we have\n\n| Distribution| Sample Size per Iteration | Number of Iterations | Mechanism | Typical Purpose |\n| -------- | ------- | ------- | ------- |----------------|\nJackknife  | $n-1$   | $n$  | $X,Y$: Deterministically leave-one-out observation | Variance estimate |\nBootstrap  | $n$     | $B$  | $X,Y$: Random resample with replacement | Variance and CI estimate |\nNull Bootstrap | $n$ | $B$  | $X,Y$: Random resample with replacement and shifted | CI under imposed null, $p$-values |\nPermutation    | $n$ | $B$  | $X$: Random resample without replacement | CI under imposed null of no association, $p$-values |\n: Types of resampling\n\n*Falk Codeviance*.\nThe Codeviance, $\\tilde{C}_{XY}$, is a robust alternative to Covariance. Instead of relying on means (which can be sensitive to outliers), it uses medians.^[See also *Theil-Sen Estimator*, which may be seen as a precursor.] We can also scale the Codeviance by the median absolute deviation to compute the median correlation, $\\tilde{R}_{XY}$, which typically lies in $[-1,1]$ but not always. Letting $\\tilde{M}_{X}$ and $\\tilde{M}_{Y}$ denote the median of $\\hat{X}$ and $\\hat{Y}$, we have\n\\begin{eqnarray} \n\\tilde{C}_{XY} = \\text{Med}\\left\\{ |\\hat{X}_{i} - \\tilde{M}_{X}| |\\hat{Y}_i - \\tilde{M}_{Y}| \\right\\} \\\\\n\\tilde{R}_{XY} = \\frac{ \\tilde{C}_{XY} }{ \\hat{\\text{MAD}}_{X} \\hat{\\text{MAD}}_{Y}}. \n\\end{eqnarray}\n\n::: {.cell}\n\n```{.r .cell-code}\ncodev <- function(xy) {\n  # Compute medians for each column\n  med <- apply(xy, 2, median)\n  # Subtract the medians from each column\n  xm <- sweep(xy, 2, med, \"-\")\n  # Compute CoDev\n  CoDev <- median(xm[, 1] * xm[, 2])\n  # Compute the medians of absolute deviation\n  MadProd <- prod( apply(abs(xm), 2, median) )\n  # Return the robust correlation measure\n  return( CoDev / MadProd)\n}\nxy_codev <- codev(xy)\nxy_codev\n## [1] 0.005707763\n```\n:::\n\n\nYou construct sampling distributions and conduct hypothesis tests for Falk's Codeviance statistic in the same way you do for Pearson's Correlation statistic.\n\n:::{.callout-tip icon=false collapse=\"true\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nxy <- USArrests[,c('Murder','UrbanPop')]\nxy_cor <- cor(xy[, 1], xy[, 2])\n#plot(xy, pch=16, col=grey(0,.25))\n    \n# Null Permutation Distribution of Codeviance\nn <- nrow(xy)\nnull_permutation_codev <- vector(length=9999)\nfor(b in seq(null_permutation_codev) ){\n    xy_b <- xy\n    xy_b[,'UrbanPop'] <- xy[sample(n, replace=F),'UrbanPop'] ## Reshuffle X\n    xy_codev_b <- codev(xy_b)\n    null_permutation_codev[b] <- xy_codev_b\n}\nhist(null_permutation_codev, breaks=100,\n    border=NA, font.main=1,\n    xlab='Codeviance',\n    main='Null Permutation Distribution')\n\n## Test whether correlation is statistically different from 0\nabline(v=quantile(null_permutation_codev, probs=c(0.025, 0.975)))\nabline(v=xy_codev, col='blue')\n```\n\n::: {.cell-output-display}\n![](02_11_BivariateStatistics_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n:::\n\n\n#### **Two Ordered Factors**. {-}\nSuppose now that $\\hat{X}$ and $\\hat{Y}$ are both *ordered* variables. *Kendall's rank correlation* statistic measures the strength and direction of association by counting the number of concordant pairs (where the ranks agree) versus discordant pairs (where the ranks disagree). A value closer to $1$ suggests positive association in rankings, a value closer to $-1$ suggests a negative association, and a value of $0$ suggests no association in the ordering.\n\\begin{eqnarray}\n\\hat{KT} = \\frac{2}{n(n-1)} \\sum_{i} \\sum_{j > i} \\text{sgn} \\Bigl( (\\hat{X}_{i} - \\hat{X}_{j})(\\hat{Y}_i - \\hat{Y}_j) \\Bigr),\n\\end{eqnarray}\nwhere the sign function is:\n\\begin{eqnarray}\n\\text{sgn}(z) = \n\\begin{cases}\n    +1 & \\text{if } z > 0\\\\\n    0  & \\text{if } z = 0 \\\\\n    -1 & \\text{if } z < 0 \n\\end{cases}.\n\\end{eqnarray}\n\n::: {.cell}\n\n```{.r .cell-code}\nxy <- USArrests[,c('Murder','UrbanPop')]\nxy[,1] <- rank(xy[,1] )\nxy[,2] <- rank(xy[,2] )\n# plot(xy, pch=16, col=grey(0,.25))\nKT <- cor(xy[, 1], xy[, 2], method = \"kendall\")\nround(KT, 3)\n## [1] 0.074\n```\n:::\n\n\n\nYou construct sampling distributions and conduct hypothesis tests for Kendall's rank correlation statistic in the same way you do as for Pearson's Correlation statistic and Falk's Codeviance statistic.\n\n:::{.callout-tip icon=false collapse=\"true\"}\nTest whether Kendal's correlation statistic is statistically different from $0$.\n\n::: {.cell}\n\n```{.r .cell-code}\nxy <- USArrests[,c('Murder','UrbanPop')]\nKT <- cor(xy[, 1], xy[, 2], method=\"kendall\")\n```\n:::\n\n:::\n\nKendall's rank correlation coefficient can also be used for non-linear relationships, where Pearson's correlation coefficient often falls short. It almost always helps to visual your data first before summarizing it with a statistic.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](02_11_BivariateStatistics_files/figure-html/unnamed-chunk-8-1.png){width=768}\n:::\n:::\n\n\n\n\n#### **Two Unordered Factors**. {-}\nSuppose $\\hat{X}$ and $\\hat{Y}$ are both *categorical* variables; the value of $\\hat{X}$ is one of $1...K$ categories and the value of $\\hat{Y}$ is one of $1...J$ categories. We organize such data as a contingency table with $K$ rows and $J$ columns and use *Cramer's V* to quantify the strength of association by adjusting a *chi-squared* statistic to provide a measure that ranges from $0$ to $1$; $0$ suggests no association while a value closer to $1$ suggests a strong association. \n\nFirst, compute the chi-square statistic:\n\\begin{eqnarray}\n\\hat{\\chi}^2 = \\sum_{k=1}^{K} \\sum_{j=1}^{J} \\frac{(\\hat{O}_{kj} - \\hat{E}_{kj})^2}{\\hat{E}_{kj}}.\n\\end{eqnarray}\n\nwhere\n\n* $\\hat{O}_{kj}$ denote the observed frequency in cell $(k, j)$,\n* $\\hat{E}_{kj} = \\hat{RF}_{k} \\cdot \\hat{CF}_j / n$ is the expected frequency for each cell if $\\hat{X}$ and $\\hat{Y}$ are independent\n* $\\hat{RF}_{k}$ denotes the total frequency for row $k$ (i.e., $\\hat{RF}_i = \\sum_{j=1}^{J} \\hat{O}_{kj}$),\n* $\\hat{CF}_{j}$ denotes the total frequency for column $j$ (i.e., $\\hat{CF}_{j} = \\sum_{k=1}^{K} \\hat{O}_{kj}$),\n\n\nSecond, normalize the chi-square statistic with the sample size and the degrees of freedom to compute Cramer's V. Recalling that $I$ is the number of categories for $\\hat{X}$, and $J$ is the number of categories for $\\hat{Y}$, the statistic is\n\\begin{eqnarray}\n\\hat{CV} = \\sqrt{\\frac{\\hat{\\chi}^2 / n}{\\min(J - 1, \\, K - 1)}}.\n\\end{eqnarray}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxy <- USArrests[,c('Murder','UrbanPop')]\nxy[,1] <- cut(xy[,1],3)\nxy[,2] <- cut(xy[,2],4)\ntable(xy)\n##               UrbanPop\n## Murder         (31.9,46.8] (46.8,61.5] (61.5,76.2] (76.2,91.1]\n##   (0.783,6.33]           4           5           8           5\n##   (6.33,11.9]            0           4           7           6\n##   (11.9,17.4]            2           4           2           3\n\nCV <- function(xy){\n    # Create a contingency table from the categorical variables\n    tbl <- table(xy)\n    # Compute the chi-square statistic (without Yates' continuity correction)\n    chi2 <- chisq.test(tbl, correct=FALSE)[['statistic']]\n    # Total sample size\n    n <- sum(tbl)\n    # Compute the minimum degrees of freedom (min(rows-1, columns-1))\n    df_min <- min(nrow(tbl) - 1, ncol(tbl) - 1)\n    # Calculate Cramer's V\n    V <- sqrt((chi2 / n) / df_min)\n    return(V)\n}\nCV(xy)\n## X-squared \n## 0.2307071\n\n# DescTools::CramerV( table(xy) )\n```\n:::\n\n\nYou construct sampling distributions and conduct hypothesis tests for  Cramer's V statistic in the same way you do as the other statistics.\n\n\n## Association is not Causation\n\nIn all of the above statistics, we measure association not causation. \n\nOne major issue is statistical significance: sometimes there are relationships in the population that do not show up in samples, or non-relationships that appear in samples. This should be familiar at this point.\n\nOther major issues pertain to real relationships averaging out and mechanically inducing relationships with random data. To be concrete about these issue, I will focus on the most-used correlation statistic and examine\n\n* Causation without correlation\n* Correlation without causation\n\n\nNote that these are not the only examples of causation without correlation and correlation without causation. Many real datasets have temporal and spatial interdependence that create additional issues. Many real datasets also have economic interdependence, which also creates additional issues. We will delay covering these issues until much later.\n\n#### **Causation without correlation**. {-}\n\nExamples of this first issue includes *nonlinear effects* and  *heterogeneous effects* averaging out.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nn <- 10000\n\n# X causes Y via Y = X^2 + noise\nX <- runif(n, min = -1, max = 1)\nepsilon <- rnorm(n, mean = 0, sd = 0.1)\nY <- X^2 + epsilon  # clear causal effect of X on Y\nplot(X,Y, pch=16, col=grey(0,.1))\n\n# Correlation over the entire range\ntitle( paste0('Cor: ', round( cor(X, Y), 1) ) ,\n    font.main=1)\n```\n\n::: {.cell-output-display}\n![](02_11_BivariateStatistics_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Heterogeneous Effects\nX <- rnorm(n) # Randomized \"treatment\"\n\n# Heterogeneous effects based on group\ngroup <- rbinom(n, size = 1, prob = 0.5)\nepsilon <- rnorm(n, mean = 0, sd = 1)\nY <- ifelse(group == 1,\n            X + epsilon,   # positive effect\n            -X + epsilon)  # negative effect\nplot(X,Y, pch=16, col=grey(0,.1))\n\n# Correlation in the pooled sample\ntitle( paste0('Cor: ', round( cor(X, Y), 1) ),\n    font.main=1 )\n```\n\n::: {.cell-output-display}\n![](02_11_BivariateStatistics_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n#### **Correlation without causation**. {-}\nExamples of this second issue includes *shared denominators* and  *selection bias* inducing correlations.\n\nConsider three completely random variables. We can induce a mechanical relationship between the first two variables by dividing them both by the third variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nn <- 20000\n\n# Independent components\nA <- runif(n)\nB <- runif(n)\nC <- runif(n)\npar(mfrow=c(1,2))\nplot(A,B, pch=16, col=grey(0,.1))\ntitle('Independent Variables', font.main=1)\n\n# Ratios with a shared denominator\nX <- A / C\nY <- B / C\nplot(X,Y, pch=16, col=grey(0,.1))\ntitle('With Common Divisor', font.main=1)\n```\n\n::: {.cell-output-display}\n![](02_11_BivariateStatistics_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\n# Correlation\ncor(X, Y)\n## [1] 0.8183118\n```\n:::\n\n\nConsider an admissions rule into university: applicants are accepted if they have either high test scores or strong extracurriculars. Even if there is no general relationship between test scores and extracurriculars, you will see one amongst university students.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\n# Independent traits in the population\ntest_score        <- rnorm(n, mean = 0, sd = 1)\nextracurriculars  <- rnorm(n, mean = 0, sd = 1)\n\n# Selection above thresholds\nthreshold <- 1.0\nadmitted <- (test_score > threshold) | (extracurriculars > threshold)\nmean(admitted)  # admission rate\n## [1] 0.29615\n\npar(mfrow = c(1, 2))\n# Full population\nplot(test_score, extracurriculars,\n     pch=16, col=grey(0,.1))\ntitle('General Sample', font.main=1)\n# Admitted only\nplot(test_score[admitted], extracurriculars[admitted],\n     pch=16, col=grey(0,.1))\ntitle('University Sample', font.main=1)\n```\n\n::: {.cell-output-display}\n![](02_11_BivariateStatistics_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Correlation among admitted applicants only\ncor(test_score[admitted], extracurriculars[admitted])\n## [1] -0.5597409\n```\n:::\n\n\n\n## Probability Theory\n\nWe will now dig a little deeper theoretically into the statistics we compute. When we know how the data are generated theoretically, we can often compute the theoretical value of the most basic and often-used bivariate statistic: the Pearson correlation. To see this, we focus on two discrete random variables, first showing their covariance, $\\mathbb{C}[X_{i}, Y_{i}]$, and then their correlation $\\mathbb{R}[X_{i}, Y_{i}]$. Referring to and $\\mu_{X}=\\mathbb{E}[X_{i}]$ and $\\mu_{Y}=\\mathbb{E}[Y_{i}]$, we have\n\\begin{eqnarray}\n\\mathbb{C}[X_{i}, Y_{i}] \n&=& \\mathbb{E}[(X_{i} –  \\mu_{X})(Y_{i} – \\mu_{Y}])] \n= \\sum_{x}\\sum_{y} (x –  \\mu_{X})(y –  \\mu_{Y}) Prob(X_{i} = x, Y_{i} = y)\n\\\\\n\\mathbb{R}[X_{i}, Y_{i}] &=& \\frac{\\mathbb{C}[X_{i}, Y_{i}] }{ \\sqrt{\\mathbb{V}[X_{i}]} \\sqrt{\\mathbb{V}[Y_{i}]} }\n\\end{eqnarray}\n\nFor example, suppose we have discrete data with the following outcomes and probabilities. Note that cells reflect the probabilities of the outcomes depicted on the row and column labels, e.g. $Prob(X_{i}=1, Y_{i}=0)=0.1$.\n\n|    | $x=0$ | $x=1$ | $x=2$ |\n|:--:|:--:|:--:|:--:|\n| $y=0$  | $0.0$ | $0.1$ | $0.0$ |\n| $y=10$ | $0.1$ | $0.3$ | $0.1$ |\n| $y=20$ | $0.1$ | $0.1$ | $0.2$ |\n\n\n\nAfter verifying that the probabilities sum to $1$, we then compute the marginal distributions\n\\begin{eqnarray}\nProb(X_{i}=0)=0.2,\\quad Prob(X_{i}=1)=0.5,\\quad Prob(X_{i}=2) = 0.3 \\\\\nProb(Y_{i}=0)=0.1,\\quad Prob(Y_{i}=10)=0.5,\\quad Prob(Y_{i}=20) = 0.4\n\\end{eqnarray}\nwhich allows us to compute the means:\n\\begin{eqnarray}\n\\mathbb{E}[X_{i}] &=& 0(0.2)+1(0.5)+2(0.3) = 1.1 \\\\\n\\mathbb{E}[Y_{i}] &=& 0(0.1)+10(0.5)+20(0.4) = 13\n\\end{eqnarray}\nWe can then compute the cell-by-cell contributions: $Prob(X_{i} = x, Y_{i} = y) (x-\\mathbb{E}[X_{i}])(y-\\mathbb{E}[Y_{i}])$,\n\\begin{eqnarray}\n\\begin{array}{l l r r r r r}\n\\hline\nx & y & Prob(X_{i}=x, Y_{i}=y) & x-\\mathbb{E}[X_{i}] & y-\\mathbb{E}[Y_{i}] & (x-\\mathbb{E}[X_{i}])(y-\\mathbb{E}[Y_{i}]) & \\text{Contribution}\\\\\n\\hline\n0 & 0  & 0.0 & -1.1 & -13 & 14.3  & 0\\\\\n0 & 10 & 0.1 & -1.1 & -3  & 3.3   & 0.330\\\\\n0 & 20 & 0.1 & -1.1 & 7   & -7.7  & -0.770\\\\\n1 & 0  & 0.1 & -0.1 & -13 & 1.3   & 0.130\\\\\n1 & 10 & 0.3 & -0.1 & -3  & 0.3   & 0.090\\\\\n1 & 20 & 0.1 & -0.1 & 7   & -0.7  & -0.070\\\\\n2 & 0  & 0.0 & 0.9  & -13 & -11.7 & 0\\\\\n2 & 10 & 0.1 & 0.9  & -3  & -2.7  & -0.270\\\\\n2 & 20 & 0.2 & 0.9  & 7   & 6.3   & 1.260\\\\\n\\hline\n\\end{array}\n\\end{eqnarray}\n\\mathbb{C}[X_{i},Y_{i}] &=& \\sum_{x} \\sum_{y} \\left(x-\\mathbb{E}[X_{i}]\\right)\\left(y-\\mathbb{E}[Y_{i}]\\right) Prob\\left(X_{i} = x, Y_{i} = y\\right) \\\\\n&=& 0 + 0.330 -0.770 + 0.130 + 0.090  -0.070 +0 -0.270 + 1.260\n= 0.7\n\\end{eqnarray}\n\nTo compute the correlation value, we first need the standard deviations\n\\begin{eqnarray}\n\\mathbb{V}[X_{i}] &=& \\sum_{x} (x-\\mathbb{E}[X_{i}])^2 Prob(X_{i} = x) \\\\\n&=& (0-1.1)^2(0.2)+(1-1.1)^2(0.5)+(2-1.1)^2(0.3)=0.49 \\\\\n\\mathbb{V}[Y_{i}] &=& \\sum_{y}  (y-\\mathbb{E}[Y_{i}])^2 Prob(Y_{i} = y) \\\\\n&=& (0-13)^2(0.1)+(10-13)^2(0.5)+(20-13)^2(0.4)=41 \\\\\n\\end{eqnarray}\nThen we can find the correlation as\n\\begin{eqnarray}\n\\frac{\\mathbb{C}[X_{i},Y_{i}]}{ \\sqrt{\\mathbb{V}[X_{i}]} \\sqrt{\\mathbb{V}[Y_{i}]} } \n&=& \\frac{0.7}{\\sqrt{0.49} \\sqrt{41}} \\approx 0.156,\n\\end{eqnarray}\nwhich suggests a weak positive association between the variables.\n\n\n#### **Using the Computer**. {-}\n\nNote that you can do all of the above calculations using the computer instead of by hand.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Make a Probability Table\nx <- c(0,1,2)\ny <- c(0,10,20)\nxy_probs <- matrix(c(\n    0.0, 0.1, 0.0,\n    0.1, 0.3, 0.1,\n    0.1, 0.1, 0.2\n), nrow=3, ncol=3, byrow=TRUE)\nrownames(xy_probs) <- paste0('y=',y)\ncolnames(xy_probs) <-  paste0('x=',x)\nxy_probs\n##      x=0 x=1 x=2\n## y=0  0.0 0.1 0.0\n## y=10 0.1 0.3 0.1\n## y=20 0.1 0.1 0.2\n\n# Compute Marginals and Means\npX  <- colSums(xy_probs)\npY  <- rowSums(xy_probs)\nEX  <- sum(x * pX)\nEY  <- sum(y * pY)\n\n# Compute Covariance\ndxy_grid <- expand.grid(dy=y-EY, dx=x-EX)[,c(2,1)]\ndxy_grid[,'p'] <- as.vector(xy_probs)\ndxy_grid[,'contribution'] <- dxy_grid[,'dx'] * dxy_grid[,'dy'] * dxy_grid[,'p']\nCovXY <- sum(dxy_grid[,'contribution'])\nCovXY\n## [1] 0.7\n\n# Compute Variances\nVX <- sum( (x-EX)^2 * pX)\nSX <- sqrt(VX)\nVY <- sum( (y-EY)^2 * pY)\nSY <- sqrt(VY)\n\n# Compute Correlation\nCorXY <- CovXY / (SX * SY)\nCorXY\n## [1] 0.1561738\n```\n:::\n\n\n:::{.callout-note icon=false collapse=\"true\"}\nCompute the correlation for bivariate data with these probabilities, using both math (first) and the computer (second)\n\n|    | $x=-10$ | $x=10$ |\n|:--:|:--:|:--:|\n| $y=0$ | $0.05$ | $0.20$ |\n| $y=1$ | $0.05$ | $0.20$ |\n| $y=2$ | $0.05$ | $0.20$ |\n| $y=3$ | $0.05$ | $0.20$ |\n\n:::\n\n:::{.callout-tip icon=false collapse=\"true\"}\n\nAlso compute the correlation for bivariate data with these probabilities\n\n|    | $x=-10$ | $x=10$ |\n|:--:|:--:|:--:|\n| $y=0$ | $0.05$ | $0.05$ |\n| $y=1$ | $0.10$ | $0.10$ |\n| $y=2$ | $0.15$ | $0.15$ |\n| $y=3$ | $0.20$ | $0.20$ |\n\nAlso compute the correlation for bivariate data with these probabilities\n\n|    | $x=-10$ | $x=10$ |\n|:--:|:--:|:--:|\n| $y=0$ | $0.05$ | $0.15$ |\n| $y=1$ | $0.05$ | $0.15$ |\n| $y=2$ | $0.10$ | $0.20$ |\n| $y=3$ | $0.10$ | $0.20$ |\n\n\nExplain intuitively when the correlation equals $0$ and when it does not.\n:::\n\n\n## Further Reading \n\nOther Statistics \n\n* <https://cran.r-project.org/web/packages/qualvar/vignettes/wilcox1973.html>\n\n\n",
    "supporting": [
      "02_11_BivariateStatistics_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}